var wS=Object.defineProperty;var SS=(t,e,n)=>e in t?wS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var T=(t,e,n)=>(SS(t,typeof e!="symbol"?e+"":e,n),n);function ES(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function hy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dy={exports:{}},oc={},py={exports:{}},Z={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yo=Symbol.for("react.element"),AS=Symbol.for("react.portal"),RS=Symbol.for("react.fragment"),bS=Symbol.for("react.strict_mode"),PS=Symbol.for("react.profiler"),xS=Symbol.for("react.provider"),CS=Symbol.for("react.context"),IS=Symbol.for("react.forward_ref"),MS=Symbol.for("react.suspense"),OS=Symbol.for("react.memo"),NS=Symbol.for("react.lazy"),Dp=Symbol.iterator;function kS(t){return t===null||typeof t!="object"?null:(t=Dp&&t[Dp]||t["@@iterator"],typeof t=="function"?t:null)}var gy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_y=Object.assign,my={};function Vi(t,e,n){this.props=t,this.context=e,this.refs=my,this.updater=n||gy}Vi.prototype.isReactComponent={};Vi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Vi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function yy(){}yy.prototype=Vi.prototype;function zh(t,e,n){this.props=t,this.context=e,this.refs=my,this.updater=n||gy}var Vh=zh.prototype=new yy;Vh.constructor=zh;_y(Vh,Vi.prototype);Vh.isPureReactComponent=!0;var Bp=Array.isArray,vy=Object.prototype.hasOwnProperty,jh={current:null},Ty={key:!0,ref:!0,__self:!0,__source:!0};function wy(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)vy.call(e,r)&&!Ty.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:yo,type:t,key:s,ref:o,props:i,_owner:jh.current}}function FS(t,e){return{$$typeof:yo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Wh(t){return typeof t=="object"&&t!==null&&t.$$typeof===yo}function DS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Up=/\/+/g;function $c(t,e){return typeof t=="object"&&t!==null&&t.key!=null?DS(""+t.key):e.toString(36)}function Oa(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case yo:case AS:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+$c(o,0):r,Bp(i)?(n="",t!=null&&(n=t.replace(Up,"$&/")+"/"),Oa(i,e,n,"",function(c){return c})):i!=null&&(Wh(i)&&(i=FS(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Up,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Bp(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+$c(s,a);o+=Oa(s,e,n,l,i)}else if(l=kS(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+$c(s,a++),o+=Oa(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function jo(t,e,n){if(t==null)return t;var r=[],i=0;return Oa(t,r,"","",function(s){return e.call(n,s,i++)}),r}function BS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Xe={current:null},Na={transition:null},US={ReactCurrentDispatcher:Xe,ReactCurrentBatchConfig:Na,ReactCurrentOwner:jh};function Sy(){throw Error("act(...) is not supported in production builds of React.")}Z.Children={map:jo,forEach:function(t,e,n){jo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return jo(t,function(){e++}),e},toArray:function(t){return jo(t,function(e){return e})||[]},only:function(t){if(!Wh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Z.Component=Vi;Z.Fragment=RS;Z.Profiler=PS;Z.PureComponent=zh;Z.StrictMode=bS;Z.Suspense=MS;Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=US;Z.act=Sy;Z.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=_y({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=jh.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)vy.call(e,l)&&!Ty.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:yo,type:t.type,key:i,ref:s,props:r,_owner:o}};Z.createContext=function(t){return t={$$typeof:CS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:xS,_context:t},t.Consumer=t};Z.createElement=wy;Z.createFactory=function(t){var e=wy.bind(null,t);return e.type=t,e};Z.createRef=function(){return{current:null}};Z.forwardRef=function(t){return{$$typeof:IS,render:t}};Z.isValidElement=Wh;Z.lazy=function(t){return{$$typeof:NS,_payload:{_status:-1,_result:t},_init:BS}};Z.memo=function(t,e){return{$$typeof:OS,type:t,compare:e===void 0?null:e}};Z.startTransition=function(t){var e=Na.transition;Na.transition={};try{t()}finally{Na.transition=e}};Z.unstable_act=Sy;Z.useCallback=function(t,e){return Xe.current.useCallback(t,e)};Z.useContext=function(t){return Xe.current.useContext(t)};Z.useDebugValue=function(){};Z.useDeferredValue=function(t){return Xe.current.useDeferredValue(t)};Z.useEffect=function(t,e){return Xe.current.useEffect(t,e)};Z.useId=function(){return Xe.current.useId()};Z.useImperativeHandle=function(t,e,n){return Xe.current.useImperativeHandle(t,e,n)};Z.useInsertionEffect=function(t,e){return Xe.current.useInsertionEffect(t,e)};Z.useLayoutEffect=function(t,e){return Xe.current.useLayoutEffect(t,e)};Z.useMemo=function(t,e){return Xe.current.useMemo(t,e)};Z.useReducer=function(t,e,n){return Xe.current.useReducer(t,e,n)};Z.useRef=function(t){return Xe.current.useRef(t)};Z.useState=function(t){return Xe.current.useState(t)};Z.useSyncExternalStore=function(t,e,n){return Xe.current.useSyncExternalStore(t,e,n)};Z.useTransition=function(){return Xe.current.useTransition()};Z.version="18.3.1";py.exports=Z;var Ey=py.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LS=Ey,zS=Symbol.for("react.element"),VS=Symbol.for("react.fragment"),jS=Object.prototype.hasOwnProperty,WS=LS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,HS={key:!0,ref:!0,__self:!0,__source:!0};function Ay(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)jS.call(e,r)&&!HS.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:zS,type:t,key:s,ref:o,props:i,_owner:WS.current}}oc.Fragment=VS;oc.jsx=Ay;oc.jsxs=Ay;dy.exports=oc;var $S=dy.exports,Ry={exports:{}},lt={},by={exports:{}},Py={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,$){var Y=L.length;L.push($);e:for(;0<Y;){var fe=Y-1>>>1,ae=L[fe];if(0<i(ae,$))L[fe]=$,L[Y]=ae,Y=fe;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var $=L[0],Y=L.pop();if(Y!==$){L[0]=Y;e:for(var fe=0,ae=L.length,Dr=ae>>>1;fe<Dr;){var Tt=2*(fe+1)-1,Xi=L[Tt],en=Tt+1,Te=L[en];if(0>i(Xi,Y))en<ae&&0>i(Te,Xi)?(L[fe]=Te,L[en]=Y,fe=en):(L[fe]=Xi,L[Tt]=Y,fe=Tt);else if(en<ae&&0>i(Te,Y))L[fe]=Te,L[en]=Y,fe=en;else break e}}return $}function i(L,$){var Y=L.sortIndex-$.sortIndex;return Y!==0?Y:L.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,_=!1,d=!1,m=!1,E=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var $=n(c);$!==null;){if($.callback===null)r(c);else if($.startTime<=L)r(c),$.sortIndex=$.expirationTime,e(l,$);else break;$=n(c)}}function A(L){if(m=!1,y(L),!d)if(n(l)!==null)d=!0,kt(x);else{var $=n(c);$!==null&&Ft(A,$.startTime-L)}}function x(L,$){d=!1,m&&(m=!1,p(N),N=-1),_=!0;var Y=h;try{for(y($),f=n(l);f!==null&&(!(f.expirationTime>$)||L&&!j());){var fe=f.callback;if(typeof fe=="function"){f.callback=null,h=f.priorityLevel;var ae=fe(f.expirationTime<=$);$=t.unstable_now(),typeof ae=="function"?f.callback=ae:f===n(l)&&r(l),y($)}else r(l);f=n(l)}if(f!==null)var Dr=!0;else{var Tt=n(c);Tt!==null&&Ft(A,Tt.startTime-$),Dr=!1}return Dr}finally{f=null,h=Y,_=!1}}var I=!1,O=null,N=-1,k=5,U=-1;function j(){return!(t.unstable_now()-U<k)}function H(){if(O!==null){var L=t.unstable_now();U=L;var $=!0;try{$=O(!0,L)}finally{$?W():(I=!1,O=null)}}else I=!1}var W;if(typeof g=="function")W=function(){g(H)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Ae=X.port2;X.port1.onmessage=H,W=function(){Ae.postMessage(null)}}else W=function(){E(H,0)};function kt(L){O=L,I||(I=!0,W())}function Ft(L,$){N=E(function(){L(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){d||_||(d=!0,kt(x))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(L){switch(h){case 1:case 2:case 3:var $=3;break;default:$=h}var Y=h;h=$;try{return L()}finally{h=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,$){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var Y=h;h=L;try{return $()}finally{h=Y}},t.unstable_scheduleCallback=function(L,$,Y){var fe=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?fe+Y:fe):Y=fe,L){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Y+ae,L={id:u++,callback:$,priorityLevel:L,startTime:Y,expirationTime:ae,sortIndex:-1},Y>fe?(L.sortIndex=Y,e(c,L),n(l)===null&&L===n(c)&&(m?(p(N),N=-1):m=!0,Ft(A,Y-fe))):(L.sortIndex=ae,e(l,L),d||_||(d=!0,kt(x))),L},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(L){var $=h;return function(){var Y=h;h=$;try{return L.apply(this,arguments)}finally{h=Y}}}})(Py);by.exports=Py;var XS=by.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YS=Ey,at=XS;function D(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xy=new Set,Ws={};function Ir(t,e){Ai(t,e),Ai(t+"Capture",e)}function Ai(t,e){for(Ws[t]=e,t=0;t<e.length;t++)xy.add(e[t])}var hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sf=Object.prototype.hasOwnProperty,KS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lp={},zp={};function ZS(t){return sf.call(zp,t)?!0:sf.call(Lp,t)?!1:KS.test(t)?zp[t]=!0:(Lp[t]=!0,!1)}function qS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function QS(t,e,n,r){if(e===null||typeof e>"u"||qS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ye(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){De[t]=new Ye(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];De[e]=new Ye(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){De[t]=new Ye(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){De[t]=new Ye(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){De[t]=new Ye(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){De[t]=new Ye(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){De[t]=new Ye(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){De[t]=new Ye(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){De[t]=new Ye(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hh=/[\-:]([a-z])/g;function $h(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hh,$h);De[e]=new Ye(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hh,$h);De[e]=new Ye(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hh,$h);De[e]=new Ye(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){De[t]=new Ye(t,1,!1,t.toLowerCase(),null,!1,!1)});De.xlinkHref=new Ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){De[t]=new Ye(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xh(t,e,n,r){var i=De.hasOwnProperty(e)?De[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(QS(e,n,i,r)&&(n=null),r||i===null?ZS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var mn=YS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Wo=Symbol.for("react.element"),Yr=Symbol.for("react.portal"),Kr=Symbol.for("react.fragment"),Yh=Symbol.for("react.strict_mode"),of=Symbol.for("react.profiler"),Cy=Symbol.for("react.provider"),Iy=Symbol.for("react.context"),Kh=Symbol.for("react.forward_ref"),af=Symbol.for("react.suspense"),lf=Symbol.for("react.suspense_list"),Zh=Symbol.for("react.memo"),Rn=Symbol.for("react.lazy"),My=Symbol.for("react.offscreen"),Vp=Symbol.iterator;function es(t){return t===null||typeof t!="object"?null:(t=Vp&&t[Vp]||t["@@iterator"],typeof t=="function"?t:null)}var _e=Object.assign,Xc;function ms(t){if(Xc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Xc=e&&e[1]||""}return`
`+Xc+t}var Yc=!1;function Kc(t,e){if(!t||Yc)return"";Yc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Yc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ms(t):""}function JS(t){switch(t.tag){case 5:return ms(t.type);case 16:return ms("Lazy");case 13:return ms("Suspense");case 19:return ms("SuspenseList");case 0:case 2:case 15:return t=Kc(t.type,!1),t;case 11:return t=Kc(t.type.render,!1),t;case 1:return t=Kc(t.type,!0),t;default:return""}}function cf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Kr:return"Fragment";case Yr:return"Portal";case of:return"Profiler";case Yh:return"StrictMode";case af:return"Suspense";case lf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Iy:return(t.displayName||"Context")+".Consumer";case Cy:return(t._context.displayName||"Context")+".Provider";case Kh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Zh:return e=t.displayName||null,e!==null?e:cf(t.type)||"Memo";case Rn:e=t._payload,t=t._init;try{return cf(t(e))}catch{}}return null}function GS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cf(e);case 8:return e===Yh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Oy(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eE(t){var e=Oy(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ho(t){t._valueTracker||(t._valueTracker=eE(t))}function Ny(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Oy(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Za(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function uf(t,e){var n=e.checked;return _e({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Xn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ky(t,e){e=e.checked,e!=null&&Xh(t,"checked",e,!1)}function ff(t,e){ky(t,e);var n=Xn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?hf(t,e.type,n):e.hasOwnProperty("defaultValue")&&hf(t,e.type,Xn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Wp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function hf(t,e,n){(e!=="number"||Za(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ys=Array.isArray;function di(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Xn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function df(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(D(91));return _e({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Hp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(D(92));if(ys(n)){if(1<n.length)throw Error(D(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Xn(n)}}function Fy(t,e){var n=Xn(e.value),r=Xn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function $p(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Dy(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Dy(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var $o,By=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for($o=$o||document.createElement("div"),$o.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=$o.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Hs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var bs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tE=["Webkit","ms","Moz","O"];Object.keys(bs).forEach(function(t){tE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bs[e]=bs[t]})});function Uy(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||bs.hasOwnProperty(t)&&bs[t]?(""+e).trim():e+"px"}function Ly(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Uy(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var nE=_e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gf(t,e){if(e){if(nE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(D(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(D(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(D(61))}if(e.style!=null&&typeof e.style!="object")throw Error(D(62))}}function _f(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mf=null;function qh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var yf=null,pi=null,gi=null;function Xp(t){if(t=wo(t)){if(typeof yf!="function")throw Error(D(280));var e=t.stateNode;e&&(e=fc(e),yf(t.stateNode,t.type,e))}}function zy(t){pi?gi?gi.push(t):gi=[t]:pi=t}function Vy(){if(pi){var t=pi,e=gi;if(gi=pi=null,Xp(t),e)for(t=0;t<e.length;t++)Xp(e[t])}}function jy(t,e){return t(e)}function Wy(){}var Zc=!1;function Hy(t,e,n){if(Zc)return t(e,n);Zc=!0;try{return jy(t,e,n)}finally{Zc=!1,(pi!==null||gi!==null)&&(Wy(),Vy())}}function $s(t,e){var n=t.stateNode;if(n===null)return null;var r=fc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(D(231,e,typeof n));return n}var vf=!1;if(hn)try{var ts={};Object.defineProperty(ts,"passive",{get:function(){vf=!0}}),window.addEventListener("test",ts,ts),window.removeEventListener("test",ts,ts)}catch{vf=!1}function rE(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ps=!1,qa=null,Qa=!1,Tf=null,iE={onError:function(t){Ps=!0,qa=t}};function sE(t,e,n,r,i,s,o,a,l){Ps=!1,qa=null,rE.apply(iE,arguments)}function oE(t,e,n,r,i,s,o,a,l){if(sE.apply(this,arguments),Ps){if(Ps){var c=qa;Ps=!1,qa=null}else throw Error(D(198));Qa||(Qa=!0,Tf=c)}}function Mr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function $y(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Yp(t){if(Mr(t)!==t)throw Error(D(188))}function aE(t){var e=t.alternate;if(!e){if(e=Mr(t),e===null)throw Error(D(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Yp(i),t;if(s===r)return Yp(i),e;s=s.sibling}throw Error(D(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(D(189))}}if(n.alternate!==r)throw Error(D(190))}if(n.tag!==3)throw Error(D(188));return n.stateNode.current===n?t:e}function Xy(t){return t=aE(t),t!==null?Yy(t):null}function Yy(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Yy(t);if(e!==null)return e;t=t.sibling}return null}var Ky=at.unstable_scheduleCallback,Kp=at.unstable_cancelCallback,lE=at.unstable_shouldYield,cE=at.unstable_requestPaint,ve=at.unstable_now,uE=at.unstable_getCurrentPriorityLevel,Qh=at.unstable_ImmediatePriority,Zy=at.unstable_UserBlockingPriority,Ja=at.unstable_NormalPriority,fE=at.unstable_LowPriority,qy=at.unstable_IdlePriority,ac=null,qt=null;function hE(t){if(qt&&typeof qt.onCommitFiberRoot=="function")try{qt.onCommitFiberRoot(ac,t,void 0,(t.current.flags&128)===128)}catch{}}var Ct=Math.clz32?Math.clz32:gE,dE=Math.log,pE=Math.LN2;function gE(t){return t>>>=0,t===0?32:31-(dE(t)/pE|0)|0}var Xo=64,Yo=4194304;function vs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ga(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=vs(a):(s&=o,s!==0&&(r=vs(s)))}else o=n&~i,o!==0?r=vs(o):s!==0&&(r=vs(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ct(e),i=1<<n,r|=t[n],e&=~i;return r}function _E(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ct(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=_E(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function wf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Qy(){var t=Xo;return Xo<<=1,!(Xo&4194240)&&(Xo=64),t}function qc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function vo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ct(e),t[e]=n}function yE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ct(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Jh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ct(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var G=0;function Jy(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Gy,Gh,e0,t0,n0,Sf=!1,Ko=[],Dn=null,Bn=null,Un=null,Xs=new Map,Ys=new Map,Cn=[],vE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zp(t,e){switch(t){case"focusin":case"focusout":Dn=null;break;case"dragenter":case"dragleave":Bn=null;break;case"mouseover":case"mouseout":Un=null;break;case"pointerover":case"pointerout":Xs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ys.delete(e.pointerId)}}function ns(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=wo(e),e!==null&&Gh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function TE(t,e,n,r,i){switch(e){case"focusin":return Dn=ns(Dn,t,e,n,r,i),!0;case"dragenter":return Bn=ns(Bn,t,e,n,r,i),!0;case"mouseover":return Un=ns(Un,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Xs.set(s,ns(Xs.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ys.set(s,ns(Ys.get(s)||null,t,e,n,r,i)),!0}return!1}function r0(t){var e=fr(t.target);if(e!==null){var n=Mr(e);if(n!==null){if(e=n.tag,e===13){if(e=$y(n),e!==null){t.blockedOn=e,n0(t.priority,function(){e0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ka(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ef(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);mf=r,n.target.dispatchEvent(r),mf=null}else return e=wo(n),e!==null&&Gh(e),t.blockedOn=n,!1;e.shift()}return!0}function qp(t,e,n){ka(t)&&n.delete(e)}function wE(){Sf=!1,Dn!==null&&ka(Dn)&&(Dn=null),Bn!==null&&ka(Bn)&&(Bn=null),Un!==null&&ka(Un)&&(Un=null),Xs.forEach(qp),Ys.forEach(qp)}function rs(t,e){t.blockedOn===e&&(t.blockedOn=null,Sf||(Sf=!0,at.unstable_scheduleCallback(at.unstable_NormalPriority,wE)))}function Ks(t){function e(i){return rs(i,t)}if(0<Ko.length){rs(Ko[0],t);for(var n=1;n<Ko.length;n++){var r=Ko[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Dn!==null&&rs(Dn,t),Bn!==null&&rs(Bn,t),Un!==null&&rs(Un,t),Xs.forEach(e),Ys.forEach(e),n=0;n<Cn.length;n++)r=Cn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Cn.length&&(n=Cn[0],n.blockedOn===null);)r0(n),n.blockedOn===null&&Cn.shift()}var _i=mn.ReactCurrentBatchConfig,el=!0;function SE(t,e,n,r){var i=G,s=_i.transition;_i.transition=null;try{G=1,ed(t,e,n,r)}finally{G=i,_i.transition=s}}function EE(t,e,n,r){var i=G,s=_i.transition;_i.transition=null;try{G=4,ed(t,e,n,r)}finally{G=i,_i.transition=s}}function ed(t,e,n,r){if(el){var i=Ef(t,e,n,r);if(i===null)ou(t,e,r,tl,n),Zp(t,r);else if(TE(i,t,e,n,r))r.stopPropagation();else if(Zp(t,r),e&4&&-1<vE.indexOf(t)){for(;i!==null;){var s=wo(i);if(s!==null&&Gy(s),s=Ef(t,e,n,r),s===null&&ou(t,e,r,tl,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else ou(t,e,r,null,n)}}var tl=null;function Ef(t,e,n,r){if(tl=null,t=qh(r),t=fr(t),t!==null)if(e=Mr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=$y(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return tl=t,null}function i0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uE()){case Qh:return 1;case Zy:return 4;case Ja:case fE:return 16;case qy:return 536870912;default:return 16}default:return 16}}var Mn=null,td=null,Fa=null;function s0(){if(Fa)return Fa;var t,e=td,n=e.length,r,i="value"in Mn?Mn.value:Mn.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return Fa=i.slice(t,1<r?1-r:void 0)}function Da(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Zo(){return!0}function Qp(){return!1}function ct(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Zo:Qp,this.isPropagationStopped=Qp,this}return _e(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Zo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Zo)},persist:function(){},isPersistent:Zo}),e}var ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nd=ct(ji),To=_e({},ji,{view:0,detail:0}),AE=ct(To),Qc,Jc,is,lc=_e({},To,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==is&&(is&&t.type==="mousemove"?(Qc=t.screenX-is.screenX,Jc=t.screenY-is.screenY):Jc=Qc=0,is=t),Qc)},movementY:function(t){return"movementY"in t?t.movementY:Jc}}),Jp=ct(lc),RE=_e({},lc,{dataTransfer:0}),bE=ct(RE),PE=_e({},To,{relatedTarget:0}),Gc=ct(PE),xE=_e({},ji,{animationName:0,elapsedTime:0,pseudoElement:0}),CE=ct(xE),IE=_e({},ji,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ME=ct(IE),OE=_e({},ji,{data:0}),Gp=ct(OE),NE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=FE[t])?!!e[t]:!1}function rd(){return DE}var BE=_e({},To,{key:function(t){if(t.key){var e=NE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Da(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rd,charCode:function(t){return t.type==="keypress"?Da(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Da(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),UE=ct(BE),LE=_e({},lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),eg=ct(LE),zE=_e({},To,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rd}),VE=ct(zE),jE=_e({},ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),WE=ct(jE),HE=_e({},lc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$E=ct(HE),XE=[9,13,27,32],id=hn&&"CompositionEvent"in window,xs=null;hn&&"documentMode"in document&&(xs=document.documentMode);var YE=hn&&"TextEvent"in window&&!xs,o0=hn&&(!id||xs&&8<xs&&11>=xs),tg=String.fromCharCode(32),ng=!1;function a0(t,e){switch(t){case"keyup":return XE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function l0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zr=!1;function KE(t,e){switch(t){case"compositionend":return l0(e);case"keypress":return e.which!==32?null:(ng=!0,tg);case"textInput":return t=e.data,t===tg&&ng?null:t;default:return null}}function ZE(t,e){if(Zr)return t==="compositionend"||!id&&a0(t,e)?(t=s0(),Fa=td=Mn=null,Zr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return o0&&e.locale!=="ko"?null:e.data;default:return null}}var qE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qE[t.type]:e==="textarea"}function c0(t,e,n,r){zy(r),e=nl(e,"onChange"),0<e.length&&(n=new nd("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Cs=null,Zs=null;function QE(t){T0(t,0)}function cc(t){var e=Jr(t);if(Ny(e))return t}function JE(t,e){if(t==="change")return e}var u0=!1;if(hn){var eu;if(hn){var tu="oninput"in document;if(!tu){var ig=document.createElement("div");ig.setAttribute("oninput","return;"),tu=typeof ig.oninput=="function"}eu=tu}else eu=!1;u0=eu&&(!document.documentMode||9<document.documentMode)}function sg(){Cs&&(Cs.detachEvent("onpropertychange",f0),Zs=Cs=null)}function f0(t){if(t.propertyName==="value"&&cc(Zs)){var e=[];c0(e,Zs,t,qh(t)),Hy(QE,e)}}function GE(t,e,n){t==="focusin"?(sg(),Cs=e,Zs=n,Cs.attachEvent("onpropertychange",f0)):t==="focusout"&&sg()}function e1(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cc(Zs)}function t1(t,e){if(t==="click")return cc(e)}function n1(t,e){if(t==="input"||t==="change")return cc(e)}function r1(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ot=typeof Object.is=="function"?Object.is:r1;function qs(t,e){if(Ot(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!sf.call(e,i)||!Ot(t[i],e[i]))return!1}return!0}function og(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ag(t,e){var n=og(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=og(n)}}function h0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?h0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function d0(){for(var t=window,e=Za();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Za(t.document)}return e}function sd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function i1(t){var e=d0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&h0(n.ownerDocument.documentElement,n)){if(r!==null&&sd(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=ag(n,s);var o=ag(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var s1=hn&&"documentMode"in document&&11>=document.documentMode,qr=null,Af=null,Is=null,Rf=!1;function lg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Rf||qr==null||qr!==Za(r)||(r=qr,"selectionStart"in r&&sd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Is&&qs(Is,r)||(Is=r,r=nl(Af,"onSelect"),0<r.length&&(e=new nd("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=qr)))}function qo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Qr={animationend:qo("Animation","AnimationEnd"),animationiteration:qo("Animation","AnimationIteration"),animationstart:qo("Animation","AnimationStart"),transitionend:qo("Transition","TransitionEnd")},nu={},p0={};hn&&(p0=document.createElement("div").style,"AnimationEvent"in window||(delete Qr.animationend.animation,delete Qr.animationiteration.animation,delete Qr.animationstart.animation),"TransitionEvent"in window||delete Qr.transitionend.transition);function uc(t){if(nu[t])return nu[t];if(!Qr[t])return t;var e=Qr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in p0)return nu[t]=e[n];return t}var g0=uc("animationend"),_0=uc("animationiteration"),m0=uc("animationstart"),y0=uc("transitionend"),v0=new Map,cg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qn(t,e){v0.set(t,e),Ir(e,[t])}for(var ru=0;ru<cg.length;ru++){var iu=cg[ru],o1=iu.toLowerCase(),a1=iu[0].toUpperCase()+iu.slice(1);qn(o1,"on"+a1)}qn(g0,"onAnimationEnd");qn(_0,"onAnimationIteration");qn(m0,"onAnimationStart");qn("dblclick","onDoubleClick");qn("focusin","onFocus");qn("focusout","onBlur");qn(y0,"onTransitionEnd");Ai("onMouseEnter",["mouseout","mouseover"]);Ai("onMouseLeave",["mouseout","mouseover"]);Ai("onPointerEnter",["pointerout","pointerover"]);Ai("onPointerLeave",["pointerout","pointerover"]);Ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ts="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ts));function ug(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,oE(r,e,void 0,t),t.currentTarget=null}function T0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;ug(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;ug(i,a,c),s=l}}}if(Qa)throw t=Tf,Qa=!1,Tf=null,t}function se(t,e){var n=e[If];n===void 0&&(n=e[If]=new Set);var r=t+"__bubble";n.has(r)||(w0(e,t,2,!1),n.add(r))}function su(t,e,n){var r=0;e&&(r|=4),w0(n,t,r,e)}var Qo="_reactListening"+Math.random().toString(36).slice(2);function Qs(t){if(!t[Qo]){t[Qo]=!0,xy.forEach(function(n){n!=="selectionchange"&&(l1.has(n)||su(n,!1,t),su(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Qo]||(e[Qo]=!0,su("selectionchange",!1,e))}}function w0(t,e,n,r){switch(i0(e)){case 1:var i=SE;break;case 4:i=EE;break;default:i=ed}n=i.bind(null,e,n,t),i=void 0,!vf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function ou(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=fr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}Hy(function(){var c=s,u=qh(n),f=[];e:{var h=v0.get(t);if(h!==void 0){var _=nd,d=t;switch(t){case"keypress":if(Da(n)===0)break e;case"keydown":case"keyup":_=UE;break;case"focusin":d="focus",_=Gc;break;case"focusout":d="blur",_=Gc;break;case"beforeblur":case"afterblur":_=Gc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=bE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=VE;break;case g0:case _0:case m0:_=CE;break;case y0:_=WE;break;case"scroll":_=AE;break;case"wheel":_=$E;break;case"copy":case"cut":case"paste":_=ME;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=eg}var m=(e&4)!==0,E=!m&&t==="scroll",p=m?h!==null?h+"Capture":null:h;m=[];for(var g=c,y;g!==null;){y=g;var A=y.stateNode;if(y.tag===5&&A!==null&&(y=A,p!==null&&(A=$s(g,p),A!=null&&m.push(Js(g,A,y)))),E)break;g=g.return}0<m.length&&(h=new _(h,d,null,n,u),f.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",h&&n!==mf&&(d=n.relatedTarget||n.fromElement)&&(fr(d)||d[dn]))break e;if((_||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,_?(d=n.relatedTarget||n.toElement,_=c,d=d?fr(d):null,d!==null&&(E=Mr(d),d!==E||d.tag!==5&&d.tag!==6)&&(d=null)):(_=null,d=c),_!==d)){if(m=Jp,A="onMouseLeave",p="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(m=eg,A="onPointerLeave",p="onPointerEnter",g="pointer"),E=_==null?h:Jr(_),y=d==null?h:Jr(d),h=new m(A,g+"leave",_,n,u),h.target=E,h.relatedTarget=y,A=null,fr(u)===c&&(m=new m(p,g+"enter",d,n,u),m.target=y,m.relatedTarget=E,A=m),E=A,_&&d)t:{for(m=_,p=d,g=0,y=m;y;y=Ur(y))g++;for(y=0,A=p;A;A=Ur(A))y++;for(;0<g-y;)m=Ur(m),g--;for(;0<y-g;)p=Ur(p),y--;for(;g--;){if(m===p||p!==null&&m===p.alternate)break t;m=Ur(m),p=Ur(p)}m=null}else m=null;_!==null&&fg(f,h,_,m,!1),d!==null&&E!==null&&fg(f,E,d,m,!0)}}e:{if(h=c?Jr(c):window,_=h.nodeName&&h.nodeName.toLowerCase(),_==="select"||_==="input"&&h.type==="file")var x=JE;else if(rg(h))if(u0)x=n1;else{x=e1;var I=GE}else(_=h.nodeName)&&_.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(x=t1);if(x&&(x=x(t,c))){c0(f,x,n,u);break e}I&&I(t,h,c),t==="focusout"&&(I=h._wrapperState)&&I.controlled&&h.type==="number"&&hf(h,"number",h.value)}switch(I=c?Jr(c):window,t){case"focusin":(rg(I)||I.contentEditable==="true")&&(qr=I,Af=c,Is=null);break;case"focusout":Is=Af=qr=null;break;case"mousedown":Rf=!0;break;case"contextmenu":case"mouseup":case"dragend":Rf=!1,lg(f,n,u);break;case"selectionchange":if(s1)break;case"keydown":case"keyup":lg(f,n,u)}var O;if(id)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else Zr?a0(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(o0&&n.locale!=="ko"&&(Zr||N!=="onCompositionStart"?N==="onCompositionEnd"&&Zr&&(O=s0()):(Mn=u,td="value"in Mn?Mn.value:Mn.textContent,Zr=!0)),I=nl(c,N),0<I.length&&(N=new Gp(N,t,null,n,u),f.push({event:N,listeners:I}),O?N.data=O:(O=l0(n),O!==null&&(N.data=O)))),(O=YE?KE(t,n):ZE(t,n))&&(c=nl(c,"onBeforeInput"),0<c.length&&(u=new Gp("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=O))}T0(f,e)})}function Js(t,e,n){return{instance:t,listener:e,currentTarget:n}}function nl(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=$s(t,n),s!=null&&r.unshift(Js(t,s,i)),s=$s(t,e),s!=null&&r.push(Js(t,s,i))),t=t.return}return r}function Ur(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function fg(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=$s(n,s),l!=null&&o.unshift(Js(n,l,a))):i||(l=$s(n,s),l!=null&&o.push(Js(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var c1=/\r\n?/g,u1=/\u0000|\uFFFD/g;function hg(t){return(typeof t=="string"?t:""+t).replace(c1,`
`).replace(u1,"")}function Jo(t,e,n){if(e=hg(e),hg(t)!==e&&n)throw Error(D(425))}function rl(){}var bf=null,Pf=null;function xf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cf=typeof setTimeout=="function"?setTimeout:void 0,f1=typeof clearTimeout=="function"?clearTimeout:void 0,dg=typeof Promise=="function"?Promise:void 0,h1=typeof queueMicrotask=="function"?queueMicrotask:typeof dg<"u"?function(t){return dg.resolve(null).then(t).catch(d1)}:Cf;function d1(t){setTimeout(function(){throw t})}function au(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ks(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ks(e)}function Ln(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function pg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Wi=Math.random().toString(36).slice(2),Xt="__reactFiber$"+Wi,Gs="__reactProps$"+Wi,dn="__reactContainer$"+Wi,If="__reactEvents$"+Wi,p1="__reactListeners$"+Wi,g1="__reactHandles$"+Wi;function fr(t){var e=t[Xt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[dn]||n[Xt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=pg(t);t!==null;){if(n=t[Xt])return n;t=pg(t)}return e}t=n,n=t.parentNode}return null}function wo(t){return t=t[Xt]||t[dn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Jr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(D(33))}function fc(t){return t[Gs]||null}var Mf=[],Gr=-1;function Qn(t){return{current:t}}function oe(t){0>Gr||(t.current=Mf[Gr],Mf[Gr]=null,Gr--)}function re(t,e){Gr++,Mf[Gr]=t.current,t.current=e}var Yn={},je=Qn(Yn),Qe=Qn(!1),Sr=Yn;function Ri(t,e){var n=t.type.contextTypes;if(!n)return Yn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Je(t){return t=t.childContextTypes,t!=null}function il(){oe(Qe),oe(je)}function gg(t,e,n){if(je.current!==Yn)throw Error(D(168));re(je,e),re(Qe,n)}function S0(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(D(108,GS(t)||"Unknown",i));return _e({},n,r)}function sl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Yn,Sr=je.current,re(je,t),re(Qe,Qe.current),!0}function _g(t,e,n){var r=t.stateNode;if(!r)throw Error(D(169));n?(t=S0(t,e,Sr),r.__reactInternalMemoizedMergedChildContext=t,oe(Qe),oe(je),re(je,t)):oe(Qe),re(Qe,n)}var an=null,hc=!1,lu=!1;function E0(t){an===null?an=[t]:an.push(t)}function _1(t){hc=!0,E0(t)}function Jn(){if(!lu&&an!==null){lu=!0;var t=0,e=G;try{var n=an;for(G=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}an=null,hc=!1}catch(i){throw an!==null&&(an=an.slice(t+1)),Ky(Qh,Jn),i}finally{G=e,lu=!1}}return null}var ei=[],ti=0,ol=null,al=0,ht=[],dt=0,Er=null,ln=1,cn="";function sr(t,e){ei[ti++]=al,ei[ti++]=ol,ol=t,al=e}function A0(t,e,n){ht[dt++]=ln,ht[dt++]=cn,ht[dt++]=Er,Er=t;var r=ln;t=cn;var i=32-Ct(r)-1;r&=~(1<<i),n+=1;var s=32-Ct(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,ln=1<<32-Ct(e)+i|n<<i|r,cn=s+t}else ln=1<<s|n<<i|r,cn=t}function od(t){t.return!==null&&(sr(t,1),A0(t,1,0))}function ad(t){for(;t===ol;)ol=ei[--ti],ei[ti]=null,al=ei[--ti],ei[ti]=null;for(;t===Er;)Er=ht[--dt],ht[dt]=null,cn=ht[--dt],ht[dt]=null,ln=ht[--dt],ht[dt]=null}var ot=null,it=null,le=!1,Rt=null;function R0(t,e){var n=pt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function mg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ot=t,it=Ln(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ot=t,it=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Er!==null?{id:ln,overflow:cn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=pt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ot=t,it=null,!0):!1;default:return!1}}function Of(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Nf(t){if(le){var e=it;if(e){var n=e;if(!mg(t,e)){if(Of(t))throw Error(D(418));e=Ln(n.nextSibling);var r=ot;e&&mg(t,e)?R0(r,n):(t.flags=t.flags&-4097|2,le=!1,ot=t)}}else{if(Of(t))throw Error(D(418));t.flags=t.flags&-4097|2,le=!1,ot=t}}}function yg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ot=t}function Go(t){if(t!==ot)return!1;if(!le)return yg(t),le=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!xf(t.type,t.memoizedProps)),e&&(e=it)){if(Of(t))throw b0(),Error(D(418));for(;e;)R0(t,e),e=Ln(e.nextSibling)}if(yg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(D(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){it=Ln(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}it=null}}else it=ot?Ln(t.stateNode.nextSibling):null;return!0}function b0(){for(var t=it;t;)t=Ln(t.nextSibling)}function bi(){it=ot=null,le=!1}function ld(t){Rt===null?Rt=[t]:Rt.push(t)}var m1=mn.ReactCurrentBatchConfig;function ss(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(D(309));var r=n.stateNode}if(!r)throw Error(D(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(D(284));if(!n._owner)throw Error(D(290,t))}return t}function ea(t,e){throw t=Object.prototype.toString.call(e),Error(D(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function vg(t){var e=t._init;return e(t._payload)}function P0(t){function e(p,g){if(t){var y=p.deletions;y===null?(p.deletions=[g],p.flags|=16):y.push(g)}}function n(p,g){if(!t)return null;for(;g!==null;)e(p,g),g=g.sibling;return null}function r(p,g){for(p=new Map;g!==null;)g.key!==null?p.set(g.key,g):p.set(g.index,g),g=g.sibling;return p}function i(p,g){return p=Wn(p,g),p.index=0,p.sibling=null,p}function s(p,g,y){return p.index=y,t?(y=p.alternate,y!==null?(y=y.index,y<g?(p.flags|=2,g):y):(p.flags|=2,g)):(p.flags|=1048576,g)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,g,y,A){return g===null||g.tag!==6?(g=gu(y,p.mode,A),g.return=p,g):(g=i(g,y),g.return=p,g)}function l(p,g,y,A){var x=y.type;return x===Kr?u(p,g,y.props.children,A,y.key):g!==null&&(g.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Rn&&vg(x)===g.type)?(A=i(g,y.props),A.ref=ss(p,g,y),A.return=p,A):(A=Wa(y.type,y.key,y.props,null,p.mode,A),A.ref=ss(p,g,y),A.return=p,A)}function c(p,g,y,A){return g===null||g.tag!==4||g.stateNode.containerInfo!==y.containerInfo||g.stateNode.implementation!==y.implementation?(g=_u(y,p.mode,A),g.return=p,g):(g=i(g,y.children||[]),g.return=p,g)}function u(p,g,y,A,x){return g===null||g.tag!==7?(g=yr(y,p.mode,A,x),g.return=p,g):(g=i(g,y),g.return=p,g)}function f(p,g,y){if(typeof g=="string"&&g!==""||typeof g=="number")return g=gu(""+g,p.mode,y),g.return=p,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Wo:return y=Wa(g.type,g.key,g.props,null,p.mode,y),y.ref=ss(p,null,g),y.return=p,y;case Yr:return g=_u(g,p.mode,y),g.return=p,g;case Rn:var A=g._init;return f(p,A(g._payload),y)}if(ys(g)||es(g))return g=yr(g,p.mode,y,null),g.return=p,g;ea(p,g)}return null}function h(p,g,y,A){var x=g!==null?g.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return x!==null?null:a(p,g,""+y,A);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Wo:return y.key===x?l(p,g,y,A):null;case Yr:return y.key===x?c(p,g,y,A):null;case Rn:return x=y._init,h(p,g,x(y._payload),A)}if(ys(y)||es(y))return x!==null?null:u(p,g,y,A,null);ea(p,y)}return null}function _(p,g,y,A,x){if(typeof A=="string"&&A!==""||typeof A=="number")return p=p.get(y)||null,a(g,p,""+A,x);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Wo:return p=p.get(A.key===null?y:A.key)||null,l(g,p,A,x);case Yr:return p=p.get(A.key===null?y:A.key)||null,c(g,p,A,x);case Rn:var I=A._init;return _(p,g,y,I(A._payload),x)}if(ys(A)||es(A))return p=p.get(y)||null,u(g,p,A,x,null);ea(g,A)}return null}function d(p,g,y,A){for(var x=null,I=null,O=g,N=g=0,k=null;O!==null&&N<y.length;N++){O.index>N?(k=O,O=null):k=O.sibling;var U=h(p,O,y[N],A);if(U===null){O===null&&(O=k);break}t&&O&&U.alternate===null&&e(p,O),g=s(U,g,N),I===null?x=U:I.sibling=U,I=U,O=k}if(N===y.length)return n(p,O),le&&sr(p,N),x;if(O===null){for(;N<y.length;N++)O=f(p,y[N],A),O!==null&&(g=s(O,g,N),I===null?x=O:I.sibling=O,I=O);return le&&sr(p,N),x}for(O=r(p,O);N<y.length;N++)k=_(O,p,N,y[N],A),k!==null&&(t&&k.alternate!==null&&O.delete(k.key===null?N:k.key),g=s(k,g,N),I===null?x=k:I.sibling=k,I=k);return t&&O.forEach(function(j){return e(p,j)}),le&&sr(p,N),x}function m(p,g,y,A){var x=es(y);if(typeof x!="function")throw Error(D(150));if(y=x.call(y),y==null)throw Error(D(151));for(var I=x=null,O=g,N=g=0,k=null,U=y.next();O!==null&&!U.done;N++,U=y.next()){O.index>N?(k=O,O=null):k=O.sibling;var j=h(p,O,U.value,A);if(j===null){O===null&&(O=k);break}t&&O&&j.alternate===null&&e(p,O),g=s(j,g,N),I===null?x=j:I.sibling=j,I=j,O=k}if(U.done)return n(p,O),le&&sr(p,N),x;if(O===null){for(;!U.done;N++,U=y.next())U=f(p,U.value,A),U!==null&&(g=s(U,g,N),I===null?x=U:I.sibling=U,I=U);return le&&sr(p,N),x}for(O=r(p,O);!U.done;N++,U=y.next())U=_(O,p,N,U.value,A),U!==null&&(t&&U.alternate!==null&&O.delete(U.key===null?N:U.key),g=s(U,g,N),I===null?x=U:I.sibling=U,I=U);return t&&O.forEach(function(H){return e(p,H)}),le&&sr(p,N),x}function E(p,g,y,A){if(typeof y=="object"&&y!==null&&y.type===Kr&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Wo:e:{for(var x=y.key,I=g;I!==null;){if(I.key===x){if(x=y.type,x===Kr){if(I.tag===7){n(p,I.sibling),g=i(I,y.props.children),g.return=p,p=g;break e}}else if(I.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Rn&&vg(x)===I.type){n(p,I.sibling),g=i(I,y.props),g.ref=ss(p,I,y),g.return=p,p=g;break e}n(p,I);break}else e(p,I);I=I.sibling}y.type===Kr?(g=yr(y.props.children,p.mode,A,y.key),g.return=p,p=g):(A=Wa(y.type,y.key,y.props,null,p.mode,A),A.ref=ss(p,g,y),A.return=p,p=A)}return o(p);case Yr:e:{for(I=y.key;g!==null;){if(g.key===I)if(g.tag===4&&g.stateNode.containerInfo===y.containerInfo&&g.stateNode.implementation===y.implementation){n(p,g.sibling),g=i(g,y.children||[]),g.return=p,p=g;break e}else{n(p,g);break}else e(p,g);g=g.sibling}g=_u(y,p.mode,A),g.return=p,p=g}return o(p);case Rn:return I=y._init,E(p,g,I(y._payload),A)}if(ys(y))return d(p,g,y,A);if(es(y))return m(p,g,y,A);ea(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,g!==null&&g.tag===6?(n(p,g.sibling),g=i(g,y),g.return=p,p=g):(n(p,g),g=gu(y,p.mode,A),g.return=p,p=g),o(p)):n(p,g)}return E}var Pi=P0(!0),x0=P0(!1),ll=Qn(null),cl=null,ni=null,cd=null;function ud(){cd=ni=cl=null}function fd(t){var e=ll.current;oe(ll),t._currentValue=e}function kf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function mi(t,e){cl=t,cd=ni=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qe=!0),t.firstContext=null)}function yt(t){var e=t._currentValue;if(cd!==t)if(t={context:t,memoizedValue:e,next:null},ni===null){if(cl===null)throw Error(D(308));ni=t,cl.dependencies={lanes:0,firstContext:t}}else ni=ni.next=t;return e}var hr=null;function hd(t){hr===null?hr=[t]:hr.push(t)}function C0(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,hd(e)):(n.next=i.next,i.next=n),e.interleaved=n,pn(t,r)}function pn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var bn=!1;function dd(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function I0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function fn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function zn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Q&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,pn(t,n)}return i=r.interleaved,i===null?(e.next=e,hd(r)):(e.next=i.next,i.next=e),r.interleaved=e,pn(t,n)}function Ba(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jh(t,n)}}function Tg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ul(t,e,n,r){var i=t.updateQueue;bn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,_=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var d=t,m=a;switch(h=e,_=n,m.tag){case 1:if(d=m.payload,typeof d=="function"){f=d.call(_,f,h);break e}f=d;break e;case 3:d.flags=d.flags&-65537|128;case 0:if(d=m.payload,h=typeof d=="function"?d.call(_,f,h):d,h==null)break e;f=_e({},f,h);break e;case 2:bn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else _={eventTime:_,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=_,l=f):u=u.next=_,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Rr|=o,t.lanes=o,t.memoizedState=f}}function wg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(D(191,i));i.call(r)}}}var So={},Qt=Qn(So),eo=Qn(So),to=Qn(So);function dr(t){if(t===So)throw Error(D(174));return t}function pd(t,e){switch(re(to,e),re(eo,t),re(Qt,So),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:pf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=pf(e,t)}oe(Qt),re(Qt,e)}function xi(){oe(Qt),oe(eo),oe(to)}function M0(t){dr(to.current);var e=dr(Qt.current),n=pf(e,t.type);e!==n&&(re(eo,t),re(Qt,n))}function gd(t){eo.current===t&&(oe(Qt),oe(eo))}var he=Qn(0);function fl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var cu=[];function _d(){for(var t=0;t<cu.length;t++)cu[t]._workInProgressVersionPrimary=null;cu.length=0}var Ua=mn.ReactCurrentDispatcher,uu=mn.ReactCurrentBatchConfig,Ar=0,pe=null,Re=null,Ce=null,hl=!1,Ms=!1,no=0,y1=0;function Be(){throw Error(D(321))}function md(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ot(t[n],e[n]))return!1;return!0}function yd(t,e,n,r,i,s){if(Ar=s,pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ua.current=t===null||t.memoizedState===null?S1:E1,t=n(r,i),Ms){s=0;do{if(Ms=!1,no=0,25<=s)throw Error(D(301));s+=1,Ce=Re=null,e.updateQueue=null,Ua.current=A1,t=n(r,i)}while(Ms)}if(Ua.current=dl,e=Re!==null&&Re.next!==null,Ar=0,Ce=Re=pe=null,hl=!1,e)throw Error(D(300));return t}function vd(){var t=no!==0;return no=0,t}function $t(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ce===null?pe.memoizedState=Ce=t:Ce=Ce.next=t,Ce}function vt(){if(Re===null){var t=pe.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=Ce===null?pe.memoizedState:Ce.next;if(e!==null)Ce=e,Re=t;else{if(t===null)throw Error(D(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Ce===null?pe.memoizedState=Ce=t:Ce=Ce.next=t}return Ce}function ro(t,e){return typeof e=="function"?e(t):e}function fu(t){var e=vt(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=Re,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ar&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,pe.lanes|=u,Rr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Ot(r,e.memoizedState)||(qe=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,pe.lanes|=s,Rr|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function hu(t){var e=vt(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Ot(s,e.memoizedState)||(qe=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function O0(){}function N0(t,e){var n=pe,r=vt(),i=e(),s=!Ot(r.memoizedState,i);if(s&&(r.memoizedState=i,qe=!0),r=r.queue,Td(D0.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ce!==null&&Ce.memoizedState.tag&1){if(n.flags|=2048,io(9,F0.bind(null,n,r,i,e),void 0,null),Ie===null)throw Error(D(349));Ar&30||k0(n,e,i)}return i}function k0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function F0(t,e,n,r){e.value=n,e.getSnapshot=r,B0(e)&&U0(t)}function D0(t,e,n){return n(function(){B0(e)&&U0(t)})}function B0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ot(t,n)}catch{return!0}}function U0(t){var e=pn(t,1);e!==null&&It(e,t,1,-1)}function Sg(t){var e=$t();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:t},e.queue=t,t=t.dispatch=w1.bind(null,pe,t),[e.memoizedState,t]}function io(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function L0(){return vt().memoizedState}function La(t,e,n,r){var i=$t();pe.flags|=t,i.memoizedState=io(1|e,n,void 0,r===void 0?null:r)}function dc(t,e,n,r){var i=vt();r=r===void 0?null:r;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,r!==null&&md(r,o.deps)){i.memoizedState=io(e,n,s,r);return}}pe.flags|=t,i.memoizedState=io(1|e,n,s,r)}function Eg(t,e){return La(8390656,8,t,e)}function Td(t,e){return dc(2048,8,t,e)}function z0(t,e){return dc(4,2,t,e)}function V0(t,e){return dc(4,4,t,e)}function j0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function W0(t,e,n){return n=n!=null?n.concat([t]):null,dc(4,4,j0.bind(null,e,t),n)}function wd(){}function H0(t,e){var n=vt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&md(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function $0(t,e){var n=vt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&md(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function X0(t,e,n){return Ar&21?(Ot(n,e)||(n=Qy(),pe.lanes|=n,Rr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qe=!0),t.memoizedState=n)}function v1(t,e){var n=G;G=n!==0&&4>n?n:4,t(!0);var r=uu.transition;uu.transition={};try{t(!1),e()}finally{G=n,uu.transition=r}}function Y0(){return vt().memoizedState}function T1(t,e,n){var r=jn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},K0(t))Z0(e,n);else if(n=C0(t,e,n,r),n!==null){var i=$e();It(n,t,r,i),q0(n,e,r)}}function w1(t,e,n){var r=jn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(K0(t))Z0(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Ot(a,o)){var l=e.interleaved;l===null?(i.next=i,hd(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=C0(t,e,i,r),n!==null&&(i=$e(),It(n,t,r,i),q0(n,e,r))}}function K0(t){var e=t.alternate;return t===pe||e!==null&&e===pe}function Z0(t,e){Ms=hl=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function q0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jh(t,n)}}var dl={readContext:yt,useCallback:Be,useContext:Be,useEffect:Be,useImperativeHandle:Be,useInsertionEffect:Be,useLayoutEffect:Be,useMemo:Be,useReducer:Be,useRef:Be,useState:Be,useDebugValue:Be,useDeferredValue:Be,useTransition:Be,useMutableSource:Be,useSyncExternalStore:Be,useId:Be,unstable_isNewReconciler:!1},S1={readContext:yt,useCallback:function(t,e){return $t().memoizedState=[t,e===void 0?null:e],t},useContext:yt,useEffect:Eg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,La(4194308,4,j0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return La(4194308,4,t,e)},useInsertionEffect:function(t,e){return La(4,2,t,e)},useMemo:function(t,e){var n=$t();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$t();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=T1.bind(null,pe,t),[r.memoizedState,t]},useRef:function(t){var e=$t();return t={current:t},e.memoizedState=t},useState:Sg,useDebugValue:wd,useDeferredValue:function(t){return $t().memoizedState=t},useTransition:function(){var t=Sg(!1),e=t[0];return t=v1.bind(null,t[1]),$t().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=pe,i=$t();if(le){if(n===void 0)throw Error(D(407));n=n()}else{if(n=e(),Ie===null)throw Error(D(349));Ar&30||k0(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Eg(D0.bind(null,r,s,t),[t]),r.flags|=2048,io(9,F0.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=$t(),e=Ie.identifierPrefix;if(le){var n=cn,r=ln;n=(r&~(1<<32-Ct(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=no++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=y1++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},E1={readContext:yt,useCallback:H0,useContext:yt,useEffect:Td,useImperativeHandle:W0,useInsertionEffect:z0,useLayoutEffect:V0,useMemo:$0,useReducer:fu,useRef:L0,useState:function(){return fu(ro)},useDebugValue:wd,useDeferredValue:function(t){var e=vt();return X0(e,Re.memoizedState,t)},useTransition:function(){var t=fu(ro)[0],e=vt().memoizedState;return[t,e]},useMutableSource:O0,useSyncExternalStore:N0,useId:Y0,unstable_isNewReconciler:!1},A1={readContext:yt,useCallback:H0,useContext:yt,useEffect:Td,useImperativeHandle:W0,useInsertionEffect:z0,useLayoutEffect:V0,useMemo:$0,useReducer:hu,useRef:L0,useState:function(){return hu(ro)},useDebugValue:wd,useDeferredValue:function(t){var e=vt();return Re===null?e.memoizedState=t:X0(e,Re.memoizedState,t)},useTransition:function(){var t=hu(ro)[0],e=vt().memoizedState;return[t,e]},useMutableSource:O0,useSyncExternalStore:N0,useId:Y0,unstable_isNewReconciler:!1};function Et(t,e){if(t&&t.defaultProps){e=_e({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ff(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:_e({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var pc={isMounted:function(t){return(t=t._reactInternals)?Mr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=$e(),i=jn(t),s=fn(r,i);s.payload=e,n!=null&&(s.callback=n),e=zn(t,s,i),e!==null&&(It(e,t,i,r),Ba(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=$e(),i=jn(t),s=fn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=zn(t,s,i),e!==null&&(It(e,t,i,r),Ba(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=$e(),r=jn(t),i=fn(n,r);i.tag=2,e!=null&&(i.callback=e),e=zn(t,i,r),e!==null&&(It(e,t,r,n),Ba(e,t,r))}};function Ag(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!qs(n,r)||!qs(i,s):!0}function Q0(t,e,n){var r=!1,i=Yn,s=e.contextType;return typeof s=="object"&&s!==null?s=yt(s):(i=Je(e)?Sr:je.current,r=e.contextTypes,s=(r=r!=null)?Ri(t,i):Yn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=pc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Rg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&pc.enqueueReplaceState(e,e.state,null)}function Df(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},dd(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=yt(s):(s=Je(e)?Sr:je.current,i.context=Ri(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Ff(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&pc.enqueueReplaceState(i,i.state,null),ul(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ci(t,e){try{var n="",r=e;do n+=JS(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function du(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Bf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var R1=typeof WeakMap=="function"?WeakMap:Map;function J0(t,e,n){n=fn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){gl||(gl=!0,Yf=r),Bf(t,e)},n}function G0(t,e,n){n=fn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Bf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Bf(t,e),typeof r!="function"&&(Vn===null?Vn=new Set([this]):Vn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function bg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new R1;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=L1.bind(null,t,e,n),e.then(t,t))}function Pg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function xg(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=fn(-1,1),e.tag=2,zn(n,e,1))),n.lanes|=1),t)}var b1=mn.ReactCurrentOwner,qe=!1;function He(t,e,n,r){e.child=t===null?x0(e,null,n,r):Pi(e,t.child,n,r)}function Cg(t,e,n,r,i){n=n.render;var s=e.ref;return mi(e,i),r=yd(t,e,n,r,s,i),n=vd(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gn(t,e,i)):(le&&n&&od(e),e.flags|=1,He(t,e,r,i),e.child)}function Ig(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Cd(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ev(t,e,s,r,i)):(t=Wa(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:qs,n(o,r)&&t.ref===e.ref)return gn(t,e,i)}return e.flags|=1,t=Wn(s,r),t.ref=e.ref,t.return=e,e.child=t}function ev(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(qs(s,r)&&t.ref===e.ref)if(qe=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(qe=!0);else return e.lanes=t.lanes,gn(t,e,i)}return Uf(t,e,n,r,i)}function tv(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},re(ii,tt),tt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,re(ii,tt),tt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,re(ii,tt),tt|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,re(ii,tt),tt|=r;return He(t,e,i,n),e.child}function nv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Uf(t,e,n,r,i){var s=Je(n)?Sr:je.current;return s=Ri(e,s),mi(e,i),n=yd(t,e,n,r,s,i),r=vd(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gn(t,e,i)):(le&&r&&od(e),e.flags|=1,He(t,e,n,i),e.child)}function Mg(t,e,n,r,i){if(Je(n)){var s=!0;sl(e)}else s=!1;if(mi(e,i),e.stateNode===null)za(t,e),Q0(e,n,r),Df(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=yt(c):(c=Je(n)?Sr:je.current,c=Ri(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Rg(e,o,r,c),bn=!1;var h=e.memoizedState;o.state=h,ul(e,r,o,i),l=e.memoizedState,a!==r||h!==l||Qe.current||bn?(typeof u=="function"&&(Ff(e,n,u,r),l=e.memoizedState),(a=bn||Ag(e,n,a,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,I0(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Et(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=yt(l):(l=Je(n)?Sr:je.current,l=Ri(e,l));var _=n.getDerivedStateFromProps;(u=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Rg(e,o,r,l),bn=!1,h=e.memoizedState,o.state=h,ul(e,r,o,i);var d=e.memoizedState;a!==f||h!==d||Qe.current||bn?(typeof _=="function"&&(Ff(e,n,_,r),d=e.memoizedState),(c=bn||Ag(e,n,c,r,h,d,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,d,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,d,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=d),o.props=r,o.state=d,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Lf(t,e,n,r,s,i)}function Lf(t,e,n,r,i,s){nv(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&_g(e,n,!1),gn(t,e,s);r=e.stateNode,b1.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Pi(e,t.child,null,s),e.child=Pi(e,null,a,s)):He(t,e,a,s),e.memoizedState=r.state,i&&_g(e,n,!0),e.child}function rv(t){var e=t.stateNode;e.pendingContext?gg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&gg(t,e.context,!1),pd(t,e.containerInfo)}function Og(t,e,n,r,i){return bi(),ld(i),e.flags|=256,He(t,e,n,r),e.child}var zf={dehydrated:null,treeContext:null,retryLane:0};function Vf(t){return{baseLanes:t,cachePool:null,transitions:null}}function iv(t,e,n){var r=e.pendingProps,i=he.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),re(he,i&1),t===null)return Nf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=mc(o,r,0,null),t=yr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Vf(n),e.memoizedState=zf,t):Sd(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return P1(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Wn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Wn(a,s):(s=yr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Vf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=zf,r}return s=t.child,t=s.sibling,r=Wn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Sd(t,e){return e=mc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ta(t,e,n,r){return r!==null&&ld(r),Pi(e,t.child,null,n),t=Sd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function P1(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=du(Error(D(422))),ta(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=mc({mode:"visible",children:r.children},i,0,null),s=yr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Pi(e,t.child,null,o),e.child.memoizedState=Vf(o),e.memoizedState=zf,s);if(!(e.mode&1))return ta(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(D(419)),r=du(s,r,void 0),ta(t,e,o,r)}if(a=(o&t.childLanes)!==0,qe||a){if(r=Ie,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,pn(t,i),It(r,t,i,-1))}return xd(),r=du(Error(D(421))),ta(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=z1.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,it=Ln(i.nextSibling),ot=e,le=!0,Rt=null,t!==null&&(ht[dt++]=ln,ht[dt++]=cn,ht[dt++]=Er,ln=t.id,cn=t.overflow,Er=e),e=Sd(e,r.children),e.flags|=4096,e)}function Ng(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),kf(t.return,e,n)}function pu(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function sv(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(He(t,e,r.children,n),r=he.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ng(t,n,e);else if(t.tag===19)Ng(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(re(he,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&fl(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),pu(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&fl(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}pu(e,!0,n,null,s);break;case"together":pu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function za(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function gn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Rr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(D(153));if(e.child!==null){for(t=e.child,n=Wn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Wn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function x1(t,e,n){switch(e.tag){case 3:rv(e),bi();break;case 5:M0(e);break;case 1:Je(e.type)&&sl(e);break;case 4:pd(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;re(ll,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(re(he,he.current&1),e.flags|=128,null):n&e.child.childLanes?iv(t,e,n):(re(he,he.current&1),t=gn(t,e,n),t!==null?t.sibling:null);re(he,he.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return sv(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),re(he,he.current),r)break;return null;case 22:case 23:return e.lanes=0,tv(t,e,n)}return gn(t,e,n)}var ov,jf,av,lv;ov=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};jf=function(){};av=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,dr(Qt.current);var s=null;switch(n){case"input":i=uf(t,i),r=uf(t,r),s=[];break;case"select":i=_e({},i,{value:void 0}),r=_e({},r,{value:void 0}),s=[];break;case"textarea":i=df(t,i),r=df(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=rl)}gf(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ws.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ws.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&se("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};lv=function(t,e,n,r){n!==r&&(e.flags|=4)};function os(t,e){if(!le)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ue(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function C1(t,e,n){var r=e.pendingProps;switch(ad(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ue(e),null;case 1:return Je(e.type)&&il(),Ue(e),null;case 3:return r=e.stateNode,xi(),oe(Qe),oe(je),_d(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Go(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Rt!==null&&(qf(Rt),Rt=null))),jf(t,e),Ue(e),null;case 5:gd(e);var i=dr(to.current);if(n=e.type,t!==null&&e.stateNode!=null)av(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(D(166));return Ue(e),null}if(t=dr(Qt.current),Go(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Xt]=e,r[Gs]=s,t=(e.mode&1)!==0,n){case"dialog":se("cancel",r),se("close",r);break;case"iframe":case"object":case"embed":se("load",r);break;case"video":case"audio":for(i=0;i<Ts.length;i++)se(Ts[i],r);break;case"source":se("error",r);break;case"img":case"image":case"link":se("error",r),se("load",r);break;case"details":se("toggle",r);break;case"input":jp(r,s),se("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},se("invalid",r);break;case"textarea":Hp(r,s),se("invalid",r)}gf(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Jo(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Jo(r.textContent,a,t),i=["children",""+a]):Ws.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&se("scroll",r)}switch(n){case"input":Ho(r),Wp(r,s,!0);break;case"textarea":Ho(r),$p(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=rl)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Dy(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Xt]=e,t[Gs]=r,ov(t,e,!1,!1),e.stateNode=t;e:{switch(o=_f(n,r),n){case"dialog":se("cancel",t),se("close",t),i=r;break;case"iframe":case"object":case"embed":se("load",t),i=r;break;case"video":case"audio":for(i=0;i<Ts.length;i++)se(Ts[i],t);i=r;break;case"source":se("error",t),i=r;break;case"img":case"image":case"link":se("error",t),se("load",t),i=r;break;case"details":se("toggle",t),i=r;break;case"input":jp(t,r),i=uf(t,r),se("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=_e({},r,{value:void 0}),se("invalid",t);break;case"textarea":Hp(t,r),i=df(t,r),se("invalid",t);break;default:i=r}gf(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Ly(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&By(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Hs(t,l):typeof l=="number"&&Hs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ws.hasOwnProperty(s)?l!=null&&s==="onScroll"&&se("scroll",t):l!=null&&Xh(t,s,l,o))}switch(n){case"input":Ho(t),Wp(t,r,!1);break;case"textarea":Ho(t),$p(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Xn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?di(t,!!r.multiple,s,!1):r.defaultValue!=null&&di(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=rl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ue(e),null;case 6:if(t&&e.stateNode!=null)lv(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(D(166));if(n=dr(to.current),dr(Qt.current),Go(e)){if(r=e.stateNode,n=e.memoizedProps,r[Xt]=e,(s=r.nodeValue!==n)&&(t=ot,t!==null))switch(t.tag){case 3:Jo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Jo(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Xt]=e,e.stateNode=r}return Ue(e),null;case 13:if(oe(he),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(le&&it!==null&&e.mode&1&&!(e.flags&128))b0(),bi(),e.flags|=98560,s=!1;else if(s=Go(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(D(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(D(317));s[Xt]=e}else bi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ue(e),s=!1}else Rt!==null&&(qf(Rt),Rt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||he.current&1?be===0&&(be=3):xd())),e.updateQueue!==null&&(e.flags|=4),Ue(e),null);case 4:return xi(),jf(t,e),t===null&&Qs(e.stateNode.containerInfo),Ue(e),null;case 10:return fd(e.type._context),Ue(e),null;case 17:return Je(e.type)&&il(),Ue(e),null;case 19:if(oe(he),s=e.memoizedState,s===null)return Ue(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)os(s,!1);else{if(be!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=fl(t),o!==null){for(e.flags|=128,os(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return re(he,he.current&1|2),e.child}t=t.sibling}s.tail!==null&&ve()>Ii&&(e.flags|=128,r=!0,os(s,!1),e.lanes=4194304)}else{if(!r)if(t=fl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),os(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!le)return Ue(e),null}else 2*ve()-s.renderingStartTime>Ii&&n!==1073741824&&(e.flags|=128,r=!0,os(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ve(),e.sibling=null,n=he.current,re(he,r?n&1|2:n&1),e):(Ue(e),null);case 22:case 23:return Pd(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?tt&1073741824&&(Ue(e),e.subtreeFlags&6&&(e.flags|=8192)):Ue(e),null;case 24:return null;case 25:return null}throw Error(D(156,e.tag))}function I1(t,e){switch(ad(e),e.tag){case 1:return Je(e.type)&&il(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xi(),oe(Qe),oe(je),_d(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return gd(e),null;case 13:if(oe(he),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(D(340));bi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return oe(he),null;case 4:return xi(),null;case 10:return fd(e.type._context),null;case 22:case 23:return Pd(),null;case 24:return null;default:return null}}var na=!1,Ve=!1,M1=typeof WeakSet=="function"?WeakSet:Set,V=null;function ri(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ye(t,e,r)}else n.current=null}function Wf(t,e,n){try{n()}catch(r){ye(t,e,r)}}var kg=!1;function O1(t,e){if(bf=el,t=d0(),sd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var _;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(_=f.firstChild)!==null;)h=f,f=_;for(;;){if(f===t)break t;if(h===n&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(_=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=_}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Pf={focusedElem:t,selectionRange:n},el=!1,V=e;V!==null;)if(e=V,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,V=t;else for(;V!==null;){e=V;try{var d=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(d!==null){var m=d.memoizedProps,E=d.memoizedState,p=e.stateNode,g=p.getSnapshotBeforeUpdate(e.elementType===e.type?m:Et(e.type,m),E);p.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(D(163))}}catch(A){ye(e,e.return,A)}if(t=e.sibling,t!==null){t.return=e.return,V=t;break}V=e.return}return d=kg,kg=!1,d}function Os(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Wf(e,n,s)}i=i.next}while(i!==r)}}function gc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Hf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function cv(t){var e=t.alternate;e!==null&&(t.alternate=null,cv(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Xt],delete e[Gs],delete e[If],delete e[p1],delete e[g1])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function uv(t){return t.tag===5||t.tag===3||t.tag===4}function Fg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||uv(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $f(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=rl));else if(r!==4&&(t=t.child,t!==null))for($f(t,e,n),t=t.sibling;t!==null;)$f(t,e,n),t=t.sibling}function Xf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Xf(t,e,n),t=t.sibling;t!==null;)Xf(t,e,n),t=t.sibling}var Ne=null,At=!1;function Tn(t,e,n){for(n=n.child;n!==null;)fv(t,e,n),n=n.sibling}function fv(t,e,n){if(qt&&typeof qt.onCommitFiberUnmount=="function")try{qt.onCommitFiberUnmount(ac,n)}catch{}switch(n.tag){case 5:Ve||ri(n,e);case 6:var r=Ne,i=At;Ne=null,Tn(t,e,n),Ne=r,At=i,Ne!==null&&(At?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(At?(t=Ne,n=n.stateNode,t.nodeType===8?au(t.parentNode,n):t.nodeType===1&&au(t,n),Ks(t)):au(Ne,n.stateNode));break;case 4:r=Ne,i=At,Ne=n.stateNode.containerInfo,At=!0,Tn(t,e,n),Ne=r,At=i;break;case 0:case 11:case 14:case 15:if(!Ve&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Wf(n,e,o),i=i.next}while(i!==r)}Tn(t,e,n);break;case 1:if(!Ve&&(ri(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ye(n,e,a)}Tn(t,e,n);break;case 21:Tn(t,e,n);break;case 22:n.mode&1?(Ve=(r=Ve)||n.memoizedState!==null,Tn(t,e,n),Ve=r):Tn(t,e,n);break;default:Tn(t,e,n)}}function Dg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new M1),e.forEach(function(r){var i=V1.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function St(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ne=a.stateNode,At=!1;break e;case 3:Ne=a.stateNode.containerInfo,At=!0;break e;case 4:Ne=a.stateNode.containerInfo,At=!0;break e}a=a.return}if(Ne===null)throw Error(D(160));fv(s,o,i),Ne=null,At=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ye(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)hv(e,t),e=e.sibling}function hv(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(St(e,t),Lt(t),r&4){try{Os(3,t,t.return),gc(3,t)}catch(m){ye(t,t.return,m)}try{Os(5,t,t.return)}catch(m){ye(t,t.return,m)}}break;case 1:St(e,t),Lt(t),r&512&&n!==null&&ri(n,n.return);break;case 5:if(St(e,t),Lt(t),r&512&&n!==null&&ri(n,n.return),t.flags&32){var i=t.stateNode;try{Hs(i,"")}catch(m){ye(t,t.return,m)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&ky(i,s),_f(a,o);var c=_f(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?Ly(i,f):u==="dangerouslySetInnerHTML"?By(i,f):u==="children"?Hs(i,f):Xh(i,u,f,c)}switch(a){case"input":ff(i,s);break;case"textarea":Fy(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var _=s.value;_!=null?di(i,!!s.multiple,_,!1):h!==!!s.multiple&&(s.defaultValue!=null?di(i,!!s.multiple,s.defaultValue,!0):di(i,!!s.multiple,s.multiple?[]:"",!1))}i[Gs]=s}catch(m){ye(t,t.return,m)}}break;case 6:if(St(e,t),Lt(t),r&4){if(t.stateNode===null)throw Error(D(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(m){ye(t,t.return,m)}}break;case 3:if(St(e,t),Lt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ks(e.containerInfo)}catch(m){ye(t,t.return,m)}break;case 4:St(e,t),Lt(t);break;case 13:St(e,t),Lt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Rd=ve())),r&4&&Dg(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ve=(c=Ve)||u,St(e,t),Ve=c):St(e,t),Lt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(V=t,u=t.child;u!==null;){for(f=V=u;V!==null;){switch(h=V,_=h.child,h.tag){case 0:case 11:case 14:case 15:Os(4,h,h.return);break;case 1:ri(h,h.return);var d=h.stateNode;if(typeof d.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,d.props=e.memoizedProps,d.state=e.memoizedState,d.componentWillUnmount()}catch(m){ye(r,n,m)}}break;case 5:ri(h,h.return);break;case 22:if(h.memoizedState!==null){Ug(f);continue}}_!==null?(_.return=h,V=_):Ug(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Uy("display",o))}catch(m){ye(t,t.return,m)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(m){ye(t,t.return,m)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:St(e,t),Lt(t),r&4&&Dg(t);break;case 21:break;default:St(e,t),Lt(t)}}function Lt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(uv(n)){var r=n;break e}n=n.return}throw Error(D(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Hs(i,""),r.flags&=-33);var s=Fg(t);Xf(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Fg(t);$f(t,a,o);break;default:throw Error(D(161))}}catch(l){ye(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function N1(t,e,n){V=t,dv(t)}function dv(t,e,n){for(var r=(t.mode&1)!==0;V!==null;){var i=V,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||na;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ve;a=na;var c=Ve;if(na=o,(Ve=l)&&!c)for(V=i;V!==null;)o=V,l=o.child,o.tag===22&&o.memoizedState!==null?Lg(i):l!==null?(l.return=o,V=l):Lg(i);for(;s!==null;)V=s,dv(s),s=s.sibling;V=i,na=a,Ve=c}Bg(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,V=s):Bg(t)}}function Bg(t){for(;V!==null;){var e=V;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ve||gc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ve)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Et(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&wg(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}wg(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&Ks(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(D(163))}Ve||e.flags&512&&Hf(e)}catch(h){ye(e,e.return,h)}}if(e===t){V=null;break}if(n=e.sibling,n!==null){n.return=e.return,V=n;break}V=e.return}}function Ug(t){for(;V!==null;){var e=V;if(e===t){V=null;break}var n=e.sibling;if(n!==null){n.return=e.return,V=n;break}V=e.return}}function Lg(t){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{gc(4,e)}catch(l){ye(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){ye(e,i,l)}}var s=e.return;try{Hf(e)}catch(l){ye(e,s,l)}break;case 5:var o=e.return;try{Hf(e)}catch(l){ye(e,o,l)}}}catch(l){ye(e,e.return,l)}if(e===t){V=null;break}var a=e.sibling;if(a!==null){a.return=e.return,V=a;break}V=e.return}}var k1=Math.ceil,pl=mn.ReactCurrentDispatcher,Ed=mn.ReactCurrentOwner,_t=mn.ReactCurrentBatchConfig,Q=0,Ie=null,Ee=null,Fe=0,tt=0,ii=Qn(0),be=0,so=null,Rr=0,_c=0,Ad=0,Ns=null,Ze=null,Rd=0,Ii=1/0,sn=null,gl=!1,Yf=null,Vn=null,ra=!1,On=null,_l=0,ks=0,Kf=null,Va=-1,ja=0;function $e(){return Q&6?ve():Va!==-1?Va:Va=ve()}function jn(t){return t.mode&1?Q&2&&Fe!==0?Fe&-Fe:m1.transition!==null?(ja===0&&(ja=Qy()),ja):(t=G,t!==0||(t=window.event,t=t===void 0?16:i0(t.type)),t):1}function It(t,e,n,r){if(50<ks)throw ks=0,Kf=null,Error(D(185));vo(t,n,r),(!(Q&2)||t!==Ie)&&(t===Ie&&(!(Q&2)&&(_c|=n),be===4&&In(t,Fe)),Ge(t,r),n===1&&Q===0&&!(e.mode&1)&&(Ii=ve()+500,hc&&Jn()))}function Ge(t,e){var n=t.callbackNode;mE(t,e);var r=Ga(t,t===Ie?Fe:0);if(r===0)n!==null&&Kp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Kp(n),e===1)t.tag===0?_1(zg.bind(null,t)):E0(zg.bind(null,t)),h1(function(){!(Q&6)&&Jn()}),n=null;else{switch(Jy(r)){case 1:n=Qh;break;case 4:n=Zy;break;case 16:n=Ja;break;case 536870912:n=qy;break;default:n=Ja}n=wv(n,pv.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function pv(t,e){if(Va=-1,ja=0,Q&6)throw Error(D(327));var n=t.callbackNode;if(yi()&&t.callbackNode!==n)return null;var r=Ga(t,t===Ie?Fe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ml(t,r);else{e=r;var i=Q;Q|=2;var s=_v();(Ie!==t||Fe!==e)&&(sn=null,Ii=ve()+500,mr(t,e));do try{B1();break}catch(a){gv(t,a)}while(1);ud(),pl.current=s,Q=i,Ee!==null?e=0:(Ie=null,Fe=0,e=be)}if(e!==0){if(e===2&&(i=wf(t),i!==0&&(r=i,e=Zf(t,i))),e===1)throw n=so,mr(t,0),In(t,r),Ge(t,ve()),n;if(e===6)In(t,r);else{if(i=t.current.alternate,!(r&30)&&!F1(i)&&(e=ml(t,r),e===2&&(s=wf(t),s!==0&&(r=s,e=Zf(t,s))),e===1))throw n=so,mr(t,0),In(t,r),Ge(t,ve()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(D(345));case 2:or(t,Ze,sn);break;case 3:if(In(t,r),(r&130023424)===r&&(e=Rd+500-ve(),10<e)){if(Ga(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){$e(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Cf(or.bind(null,t,Ze,sn),e);break}or(t,Ze,sn);break;case 4:if(In(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Ct(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=ve()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*k1(r/1960))-r,10<r){t.timeoutHandle=Cf(or.bind(null,t,Ze,sn),r);break}or(t,Ze,sn);break;case 5:or(t,Ze,sn);break;default:throw Error(D(329))}}}return Ge(t,ve()),t.callbackNode===n?pv.bind(null,t):null}function Zf(t,e){var n=Ns;return t.current.memoizedState.isDehydrated&&(mr(t,e).flags|=256),t=ml(t,e),t!==2&&(e=Ze,Ze=n,e!==null&&qf(e)),t}function qf(t){Ze===null?Ze=t:Ze.push.apply(Ze,t)}function F1(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Ot(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function In(t,e){for(e&=~Ad,e&=~_c,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ct(e),r=1<<n;t[n]=-1,e&=~r}}function zg(t){if(Q&6)throw Error(D(327));yi();var e=Ga(t,0);if(!(e&1))return Ge(t,ve()),null;var n=ml(t,e);if(t.tag!==0&&n===2){var r=wf(t);r!==0&&(e=r,n=Zf(t,r))}if(n===1)throw n=so,mr(t,0),In(t,e),Ge(t,ve()),n;if(n===6)throw Error(D(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,or(t,Ze,sn),Ge(t,ve()),null}function bd(t,e){var n=Q;Q|=1;try{return t(e)}finally{Q=n,Q===0&&(Ii=ve()+500,hc&&Jn())}}function br(t){On!==null&&On.tag===0&&!(Q&6)&&yi();var e=Q;Q|=1;var n=_t.transition,r=G;try{if(_t.transition=null,G=1,t)return t()}finally{G=r,_t.transition=n,Q=e,!(Q&6)&&Jn()}}function Pd(){tt=ii.current,oe(ii)}function mr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,f1(n)),Ee!==null)for(n=Ee.return;n!==null;){var r=n;switch(ad(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&il();break;case 3:xi(),oe(Qe),oe(je),_d();break;case 5:gd(r);break;case 4:xi();break;case 13:oe(he);break;case 19:oe(he);break;case 10:fd(r.type._context);break;case 22:case 23:Pd()}n=n.return}if(Ie=t,Ee=t=Wn(t.current,null),Fe=tt=e,be=0,so=null,Ad=_c=Rr=0,Ze=Ns=null,hr!==null){for(e=0;e<hr.length;e++)if(n=hr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}hr=null}return t}function gv(t,e){do{var n=Ee;try{if(ud(),Ua.current=dl,hl){for(var r=pe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}hl=!1}if(Ar=0,Ce=Re=pe=null,Ms=!1,no=0,Ed.current=null,n===null||n.return===null){be=1,so=e,Ee=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Fe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var _=Pg(o);if(_!==null){_.flags&=-257,xg(_,o,a,s,e),_.mode&1&&bg(s,c,e),e=_,l=c;var d=e.updateQueue;if(d===null){var m=new Set;m.add(l),e.updateQueue=m}else d.add(l);break e}else{if(!(e&1)){bg(s,c,e),xd();break e}l=Error(D(426))}}else if(le&&a.mode&1){var E=Pg(o);if(E!==null){!(E.flags&65536)&&(E.flags|=256),xg(E,o,a,s,e),ld(Ci(l,a));break e}}s=l=Ci(l,a),be!==4&&(be=2),Ns===null?Ns=[s]:Ns.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=J0(s,l,e);Tg(s,p);break e;case 1:a=l;var g=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Vn===null||!Vn.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var A=G0(s,a,e);Tg(s,A);break e}}s=s.return}while(s!==null)}yv(n)}catch(x){e=x,Ee===n&&n!==null&&(Ee=n=n.return);continue}break}while(1)}function _v(){var t=pl.current;return pl.current=dl,t===null?dl:t}function xd(){(be===0||be===3||be===2)&&(be=4),Ie===null||!(Rr&268435455)&&!(_c&268435455)||In(Ie,Fe)}function ml(t,e){var n=Q;Q|=2;var r=_v();(Ie!==t||Fe!==e)&&(sn=null,mr(t,e));do try{D1();break}catch(i){gv(t,i)}while(1);if(ud(),Q=n,pl.current=r,Ee!==null)throw Error(D(261));return Ie=null,Fe=0,be}function D1(){for(;Ee!==null;)mv(Ee)}function B1(){for(;Ee!==null&&!lE();)mv(Ee)}function mv(t){var e=Tv(t.alternate,t,tt);t.memoizedProps=t.pendingProps,e===null?yv(t):Ee=e,Ed.current=null}function yv(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=I1(n,e),n!==null){n.flags&=32767,Ee=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{be=6,Ee=null;return}}else if(n=C1(n,e,tt),n!==null){Ee=n;return}if(e=e.sibling,e!==null){Ee=e;return}Ee=e=t}while(e!==null);be===0&&(be=5)}function or(t,e,n){var r=G,i=_t.transition;try{_t.transition=null,G=1,U1(t,e,n,r)}finally{_t.transition=i,G=r}return null}function U1(t,e,n,r){do yi();while(On!==null);if(Q&6)throw Error(D(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(D(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(yE(t,s),t===Ie&&(Ee=Ie=null,Fe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ra||(ra=!0,wv(Ja,function(){return yi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=_t.transition,_t.transition=null;var o=G;G=1;var a=Q;Q|=4,Ed.current=null,O1(t,n),hv(n,t),i1(Pf),el=!!bf,Pf=bf=null,t.current=n,N1(n),cE(),Q=a,G=o,_t.transition=s}else t.current=n;if(ra&&(ra=!1,On=t,_l=i),s=t.pendingLanes,s===0&&(Vn=null),hE(n.stateNode),Ge(t,ve()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(gl)throw gl=!1,t=Yf,Yf=null,t;return _l&1&&t.tag!==0&&yi(),s=t.pendingLanes,s&1?t===Kf?ks++:(ks=0,Kf=t):ks=0,Jn(),null}function yi(){if(On!==null){var t=Jy(_l),e=_t.transition,n=G;try{if(_t.transition=null,G=16>t?16:t,On===null)var r=!1;else{if(t=On,On=null,_l=0,Q&6)throw Error(D(331));var i=Q;for(Q|=4,V=t.current;V!==null;){var s=V,o=s.child;if(V.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(V=c;V!==null;){var u=V;switch(u.tag){case 0:case 11:case 15:Os(8,u,s)}var f=u.child;if(f!==null)f.return=u,V=f;else for(;V!==null;){u=V;var h=u.sibling,_=u.return;if(cv(u),u===c){V=null;break}if(h!==null){h.return=_,V=h;break}V=_}}}var d=s.alternate;if(d!==null){var m=d.child;if(m!==null){d.child=null;do{var E=m.sibling;m.sibling=null,m=E}while(m!==null)}}V=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,V=o;else e:for(;V!==null;){if(s=V,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Os(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,V=p;break e}V=s.return}}var g=t.current;for(V=g;V!==null;){o=V;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,V=y;else e:for(o=g;V!==null;){if(a=V,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:gc(9,a)}}catch(x){ye(a,a.return,x)}if(a===o){V=null;break e}var A=a.sibling;if(A!==null){A.return=a.return,V=A;break e}V=a.return}}if(Q=i,Jn(),qt&&typeof qt.onPostCommitFiberRoot=="function")try{qt.onPostCommitFiberRoot(ac,t)}catch{}r=!0}return r}finally{G=n,_t.transition=e}}return!1}function Vg(t,e,n){e=Ci(n,e),e=J0(t,e,1),t=zn(t,e,1),e=$e(),t!==null&&(vo(t,1,e),Ge(t,e))}function ye(t,e,n){if(t.tag===3)Vg(t,t,n);else for(;e!==null;){if(e.tag===3){Vg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vn===null||!Vn.has(r))){t=Ci(n,t),t=G0(e,t,1),e=zn(e,t,1),t=$e(),e!==null&&(vo(e,1,t),Ge(e,t));break}}e=e.return}}function L1(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=$e(),t.pingedLanes|=t.suspendedLanes&n,Ie===t&&(Fe&n)===n&&(be===4||be===3&&(Fe&130023424)===Fe&&500>ve()-Rd?mr(t,0):Ad|=n),Ge(t,e)}function vv(t,e){e===0&&(t.mode&1?(e=Yo,Yo<<=1,!(Yo&130023424)&&(Yo=4194304)):e=1);var n=$e();t=pn(t,e),t!==null&&(vo(t,e,n),Ge(t,n))}function z1(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),vv(t,n)}function V1(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(D(314))}r!==null&&r.delete(e),vv(t,n)}var Tv;Tv=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Qe.current)qe=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qe=!1,x1(t,e,n);qe=!!(t.flags&131072)}else qe=!1,le&&e.flags&1048576&&A0(e,al,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;za(t,e),t=e.pendingProps;var i=Ri(e,je.current);mi(e,n),i=yd(null,e,r,t,i,n);var s=vd();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Je(r)?(s=!0,sl(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,dd(e),i.updater=pc,e.stateNode=i,i._reactInternals=e,Df(e,r,t,n),e=Lf(null,e,r,!0,s,n)):(e.tag=0,le&&s&&od(e),He(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(za(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=W1(r),t=Et(r,t),i){case 0:e=Uf(null,e,r,t,n);break e;case 1:e=Mg(null,e,r,t,n);break e;case 11:e=Cg(null,e,r,t,n);break e;case 14:e=Ig(null,e,r,Et(r.type,t),n);break e}throw Error(D(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Et(r,i),Uf(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Et(r,i),Mg(t,e,r,i,n);case 3:e:{if(rv(e),t===null)throw Error(D(387));r=e.pendingProps,s=e.memoizedState,i=s.element,I0(t,e),ul(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ci(Error(D(423)),e),e=Og(t,e,r,n,i);break e}else if(r!==i){i=Ci(Error(D(424)),e),e=Og(t,e,r,n,i);break e}else for(it=Ln(e.stateNode.containerInfo.firstChild),ot=e,le=!0,Rt=null,n=x0(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bi(),r===i){e=gn(t,e,n);break e}He(t,e,r,n)}e=e.child}return e;case 5:return M0(e),t===null&&Nf(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,xf(r,i)?o=null:s!==null&&xf(r,s)&&(e.flags|=32),nv(t,e),He(t,e,o,n),e.child;case 6:return t===null&&Nf(e),null;case 13:return iv(t,e,n);case 4:return pd(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Pi(e,null,r,n):He(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Et(r,i),Cg(t,e,r,i,n);case 7:return He(t,e,e.pendingProps,n),e.child;case 8:return He(t,e,e.pendingProps.children,n),e.child;case 12:return He(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,re(ll,r._currentValue),r._currentValue=o,s!==null)if(Ot(s.value,o)){if(s.children===i.children&&!Qe.current){e=gn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=fn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),kf(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(D(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),kf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}He(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,mi(e,n),i=yt(i),r=r(i),e.flags|=1,He(t,e,r,n),e.child;case 14:return r=e.type,i=Et(r,e.pendingProps),i=Et(r.type,i),Ig(t,e,r,i,n);case 15:return ev(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Et(r,i),za(t,e),e.tag=1,Je(r)?(t=!0,sl(e)):t=!1,mi(e,n),Q0(e,r,i),Df(e,r,i,n),Lf(null,e,r,!0,t,n);case 19:return sv(t,e,n);case 22:return tv(t,e,n)}throw Error(D(156,e.tag))};function wv(t,e){return Ky(t,e)}function j1(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pt(t,e,n,r){return new j1(t,e,n,r)}function Cd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function W1(t){if(typeof t=="function")return Cd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Kh)return 11;if(t===Zh)return 14}return 2}function Wn(t,e){var n=t.alternate;return n===null?(n=pt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Wa(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Cd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Kr:return yr(n.children,i,s,e);case Yh:o=8,i|=8;break;case of:return t=pt(12,n,e,i|2),t.elementType=of,t.lanes=s,t;case af:return t=pt(13,n,e,i),t.elementType=af,t.lanes=s,t;case lf:return t=pt(19,n,e,i),t.elementType=lf,t.lanes=s,t;case My:return mc(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Cy:o=10;break e;case Iy:o=9;break e;case Kh:o=11;break e;case Zh:o=14;break e;case Rn:o=16,r=null;break e}throw Error(D(130,t==null?t:typeof t,""))}return e=pt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function yr(t,e,n,r){return t=pt(7,t,r,e),t.lanes=n,t}function mc(t,e,n,r){return t=pt(22,t,r,e),t.elementType=My,t.lanes=n,t.stateNode={isHidden:!1},t}function gu(t,e,n){return t=pt(6,t,null,e),t.lanes=n,t}function _u(t,e,n){return e=pt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function H1(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qc(0),this.expirationTimes=qc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Id(t,e,n,r,i,s,o,a,l){return t=new H1(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=pt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},dd(s),t}function $1(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Sv(t){if(!t)return Yn;t=t._reactInternals;e:{if(Mr(t)!==t||t.tag!==1)throw Error(D(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Je(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(D(171))}if(t.tag===1){var n=t.type;if(Je(n))return S0(t,n,e)}return e}function Ev(t,e,n,r,i,s,o,a,l){return t=Id(n,r,!0,t,i,s,o,a,l),t.context=Sv(null),n=t.current,r=$e(),i=jn(n),s=fn(r,i),s.callback=e??null,zn(n,s,i),t.current.lanes=i,vo(t,i,r),Ge(t,r),t}function yc(t,e,n,r){var i=e.current,s=$e(),o=jn(i);return n=Sv(n),e.context===null?e.context=n:e.pendingContext=n,e=fn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=zn(i,e,o),t!==null&&(It(t,i,o,s),Ba(t,i,o)),o}function yl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Md(t,e){jg(t,e),(t=t.alternate)&&jg(t,e)}function X1(){return null}var Av=typeof reportError=="function"?reportError:function(t){console.error(t)};function Od(t){this._internalRoot=t}vc.prototype.render=Od.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(D(409));yc(t,e,null,null)};vc.prototype.unmount=Od.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;br(function(){yc(null,t,null,null)}),e[dn]=null}};function vc(t){this._internalRoot=t}vc.prototype.unstable_scheduleHydration=function(t){if(t){var e=t0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Cn.length&&e!==0&&e<Cn[n].priority;n++);Cn.splice(n,0,t),n===0&&r0(t)}};function Nd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Tc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Wg(){}function Y1(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=yl(o);s.call(c)}}var o=Ev(e,r,t,0,null,!1,!1,"",Wg);return t._reactRootContainer=o,t[dn]=o.current,Qs(t.nodeType===8?t.parentNode:t),br(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=yl(l);a.call(c)}}var l=Id(t,0,!1,null,null,!1,!1,"",Wg);return t._reactRootContainer=l,t[dn]=l.current,Qs(t.nodeType===8?t.parentNode:t),br(function(){yc(e,l,n,r)}),l}function wc(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=yl(o);a.call(l)}}yc(e,o,t,i)}else o=Y1(n,e,t,i,r);return yl(o)}Gy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=vs(e.pendingLanes);n!==0&&(Jh(e,n|1),Ge(e,ve()),!(Q&6)&&(Ii=ve()+500,Jn()))}break;case 13:br(function(){var r=pn(t,1);if(r!==null){var i=$e();It(r,t,1,i)}}),Md(t,1)}};Gh=function(t){if(t.tag===13){var e=pn(t,134217728);if(e!==null){var n=$e();It(e,t,134217728,n)}Md(t,134217728)}};e0=function(t){if(t.tag===13){var e=jn(t),n=pn(t,e);if(n!==null){var r=$e();It(n,t,e,r)}Md(t,e)}};t0=function(){return G};n0=function(t,e){var n=G;try{return G=t,e()}finally{G=n}};yf=function(t,e,n){switch(e){case"input":if(ff(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=fc(r);if(!i)throw Error(D(90));Ny(r),ff(r,i)}}}break;case"textarea":Fy(t,n);break;case"select":e=n.value,e!=null&&di(t,!!n.multiple,e,!1)}};jy=bd;Wy=br;var K1={usingClientEntryPoint:!1,Events:[wo,Jr,fc,zy,Vy,bd]},as={findFiberByHostInstance:fr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Z1={bundleType:as.bundleType,version:as.version,rendererPackageName:as.rendererPackageName,rendererConfig:as.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Xy(t),t===null?null:t.stateNode},findFiberByHostInstance:as.findFiberByHostInstance||X1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ia=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ia.isDisabled&&ia.supportsFiber)try{ac=ia.inject(Z1),qt=ia}catch{}}lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K1;lt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nd(e))throw Error(D(200));return $1(t,e,null,n)};lt.createRoot=function(t,e){if(!Nd(t))throw Error(D(299));var n=!1,r="",i=Av;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Id(t,1,!1,null,null,n,!1,r,i),t[dn]=e.current,Qs(t.nodeType===8?t.parentNode:t),new Od(e)};lt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(D(188)):(t=Object.keys(t).join(","),Error(D(268,t)));return t=Xy(e),t=t===null?null:t.stateNode,t};lt.flushSync=function(t){return br(t)};lt.hydrate=function(t,e,n){if(!Tc(e))throw Error(D(200));return wc(null,t,e,!0,n)};lt.hydrateRoot=function(t,e,n){if(!Nd(t))throw Error(D(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=Av;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ev(e,null,t,1,n??null,i,!1,s,o),t[dn]=e.current,Qs(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new vc(e)};lt.render=function(t,e,n){if(!Tc(e))throw Error(D(200));return wc(null,t,e,!1,n)};lt.unmountComponentAtNode=function(t){if(!Tc(t))throw Error(D(40));return t._reactRootContainer?(br(function(){wc(null,null,t,!1,function(){t._reactRootContainer=null,t[dn]=null})}),!0):!1};lt.unstable_batchedUpdates=bd;lt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Tc(n))throw Error(D(200));if(t==null||t._reactInternals===void 0)throw Error(D(38));return wc(t,e,n,!1,r)};lt.version="18.3.1-next-f1338f8080-20240426";function Rv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Rv)}catch(t){console.error(t)}}Rv(),Ry.exports=lt;var q1=Ry.exports,bv,Hg=q1;bv=Hg.createRoot,Hg.hydrateRoot;function vl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const kd=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),$g=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$g&&parseFloat($g[1]);const sa=globalThis,Lr=globalThis.process||{},Q1=globalThis.navigator||{};function Pv(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Gn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||Pv()}function J1(t){return!t&&!Gn()?"Node":Pv(t)?"Electron":(t||Q1.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const xv="4.0.7";function G1(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class eA{constructor(e,n,r="sessionStorage"){this.storage=G1(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function tA(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function nA(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Tl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Tl||(Tl={}));const rA=10;function Xg(t){return typeof t!="string"?t:(t=t.toUpperCase(),Tl[t]||Tl.WHITE)}function iA(t,e,n){return!Gn&&typeof t=="string"&&(e&&(t=`\x1B[${Xg(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Xg(n)+rA}m${t}\x1B[49m`)),t}function sA(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Fd(t,e){if(!t)throw new Error(e||"Assertion failed")}function zr(){var e,n,r;let t;if(Gn()&&sa.performance)t=(n=(e=sa==null?void 0:sa.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Lr){const i=(r=Lr==null?void 0:Lr.hrtime)==null?void 0:r.call(Lr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Vr={debug:Gn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},oA={enabled:!0,level:0};function jr(){}const Yg={},Kg={once:!0};class Eo{constructor({id:e}={id:""}){this.VERSION=xv,this._startTs=zr(),this._deltaTs=zr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new eA(`__probe-${this.id}__`,oA),this.timeStamp(`${this.id} started`),sA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((zr()-this._startTs).toPrecision(10))}getDelta(){return Number((zr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Vr.warn,arguments,Kg)}error(e){return this._getLogFunction(0,e,Vr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Vr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Vr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Vr.debug||Vr.info,arguments,Kg)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||jr,r&&[r],{tag:lA(n)}):jr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||jr)}group(e,n,r={collapsed:!1}){const i=Zg({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||jr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Cv(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=Zg({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Fd(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=zr();const o=s.tag||s.message;if(s.once&&o)if(!Yg[o])Yg[o]=zr();else return jr;return n=aA(this.id,s.message,s),r.bind(console,n,...s.args)}return jr}}Eo.VERSION=xv;function Cv(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Fd(Number.isFinite(e)&&e>=0),e}function Zg(t){const{logLevel:e,message:n}=t;t.logLevel=Cv(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Fd(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function aA(t,e,n){if(typeof e=="string"){const r=n.time?nA(tA(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=iA(e,n.color,n.background)}return e}function lA(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const mu="4.3.0",cA=mu[0]>="0"&&mu[0]<="9"?`v${mu}`:"";function uA(){const t=new Eo({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=cA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const fA=uA();function hA(t,e){return Iv(t||{},e)}function Iv(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=Iv(r[i]||{},e[i],n+1):r[i]=e[i];return r}const dA="latest";function pA(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.0"),globalThis._loadersgl_.version}const gA=pA();function Kn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const vr=typeof process!="object"||String(process)!=="[object process]"||process.browser,_A=typeof window<"u"&&typeof window.orientation<"u",qg=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qg&&parseFloat(qg[1]);class mA{constructor(e,n){T(this,"name");T(this,"workerThread");T(this,"isRunning",!0);T(this,"result");T(this,"_resolve",()=>{});T(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Kn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Kn(this.isRunning),this.isRunning=!1,this._reject(e)}}class yu{terminate(){}}const vu=new Map;function yA(t){Kn(t.source&&!t.url||!t.source&&t.url);let e=vu.get(t.source||t.url);return e||(t.url&&(e=vA(t.url),vu.set(t.url,e)),t.source&&(e=Mv(t.source),vu.set(t.source,e))),Kn(e),e}function vA(t){if(!t.startsWith("http"))return t;const e=TA(t);return Mv(e)}function Mv(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function TA(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Ov(t,e=!0,n){const r=n||new Set;if(t){if(Qg(t))r.add(t);else if(Qg(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)Ov(t[i],e,r)}}return n===void 0?Array.from(r):[]}function Qg(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Tu=()=>{};class Qf{constructor(e){T(this,"name");T(this,"source");T(this,"url");T(this,"terminated",!1);T(this,"worker");T(this,"onMessage");T(this,"onError");T(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Kn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Tu,this.onError=s=>console.log(s),this.worker=vr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&vr||typeof yu<"u"&&!vr}destroy(){this.onMessage=Tu,this.onError=Tu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||Ov(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=yA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new yu(r,{eval:!1})}else if(this.source)e=new yu(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class wA{constructor(e){T(this,"name","unnamed");T(this,"source");T(this,"url");T(this,"maxConcurrency",1);T(this,"maxMobileConcurrency",1);T(this,"onDebug",()=>{});T(this,"reuseWorkers",!0);T(this,"props",{});T(this,"jobQueue",[]);T(this,"idleQueue",[]);T(this,"count",0);T(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Qf.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new mA(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!vr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Qf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _A?this.maxMobileConcurrency:this.maxConcurrency}}const SA={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},xn=class xn{constructor(e){T(this,"props");T(this,"workerPools",new Map);this.props={...SA},this.setProps(e),this.workerPools=new Map}static isSupported(){return Qf.isSupported()}static getWorkerFarm(e={}){return xn._workerFarm=xn._workerFarm||new xn({}),xn._workerFarm.setProps(e),xn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new wA({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};T(xn,"_workerFarm");let wl=xn;function EA(t,e={}){const n=e[t.id]||{},r=vr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(vr?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=dA);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Kn(i),i}function AA(t,e=gA){Kn(t,"no worker provided");const n=t.version;return!(!e||!n)}function RA(t,e){return!wl.isSupported()||!vr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function bA(t,e,n,r,i){const s=t.id,o=EA(t,n),l=wl.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",PA.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function PA(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function xA(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function CA(...t){return IA(t)}function IA(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function MA(t){const e=[];for await(const n of t)e.push(n);return CA(...e)}function Jg(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Gg{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Jg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Jg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Sc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Gg?i=e:i=new Gg(n,r),this.stats[n]=i),i}}let OA="";const e_={};function NA(t){for(const e in e_)if(t.startsWith(e)){const n=e_[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${OA}${t}`),t}function kA(t){return t&&typeof t=="object"&&t.isBuffer}function Nv(t){if(kA(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function kv(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function FA(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const DA=t=>typeof t=="boolean",Fs=t=>typeof t=="function",Ao=t=>t!==null&&typeof t=="object",t_=t=>Ao(t)&&t.constructor==={}.constructor,BA=t=>!!t&&typeof t[Symbol.iterator]=="function",UA=t=>t&&typeof t[Symbol.asyncIterator]=="function",Or=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Nr=t=>typeof Blob<"u"&&t instanceof Blob,LA=t=>t&&typeof t=="object"&&t.isBuffer,zA=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Ao(t)&&Fs(t.tee)&&Fs(t.cancel)&&Fs(t.getReader),VA=t=>Ao(t)&&Fs(t.read)&&Fs(t.pipe)&&DA(t.readable),Fv=t=>zA(t)||VA(t);class jA extends Error{constructor(n,r){super(n);T(this,"reason");T(this,"url");T(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const WA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,HA=/^([-\w.]+\/[-\w.+]+)/;function n_(t,e){return t.toLowerCase()===e.toLowerCase()}function $A(t){const e=HA.exec(t);return e?e[1]:t}function r_(t){const e=WA.exec(t);return e?e[1]:""}const Dv=/\?.*/;function XA(t){const e=t.match(Dv);return e&&e[0]}function Dd(t){return t.replace(Dv,"")}function YA(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Ec(t){return Or(t)?t.url:Nr(t)?t.name||"":typeof t=="string"?t:""}function Bd(t){if(Or(t)){const e=t,n=e.headers.get("content-type")||"",r=Dd(e.url);return $A(n)||r_(r)}return Nr(t)?t.type||"":typeof t=="string"?r_(t):""}function KA(t){return Or(t)?t.headers["content-length"]||-1:Nr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function Bv(t){if(Or(t))return t;const e={},n=KA(t);n>=0&&(e["content-length"]=String(n));const r=Ec(t),i=Bd(t);i&&(e["content-type"]=i);const s=await QA(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function ZA(t){if(!t.ok)throw await qA(t)}async function qA(t){const e=YA(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new jA(n,r)}async function QA(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${JA(n)}`}return null}function JA(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function GA(t){return!eR(t)&&!tR(t)}function eR(t){return t.startsWith("http:")||t.startsWith("https:")}function tR(t){return t.startsWith("data:")}async function i_(t,e){var n,r;if(typeof t=="string"){const i=NA(t);return GA(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await Bv(t)}const s_=new Eo({id:"loaders.gl"});class nR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class rR{constructor(){T(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Uv={fetch:null,mimeType:void 0,nothrow:!1,log:new rR,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:kd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},iR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Lv(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function zv(){const t=Lv();return t.globalOptions=t.globalOptions||{...Uv},t.globalOptions}function sR(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],oR(t,n),lR(e,t,r)}function oR(t,e){o_(t,null,Uv,iR,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};o_(r,n.id,i,s,e)}}function o_(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&Ao(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)s_.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const f=aR(a,i);s_.warn(`${s} loader option '${o}${a}' not recognized. ${f}`)()}}}}function aR(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function lR(t,e,n){const i={...t.options||{}};return cR(i,n),i.log===null&&(i.log=new nR),a_(i,zv()),a_(i,e),i}function a_(t,e){for(const n in e)if(n in e){const r=e[n];t_(r)&&t_(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function cR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ud(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Ld(t){vl(t,"null loader"),vl(Ud(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Vv=()=>{const t=Lv();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function uR(t){const e=Vv();t=Array.isArray(t)?t:[t];for(const n of t){const r=Ld(n);e.find(i=>r===i)||e.unshift(r)}}function fR(){return Vv()}const hR=/\.([^.]+)$/;async function dR(t,e=[],n,r){if(!jv(t))return null;let i=l_(t,e,{...n,nothrow:!0},r);if(i)return i;if(Nr(t)&&(t=await t.slice(0,10).arrayBuffer(),i=l_(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(Wv(t));return i}function l_(t,e=[],n,r){if(!jv(t))return null;if(e&&!Array.isArray(e))return Ld(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...fR()),gR(i);const s=pR(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(Wv(t));return s}function pR(t,e,n,r){const i=Ec(t),s=Bd(t),o=Dd(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=wu(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||_R(e,o),l=l||(a?`matched url ${o}`:""),a=a||wu(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||yR(e,t),l=l||(a?`matched initial data ${Hv(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||wu(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&fA.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function jv(t){return!(t instanceof Response&&t.status===204)}function Wv(t){const e=Ec(t),n=Bd(t);let r="No valid loader found (";r+=e?`${kv(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?Hv(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function gR(t){for(const e of t)Ld(e)}function _R(t,e){const n=e&&hR.exec(e),r=n&&n[1];return r?mR(t,r):null}function mR(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function wu(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>n_(e,i))||n_(e,`application/x.${r.id}`))return r;return null}function yR(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(vR(e,n))return n}else if(ArrayBuffer.isView(e)){if(c_(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&c_(e,0,n))return n;return null}function vR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function c_(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>TR(t,e,n,i))}function TR(t,e,n,r){if(r instanceof ArrayBuffer)return xA(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=Jf(t,e,r.length);return r===i;default:return!1}}function Hv(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Jf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Jf(t,0,e):""}function Jf(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const wR=256*1024;function*SR(t,e){const n=(e==null?void 0:e.chunkSize)||wR;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const ER=256*1024;function*AR(t,e={}){const{chunkSize:n=ER}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const RR=1024*1024;async function*bR(t,e){const n=(e==null?void 0:e.chunkSize)||RR;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function u_(t,e){return kd?PR(t,e):xR(t)}async function*PR(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield Nv(o)}}catch{n.releaseLock()}}async function*xR(t,e){for await(const n of t)yield Nv(n)}function CR(t,e){if(typeof t=="string")return SR(t,e);if(t instanceof ArrayBuffer)return AR(t,e);if(Nr(t))return bR(t,e);if(Fv(t))return u_(t,e);if(Or(t))return u_(t.body,e);throw new Error("makeIterator")}const $v="Cannot convert supplied data type";function IR(t,e,n){if(e.text&&typeof t=="string")return t;if(LA(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error($v)}async function MR(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return IR(t,e);if(Nr(t)&&(t=await Bv(t)),Or(t)){const i=t;return await ZA(i),e.binary?await i.arrayBuffer():await i.text()}if(Fv(t)&&(t=CR(t,n)),BA(t)||UA(t))return MA(t);throw new Error($v)}function Xv(t,e){const n=zv(),r=t||n;return typeof r.fetch=="function"?r.fetch:Ao(r.fetch)?i=>i_(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:i_}function OR(t,e,n){if(n)return n;const r={fetch:Xv(e,t),...t};if(r.url){const i=Dd(r.url);r.baseUrl=i,r.queryString=XA(r.url),r.filename=kv(i),r.baseUrl=FA(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function NR(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Sl(t,e,n,r){e&&!Array.isArray(e)&&!Ud(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Ec(t),o=NR(e,r),a=await dR(t,o,n);return a?(n=sR(n,a,o,i),r=OR({url:i,_parse:Sl,loaders:o},n,r||null),await kR(a,t,n,r)):null}async function kR(t,e,n,r){if(AA(t),n=hA(t.options,n),Or(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:f}=s,h=Object.fromEntries(s.headers.entries());r.response={headers:h,ok:o,redirected:a,status:l,statusText:c,type:u,url:f}}e=await MR(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(RA(t,n))return await bA(t,e,n,r,Sl);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Kn(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function El(t,e,n,r){let i,s;!Array.isArray(e)&&!Ud(e)?(i=[],s=e):(i=e,s=n);const o=Xv(s);let a=t;return typeof t=="string"&&(a=await o(t)),Nr(t)&&(a=await o(t)),Array.isArray(i)?await Sl(a,i,s):await Sl(a,i,s)}const FR="4.3.0";var fy;const DR=(fy=globalThis.loaders)==null?void 0:fy.parseImageNode,Gf=typeof Image<"u",eh=typeof ImageBitmap<"u",BR=!!DR,th=kd?!0:BR;function UR(t){switch(t){case"auto":return eh||Gf||th;case"imagebitmap":return eh;case"image":return Gf;case"data":return th;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function LR(){if(eh)return"imagebitmap";if(Gf)return"image";if(th)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function zR(t){const e=jR(t);if(!e)throw new Error("Not an image");return e}function VR(t){switch(zR(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function jR(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const WR=/^data:image\/svg\+xml/,HR=/\.svg((\?|#).*)?$/;function zd(t){return t&&(WR.test(t)||HR.test(t))}function $R(t,e){if(zd(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Yv(t,e)}function Yv(t,e){if(zd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Kv(t,e,n){const r=$R(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await XR(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function XR(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const YR={};let f_=!0;async function KR(t,e,n){let r;zd(n)?r=await Kv(t,e,n):r=Yv(t,n);const i=e&&e.imagebitmap;return await ZR(r,i)}async function ZR(t,e=null){if((qR(e)||!f_)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),f_=!1}return await createImageBitmap(t)}function qR(t){for(const e in t||YR)return!1;return!0}function QR(t){return!t3(t,"ftyp",4)||!(t[8]&96)?null:JR(t)}function JR(t){switch(GR(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function GR(t,e,n){return String.fromCharCode(...t.slice(e,n))}function e3(t){return[...t].map(e=>e.charCodeAt(0))}function t3(t,e,n=0){const r=e3(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Yt=!1,Ds=!0;function Zv(t){const e=Ro(t);return r3(e)||o3(e)||i3(e)||s3(e)||n3(e)}function n3(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=QR(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function r3(t){const e=Ro(t);return e.byteLength>=24&&e.getUint32(0,Yt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yt),height:e.getUint32(20,Yt)}:null}function i3(t){const e=Ro(t);return e.byteLength>=10&&e.getUint32(0,Yt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ds),height:e.getUint16(8,Ds)}:null}function s3(t){const e=Ro(t);return e.byteLength>=14&&e.getUint16(0,Yt)===16973&&e.getUint32(2,Ds)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ds),height:e.getUint32(22,Ds)}:null}function o3(t){const e=Ro(t);if(!(e.byteLength>=3&&e.getUint16(0,Yt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=a3();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Yt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Yt),width:e.getUint16(s+7,Yt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Yt)}return null}function a3(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ro(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function l3(t,e){var i;const{mimeType:n}=Zv(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return vl(r),await r(t,n)}async function c3(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=u3(i);let a;switch(o){case"imagebitmap":a=await KR(t,e,s);break;case"image":a=await Kv(t,e,s);break;case"data":a=await l3(t);break;default:vl(!1)}return i==="data"&&(a=VR(a)),a}function u3(t){switch(t){case"auto":case"data":return LR();default:return UR(t),t}}const f3=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],h3=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],d3={image:{type:"auto",decode:!0}},p3={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:FR,mimeTypes:h3,extensions:f3,parse:c3,tests:[t=>!!Zv(new DataView(t))],options:d3},g3=new Eo({id:"deck"}),J=g3;let nh={};function _3(t){nh=t}function ze(t,e,n,r){J.level>0&&nh[t]&&nh[t].call(null,e,n,r)}function m3(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const y3={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:m3,parseTextSync:JSON.parse};function v3(){const t="9.0.33",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(J.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:J,_registerLoggers:_3},uR([y3,[p3,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const T3=v3();function pr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Su={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function w3(t){const e={};for(const[n,r]of Object.entries(t))e[n]=E3(r);return e}function S3(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&pr(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function E3(t){let e=h_(t);if(e!=="object")return{value:t,...Su[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Su[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=h_(t.value),{...t,...Su[e],type:e}):{type:"object",value:null};throw new Error("props")}function h_(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const A3=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,R3=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,b3={vertex:A3,fragment:R3},d_=/void\s+main\s*\([^)]*\)\s*\{\n?/,p_=/}\n?[^{}]*$/,Eu=[],Ha="__LUMA_INJECT_DECLARATIONS__";function P3(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=x3(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function x3(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Al(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Eu.length=o.length;for(let l=0,c=o.length;l<c;++l)Eu[l]=o[l].injection;const a=`${Eu.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Ha,a));break;case"vs:#main-start":i&&(t=t.replace(d_,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(p_,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Ha,a));break;case"fs:#main-start":i||(t=t.replace(d_,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(p_,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ha,""),r&&(t=t.replace(/\}\s*$/,s=>s+b3[e])),t}let C3=1;class gr{constructor(e){T(this,"name");T(this,"vs");T(this,"fs");T(this,"getModuleUniforms");T(this,"dependencies");T(this,"deprecations");T(this,"defines");T(this,"injections");T(this,"uniforms",{});T(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:l,deprecations:c=[],defines:u={},inject:f={}}=e;pr(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=l,this.dependencies=gr.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=u,this.injections=P3(f),this.uniformTypes=o,a&&(this.uniforms=w3(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof gr)return n;pr(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${C3++}`);const r=new gr(n);return r.dependencies=gr.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:pr(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):S3(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&pr(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function g_(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=__(t.platformInfo,t.vs);let n;return t.fs&&(n=__(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function __(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Ac(t){const e=gr.instantiateModules(t);return I3(e)}function I3(t){const e={},n={};return qv({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function qv(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&qv({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function M3(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function O3(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=m_(t,N3),t;case"fragment":return t=m_(t,k3),t;default:throw new Error(e)}}const Qv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],N3=[...Qv,[rh("attribute"),"in $1"],[rh("varying"),"out $1"]],k3=[...Qv,[rh("varying"),"in $1"]];function m_(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function rh(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Jv(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function Gv(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function F3(t,e){return{name:D3(t,e),language:"glsl",version:B3(t)}}function D3(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function B3(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const eT=`

${Ha}
`,U3=`precision highp float;
`;function L3(t){const e=Ac(t.modules||[]);return{source:ih(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Vd(e)}}function z3(t){const e=Ac(t.modules||[]);return{vs:ih(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:ih(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Vd(e)}}function V3(t){const{vs:e,fs:n}=t,r=Ac(t.modules||[]);return{vs:y_(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:y_(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Vd(r)}}function ih(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;pr(typeof n=="string","shader source must be a string");const l=n;let c="";const u=Gv(s),f={},h={},_={};for(const m in o){const E=typeof o[m]=="string"?{injection:o[m],order:0}:o[m],p=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(p){const g=p[2],y=p[3];g?y==="decl"?h[m]=[E]:_[m]=[E]:f[m]=[E]}else _[m]=[E]}const d=t.type!=="webgpu"?i:[];for(const m of d){a&&m.checkDeprecations(l,a);const E=m.getModuleSource(r,"wgsl");c+=E;const p=m.injections[r];for(const g in p){const y=/^(v|f)s:#([\w-]+)$/.exec(g);if(y){const x=y[2]==="decl"?h:_;x[g]=x[g]||[],x[g].push(p[g])}else f[g]=f[g]||[],f[g].push(p[g])}}return c+=eT,c=Al(c,r,h),c+=Jv(u[r],f),c+=l,c=Al(c,r,_),c}function y_(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=e;pr(typeof r=="string","shader source must be a string");const h=s==="glsl"?F3(r).version:-1,_=t.shaderLanguageVersion,d=h===100?"#version 100":"#version 300 es",E=r.split(`
`).slice(1).join(`
`),p={};o.forEach(O=>{Object.assign(p,O.getDefines())}),Object.assign(p,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?`${d}

// ----- PROLOGUE -------------------------
${j3({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${M3(t)}
${i==="fragment"?U3:""}

// ----- APPLICATION DEFINES -------------------------

${W3(p)}

`:`${d}
`;break}const y=Gv(l),A={},x={},I={};for(const O in c){const N=typeof c[O]=="string"?{injection:c[O],order:0}:c[O],k=/^(v|f)s:(#)?([\w-]+)$/.exec(O);if(k){const U=k[2],j=k[3];U?j==="decl"?x[O]=[N]:I[O]=[N]:A[O]=[N]}else I[O]=[N]}for(const O of o){f&&O.checkDeprecations(E,f);const N=O.getModuleSource(i);g+=N;const k=O.injections[i];for(const U in k){const j=/^(v|f)s:#([\w-]+)$/.exec(U);if(j){const W=j[2]==="decl"?x:I;W[U]=W[U]||[],W[U].push(k[U])}else A[U]=A[U]||[],A[U].push(k[U])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=eT,g=Al(g,i,x),g+=Jv(y[i],A),g+=E,g=Al(g,i,I),s==="glsl"&&h!==_&&(g=O3(g,i)),g.trim()}function Vd(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function j3(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function W3(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const cr=class cr{constructor(){T(this,"_hookFunctions",[]);T(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return cr.defaultShaderAssembler=cr.defaultShaderAssembler||new cr,cr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=g_(e);return{...L3({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=g_(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?z3({platformInfo:s,...n,modules:r,hookFunctions:i}):V3({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,gr.instantiateModules(n)}};T(cr,"defaultShaderAssembler");let Rl=cr;const H3=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,$3=`#version 300 es
${H3}`;function X3(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return $3;if(!n)throw new Error("inputChannels");const i=Y3(n),s=K3(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function Y3(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function K3(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const B=new Eo({id:"luma.gl"});class Z3{constructor(){T(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Sc({id:e})),this.stats.get(e)}}const jd=new Z3;function q3(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Gn()&&B.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:B,stats:jd}),t}const Q3=q3();function J3(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function oo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:J3(t)}const Au={};function kr(t="id"){Au[t]=Au[t]||1;const e=Au[t]++;return`${t}-${e}`}function bl(t){let e=!0;for(const n in t){e=!1;break}return e}var rf;let ne=(rf=class{constructor(e,n,r){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"_device");T(this,"destroyed",!1);T(this,"allocatedBytes",0);T(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=G3(n,r);const i=this.props.id!=="undefined"?this.props.id:kr(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},T(rf,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),rf);function G3(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Oe=class Oe extends ne{constructor(n,r){const i={...r};(r.usage||0)&Oe.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,Oe.defaultProps);T(this,"usage");T(this,"indexType");T(this,"updateTimestamp");T(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Oe.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};T(Oe,"defaultProps",{...ne.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),T(Oe,"MAP_READ",1),T(Oe,"MAP_WRITE",2),T(Oe,"COPY_SRC",4),T(Oe,"COPY_DST",8),T(Oe,"INDEX",16),T(Oe,"VERTEX",32),T(Oe,"UNIFORM",64),T(Oe,"STORAGE",128),T(Oe,"INDIRECT",256),T(Oe,"QUERY_RESOLVE",512),T(Oe,"DEBUG_DATA_MAX_LENGTH",32);let ce=Oe;function tT(t){const e=v_[t],n=eb(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:v_[t],byteLength:n,integer:i,signed:s,normalized:r}}function eb(t){return tb[t]}const v_={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},tb={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},nb=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],rb=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function ib(t){return nb.some(e=>t.startsWith(e))}function nT(t){const e=rb.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=tT(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return ob(t)}const sb={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function ob(t){var n;const e=sb[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class ab{}class lb{constructor(e=[],n){T(this,"features");T(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Vs=class Vs{constructor(e){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"statsManager",jd);T(this,"_lumaData",{});T(this,"timestamp",0);this.props={...Vs.defaultProps,...e},this.id=this.props.id||kr(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return ib(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&ce.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":B.warn("indices buffer content must be of integer type")()),n}};T(Vs,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!B.get("debug"),spector:!!(B.get("spector")||B.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>B.error(e.message)}),T(Vs,"VERSION",Q3);let Mi=Vs;function ie(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const ls=new Map,hi=class hi{static registerDevices(e){for(const n of e)ie(n.type&&n.isSupported&&n.create),ls.set(n.type,n)}static getAvailableDevices(){return Array.from(ls).map(e=>e.type)}static getSupportedDevices(){return Array.from(ls).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Mi.defaultProps,e)}static async attachDevice(e){const n=T_(e.devices)||ls;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var s,o;e={...hi.defaultProps,...e},e.gl&&(e.type="webgl");const n=T_(e.devices)||ls;let r,i;switch(e.type){case"webgpu":if(r=n.get("webgpu"),r)return await r.create(e);break;case"webgl":if(i=n.get("webgl"),i)return await i.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=n.get("webgpu"),(s=r==null?void 0:r.isSupported)!=null&&s.call(r))return await r.create(e);if(i=n.get("webgl"),(o=i==null?void 0:i.isSupported)!=null&&o.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,i){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(r,i)}}};T(hi,"defaultProps",{...Mi.defaultProps,type:"best-available",devices:void 0}),T(hi,"stats",jd),T(hi,"log",B);let vi=hi;function T_(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const cb=Gn()&&typeof document<"u",Rc=()=>cb&&document.readyState==="complete",ub={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Wd{constructor(e){T(this,"id");T(this,"props");T(this,"canvas");T(this,"htmlCanvas");T(this,"offscreenCanvas");T(this,"type");T(this,"width",1);T(this,"height",1);T(this,"resizeObserver");T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...ub,...e},e=this.props,!Gn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=db(e.canvas):this.canvas=e.canvas;else{const n=pb(e),r=hb((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Rc()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return gb(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(B.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/r,u/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),B.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}T(Wd,"pageLoaded",fb());function fb(){return Rc()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function hb(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Rc())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function db(t){const e=document.getElementById(t);if(!e&&!Rc())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function pb(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function gb(t,e,n,r,i){const s=t,o=w_(s[0],e,n);let a=S_(s[1],e,r,i),l=w_(s[0]+1,e,n);const c=l===n-1?l:l-1;l=S_(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function w_(t,e,n){return Math.min(Math.round(t*e),n-1)}function S_(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const on=class on extends ne{constructor(n,r,i=on.defaultProps){super(n,r,i);T(this,"dimension");T(this,"format");T(this,"width");T(this,"height");T(this,"depth");T(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};T(on,"defaultProps",{...ne.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),T(on,"COPY_SRC",1),T(on,"COPY_DST",2),T(on,"TEXTURE_BINDING",4),T(on,"STORAGE_BINDING",8),T(on,"RENDER_ATTACHMENT",16);let gt=on;const $l=class $l extends ne{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,$l.defaultProps)}};T($l,"defaultProps",{...ne.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Pl=$l;function _b(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=rT(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=E_(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=E_(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function E_(t,e,n,r){if(r!=null&&r.inlineSource){const i=mb(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function mb(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=rT(s,e,n))}return r}function rT(t,e,n){const r=n!=null&&n.html?vb(t):t;return`${yb(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function yb(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function vb(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function iT(t,e){return{name:Tb(t,e),language:"glsl",version:wb(t)}}function Tb(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function wb(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const Xl=class Xl extends ne{constructor(n,r){super(n,{id:Sb(r),...r},Xl.defaultProps);T(this,"stage");T(this,"source");T(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=iT(this.source).name,i=`${this.stage} ${r}`;let s=_b(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};T(Xl,"defaultProps",{...ne.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let xl=Xl;function Sb(t){return iT(t.source).name||t.id||kr(`unnamed ${t.stage}-shader`)}const Yl=class Yl extends ne{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,Yl.defaultProps)}};T(Yl,"defaultProps",{...ne.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Cl=Yl;const Kl=class Kl extends ne{constructor(n,r={}){super(n,r,Kl.defaultProps);T(this,"width");T(this,"height");T(this,"colorAttachments",[]);T(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(B.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof gt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof gt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:gt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:gt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};T(Kl,"defaultProps",{...ne.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Il=Kl;const Zl=class Zl extends ne{constructor(n,r){super(n,r,Zl.defaultProps);T(this,"shaderLayout");T(this,"bufferLayout");T(this,"linkStatus","pending");T(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};T(Zl,"defaultProps",{...ne.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Oi=Zl;const ql=class ql extends ne{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,ql.defaultProps)}};T(ql,"defaultProps",{...ne.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let sh=ql;const Ql=class Ql extends ne{constructor(n,r){super(n,r,Ql.defaultProps);T(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};T(Ql,"defaultProps",{...ne.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Ml=Ql;const Jl=class Jl extends ne{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Jl.defaultProps)}};T(Jl,"defaultProps",{...ne.defaultProps,measureExecutionTime:void 0});let oh=Jl;const Gl=class Gl extends ne{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Gl.defaultProps)}};T(Gl,"defaultProps",{...ne.defaultProps});let ah=Gl;function Eb(t){const[e,n]=Rb[t],r=e==="i32"||e==="u32",i=e!=="u32",s=bb[e]*n,o=Ab(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function Ab(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const Rb={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},bb={f32:4,f16:2,i32:4,u32:4};function sT(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=tT(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function oT(t,e){const n={};for(const r of t.attributes)n[r.name]=xb(t,e,r.name);return n}function Pb(t,e,n=16){const r=oT(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function xb(t,e,n){const r=Cb(t,n),i=Ib(e,n);if(!r)return null;const s=Eb(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=sT(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function Cb(t,e){const n=t.attributes.find(r=>r.name===e);return n||B.warn(`shader layout attribute "${e}" not present in shader`),n||null}function Ib(t,e){Mb(t);let n=Ob(t,e);return n||(n=Nb(t,e),n)?n:(B.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Mb(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&B.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Ob(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function Nb(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=sT(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function kb(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):B.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const ec=class ec extends ne{constructor(n,r){super(n,r,ec.defaultProps);T(this,"maxVertexAttributes");T(this,"attributeInfos");T(this,"indexBuffer",null);T(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Pb(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};T(ec,"defaultProps",{...ne.defaultProps,renderPipeline:null});let lh=ec;const tc=class tc extends ne{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,tc.defaultProps)}};T(tc,"defaultProps",{...ne.defaultProps,layout:void 0,buffers:{}});let ch=tc;const nc=class nc extends ne{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,nc.defaultProps)}};T(nc,"defaultProps",{...ne.defaultProps,type:void 0,count:void 0});let uh=nc;const Fb={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Db(t){const e=Fb[t];return ie(t),e}function Bb(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let oa;function aT(t){return(!oa||oa.byteLength<t)&&(oa=new ArrayBuffer(t)),oa}function Ub(t,e){const n=aT(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function Lb(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const A_=1024;class zb{constructor(e){T(this,"layout",{});T(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=Db(s),{type:a,components:l}=o;n=Bb(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,A_)}getData(e){const n=Math.max(this.byteLength,A_),r=aT(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){B.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){B.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}f[u]=Number(o)}else{const h=oo(o);if(!h){B.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}f.set(h,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Vb(t,e,n=16){if(t!==e)return!1;const r=oo(t);if(!r)return!1;const i=oo(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function jb(t){const e=oo(t);return e?e.slice():t}class Wb{constructor(e){T(this,"name");T(this,"uniforms",{});T(this,"modifiedUniforms",{});T(this,"modified",!0);T(this,"bindingLayout",{});T(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){Vb(this.uniforms[e],n)||(this.uniforms[e]=jb(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Hb{constructor(e){T(this,"uniformBlocks",new Map);T(this,"uniformBufferLayouts",new Map);T(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new zb(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new Wb({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:ce.UNIFORM|ce.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:ce.UNIFORM|ce.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&B.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();B.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function lT(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function cT(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function $b(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=lT(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function Xb(t){return oo(t)!==null||typeof t=="number"||typeof t=="boolean"}function Hd(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];Xb(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function Yb(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?`${t}.${r[a]}`:"N/A";B.removed(`${t}.${a}`,c)()}for(const a in i)if(a in e){const l=i[a];B.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(B.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let Kb="";async function Zb(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:Kb+t}catch(i){r(i)}})}async function uT(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function fh(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!fh(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!fh(t[s],e[s],n-1))return!1;return!0}return!1}function qb(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Qb(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class Jb{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let yn=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(Ol.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Nl.instance)}}};class Ol extends yn{}Ol.instance=new Ol;class Nl extends yn{}Nl.instance=new Nl;class ue extends yn{constructor(){super()}}class hh extends ue{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class Gb extends ue{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class eP extends ue{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class tP extends ue{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class nP extends ue{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class lr extends ue{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class fT extends ue{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class dh extends ue{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class R_ extends ue{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Ni;(function(t){t.increment="++",t.decrement="--"})(Ni||(Ni={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Ni||(Ni={}));class rP extends ue{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var ao;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ao||(ao={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(ao||(ao={}));class iP extends ue{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class hT extends ue{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class sP extends ue{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class oP extends ue{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class aP extends ue{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class lP extends ue{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class cP extends ue{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class uP extends ue{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class fP extends ue{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class dT extends ue{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class hP extends ue{constructor(){super()}get astNodeType(){return"discard"}}class dP extends ue{constructor(){super()}get astNodeType(){return"break"}}class pP extends ue{constructor(){super()}get astNodeType(){return"continue"}}class Fr extends ue{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ar extends Fr{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class pT extends Fr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class gP extends Fr{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class gT extends Fr{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class ws extends Fr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Gt extends yn{constructor(){super()}}class _P extends Gt{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class si extends Gt{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class _T extends Gt{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class ph extends Gt{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class b_ extends Gt{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof si){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class P_ extends Gt{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class mP extends Gt{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class x_ extends Gt{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class yP extends Gt{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class mT extends Gt{constructor(){super()}}class vP extends mT{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class zt extends mT{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class yT extends yn{constructor(){super()}}class TP extends yT{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class wP extends yT{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class SP extends yn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class EP extends yn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class AP extends yn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let RP=class extends yn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var C,b;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(b||(b={}));class P{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class S{}C=S;S.none=new P("",b.reserved,"");S.eof=new P("EOF",b.token,"");S.reserved={asm:new P("asm",b.reserved,"asm"),bf16:new P("bf16",b.reserved,"bf16"),do:new P("do",b.reserved,"do"),enum:new P("enum",b.reserved,"enum"),f16:new P("f16",b.reserved,"f16"),f64:new P("f64",b.reserved,"f64"),handle:new P("handle",b.reserved,"handle"),i8:new P("i8",b.reserved,"i8"),i16:new P("i16",b.reserved,"i16"),i64:new P("i64",b.reserved,"i64"),mat:new P("mat",b.reserved,"mat"),premerge:new P("premerge",b.reserved,"premerge"),regardless:new P("regardless",b.reserved,"regardless"),typedef:new P("typedef",b.reserved,"typedef"),u8:new P("u8",b.reserved,"u8"),u16:new P("u16",b.reserved,"u16"),u64:new P("u64",b.reserved,"u64"),unless:new P("unless",b.reserved,"unless"),using:new P("using",b.reserved,"using"),vec:new P("vec",b.reserved,"vec"),void:new P("void",b.reserved,"void")};S.keywords={array:new P("array",b.keyword,"array"),atomic:new P("atomic",b.keyword,"atomic"),bool:new P("bool",b.keyword,"bool"),f32:new P("f32",b.keyword,"f32"),i32:new P("i32",b.keyword,"i32"),mat2x2:new P("mat2x2",b.keyword,"mat2x2"),mat2x3:new P("mat2x3",b.keyword,"mat2x3"),mat2x4:new P("mat2x4",b.keyword,"mat2x4"),mat3x2:new P("mat3x2",b.keyword,"mat3x2"),mat3x3:new P("mat3x3",b.keyword,"mat3x3"),mat3x4:new P("mat3x4",b.keyword,"mat3x4"),mat4x2:new P("mat4x2",b.keyword,"mat4x2"),mat4x3:new P("mat4x3",b.keyword,"mat4x3"),mat4x4:new P("mat4x4",b.keyword,"mat4x4"),ptr:new P("ptr",b.keyword,"ptr"),sampler:new P("sampler",b.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",b.keyword,"sampler_comparison"),struct:new P("struct",b.keyword,"struct"),texture_1d:new P("texture_1d",b.keyword,"texture_1d"),texture_2d:new P("texture_2d",b.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",b.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",b.keyword,"texture_3d"),texture_cube:new P("texture_cube",b.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",b.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",b.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",b.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",b.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",b.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",b.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",b.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",b.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",b.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",b.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",b.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",b.keyword,"texture_external"),u32:new P("u32",b.keyword,"u32"),vec2:new P("vec2",b.keyword,"vec2"),vec3:new P("vec3",b.keyword,"vec3"),vec4:new P("vec4",b.keyword,"vec4"),bitcast:new P("bitcast",b.keyword,"bitcast"),block:new P("block",b.keyword,"block"),break:new P("break",b.keyword,"break"),case:new P("case",b.keyword,"case"),continue:new P("continue",b.keyword,"continue"),continuing:new P("continuing",b.keyword,"continuing"),default:new P("default",b.keyword,"default"),diagnostic:new P("diagnostic",b.keyword,"diagnostic"),discard:new P("discard",b.keyword,"discard"),else:new P("else",b.keyword,"else"),enable:new P("enable",b.keyword,"enable"),fallthrough:new P("fallthrough",b.keyword,"fallthrough"),false:new P("false",b.keyword,"false"),fn:new P("fn",b.keyword,"fn"),for:new P("for",b.keyword,"for"),function:new P("function",b.keyword,"function"),if:new P("if",b.keyword,"if"),let:new P("let",b.keyword,"let"),const:new P("const",b.keyword,"const"),loop:new P("loop",b.keyword,"loop"),while:new P("while",b.keyword,"while"),private:new P("private",b.keyword,"private"),read:new P("read",b.keyword,"read"),read_write:new P("read_write",b.keyword,"read_write"),return:new P("return",b.keyword,"return"),requires:new P("requires",b.keyword,"requires"),storage:new P("storage",b.keyword,"storage"),switch:new P("switch",b.keyword,"switch"),true:new P("true",b.keyword,"true"),alias:new P("alias",b.keyword,"alias"),type:new P("type",b.keyword,"type"),uniform:new P("uniform",b.keyword,"uniform"),var:new P("var",b.keyword,"var"),override:new P("override",b.keyword,"override"),workgroup:new P("workgroup",b.keyword,"workgroup"),write:new P("write",b.keyword,"write"),r8unorm:new P("r8unorm",b.keyword,"r8unorm"),r8snorm:new P("r8snorm",b.keyword,"r8snorm"),r8uint:new P("r8uint",b.keyword,"r8uint"),r8sint:new P("r8sint",b.keyword,"r8sint"),r16uint:new P("r16uint",b.keyword,"r16uint"),r16sint:new P("r16sint",b.keyword,"r16sint"),r16float:new P("r16float",b.keyword,"r16float"),rg8unorm:new P("rg8unorm",b.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",b.keyword,"rg8snorm"),rg8uint:new P("rg8uint",b.keyword,"rg8uint"),rg8sint:new P("rg8sint",b.keyword,"rg8sint"),r32uint:new P("r32uint",b.keyword,"r32uint"),r32sint:new P("r32sint",b.keyword,"r32sint"),r32float:new P("r32float",b.keyword,"r32float"),rg16uint:new P("rg16uint",b.keyword,"rg16uint"),rg16sint:new P("rg16sint",b.keyword,"rg16sint"),rg16float:new P("rg16float",b.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",b.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",b.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",b.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",b.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",b.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",b.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",b.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",b.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",b.keyword,"rg11b10float"),rg32uint:new P("rg32uint",b.keyword,"rg32uint"),rg32sint:new P("rg32sint",b.keyword,"rg32sint"),rg32float:new P("rg32float",b.keyword,"rg32float"),rgba16uint:new P("rgba16uint",b.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",b.keyword,"rgba16sint"),rgba16float:new P("rgba16float",b.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",b.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",b.keyword,"rgba32sint"),rgba32float:new P("rgba32float",b.keyword,"rgba32float"),static_assert:new P("static_assert",b.keyword,"static_assert")};S.tokens={decimal_float_literal:new P("decimal_float_literal",b.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new P("hex_float_literal",b.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",b.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",b.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",b.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",b.token,"&"),and_and:new P("and_and",b.token,"&&"),arrow:new P("arrow ",b.token,"->"),attr:new P("attr",b.token,"@"),forward_slash:new P("forward_slash",b.token,"/"),bang:new P("bang",b.token,"!"),bracket_left:new P("bracket_left",b.token,"["),bracket_right:new P("bracket_right",b.token,"]"),brace_left:new P("brace_left",b.token,"{"),brace_right:new P("brace_right",b.token,"}"),colon:new P("colon",b.token,":"),comma:new P("comma",b.token,","),equal:new P("equal",b.token,"="),equal_equal:new P("equal_equal",b.token,"=="),not_equal:new P("not_equal",b.token,"!="),greater_than:new P("greater_than",b.token,">"),greater_than_equal:new P("greater_than_equal",b.token,">="),shift_right:new P("shift_right",b.token,">>"),less_than:new P("less_than",b.token,"<"),less_than_equal:new P("less_than_equal",b.token,"<="),shift_left:new P("shift_left",b.token,"<<"),modulo:new P("modulo",b.token,"%"),minus:new P("minus",b.token,"-"),minus_minus:new P("minus_minus",b.token,"--"),period:new P("period",b.token,"."),plus:new P("plus",b.token,"+"),plus_plus:new P("plus_plus",b.token,"++"),or:new P("or",b.token,"|"),or_or:new P("or_or",b.token,"||"),paren_left:new P("paren_left",b.token,"("),paren_right:new P("paren_right",b.token,")"),semicolon:new P("semicolon",b.token,";"),star:new P("star",b.token,"*"),tilde:new P("tilde",b.token,"~"),underscore:new P("underscore",b.token,"_"),xor:new P("xor",b.token,"^"),plus_equal:new P("plus_equal",b.token,"+="),minus_equal:new P("minus_equal",b.token,"-="),times_equal:new P("times_equal",b.token,"*="),division_equal:new P("division_equal",b.token,"/="),modulo_equal:new P("modulo_equal",b.token,"%="),and_equal:new P("and_equal",b.token,"&="),or_equal:new P("or_equal",b.token,"|="),xor_equal:new P("xor_equal",b.token,"^="),shift_right_equal:new P("shift_right_equal",b.token,">>="),shift_left_equal:new P("shift_left_equal",b.token,"<<=")};S.simpleTokens={"@":C.tokens.attr,"{":C.tokens.brace_left,"}":C.tokens.brace_right,":":C.tokens.colon,",":C.tokens.comma,"(":C.tokens.paren_left,")":C.tokens.paren_right,";":C.tokens.semicolon};S.literalTokens={"&":C.tokens.and,"&&":C.tokens.and_and,"->":C.tokens.arrow,"/":C.tokens.forward_slash,"!":C.tokens.bang,"[":C.tokens.bracket_left,"]":C.tokens.bracket_right,"=":C.tokens.equal,"==":C.tokens.equal_equal,"!=":C.tokens.not_equal,">":C.tokens.greater_than,">=":C.tokens.greater_than_equal,">>":C.tokens.shift_right,"<":C.tokens.less_than,"<=":C.tokens.less_than_equal,"<<":C.tokens.shift_left,"%":C.tokens.modulo,"-":C.tokens.minus,"--":C.tokens.minus_minus,".":C.tokens.period,"+":C.tokens.plus,"++":C.tokens.plus_plus,"|":C.tokens.or,"||":C.tokens.or_or,"*":C.tokens.star,"~":C.tokens.tilde,_:C.tokens.underscore,"^":C.tokens.xor,"+=":C.tokens.plus_equal,"-=":C.tokens.minus_equal,"*=":C.tokens.times_equal,"/=":C.tokens.division_equal,"%=":C.tokens.modulo_equal,"&=":C.tokens.and_equal,"|=":C.tokens.or_equal,"^=":C.tokens.xor_equal,">>=":C.tokens.shift_right_equal,"<<=":C.tokens.shift_left_equal};S.regexTokens={decimal_float_literal:C.tokens.decimal_float_literal,hex_float_literal:C.tokens.hex_float_literal,int_literal:C.tokens.int_literal,uint_literal:C.tokens.uint_literal,ident:C.tokens.ident};S.storage_class=[C.keywords.function,C.keywords.private,C.keywords.workgroup,C.keywords.uniform,C.keywords.storage];S.access_mode=[C.keywords.read,C.keywords.write,C.keywords.read_write];S.sampler_type=[C.keywords.sampler,C.keywords.sampler_comparison];S.sampled_texture_type=[C.keywords.texture_1d,C.keywords.texture_2d,C.keywords.texture_2d_array,C.keywords.texture_3d,C.keywords.texture_cube,C.keywords.texture_cube_array];S.multisampled_texture_type=[C.keywords.texture_multisampled_2d];S.storage_texture_type=[C.keywords.texture_storage_1d,C.keywords.texture_storage_2d,C.keywords.texture_storage_2d_array,C.keywords.texture_storage_3d];S.depth_texture_type=[C.keywords.texture_depth_2d,C.keywords.texture_depth_2d_array,C.keywords.texture_depth_cube,C.keywords.texture_depth_cube_array,C.keywords.texture_depth_multisampled_2d];S.texture_external_type=[C.keywords.texture_external];S.any_texture_type=[...C.sampled_texture_type,...C.multisampled_texture_type,...C.storage_texture_type,...C.depth_texture_type,...C.texture_external_type];S.texel_format=[C.keywords.r8unorm,C.keywords.r8snorm,C.keywords.r8uint,C.keywords.r8sint,C.keywords.r16uint,C.keywords.r16sint,C.keywords.r16float,C.keywords.rg8unorm,C.keywords.rg8snorm,C.keywords.rg8uint,C.keywords.rg8sint,C.keywords.r32uint,C.keywords.r32sint,C.keywords.r32float,C.keywords.rg16uint,C.keywords.rg16sint,C.keywords.rg16float,C.keywords.rgba8unorm,C.keywords.rgba8unorm_srgb,C.keywords.rgba8snorm,C.keywords.rgba8uint,C.keywords.rgba8sint,C.keywords.bgra8unorm,C.keywords.bgra8unorm_srgb,C.keywords.rgb10a2unorm,C.keywords.rg11b10float,C.keywords.rg32uint,C.keywords.rg32sint,C.keywords.rg32float,C.keywords.rgba16uint,C.keywords.rgba16sint,C.keywords.rgba16float,C.keywords.rgba32uint,C.keywords.rgba32sint,C.keywords.rgba32float];S.const_literal=[C.tokens.int_literal,C.tokens.uint_literal,C.tokens.decimal_float_literal,C.tokens.hex_float_literal,C.keywords.true,C.keywords.false];S.literal_or_ident=[C.tokens.ident,C.tokens.int_literal,C.tokens.uint_literal,C.tokens.decimal_float_literal,C.tokens.hex_float_literal];S.element_count_expression=[C.tokens.int_literal,C.tokens.uint_literal,C.tokens.ident];S.template_types=[C.keywords.vec2,C.keywords.vec3,C.keywords.vec4,C.keywords.mat2x2,C.keywords.mat2x3,C.keywords.mat2x4,C.keywords.mat3x2,C.keywords.mat3x3,C.keywords.mat3x4,C.keywords.mat4x2,C.keywords.mat4x3,C.keywords.mat4x4,C.keywords.atomic,C.keywords.bitcast,...C.any_texture_type];S.attribute_name=[C.tokens.ident,C.keywords.block,C.keywords.diagnostic];S.assignment_operators=[C.tokens.equal,C.tokens.plus_equal,C.tokens.minus_equal,C.tokens.times_equal,C.tokens.division_equal,C.tokens.modulo_equal,C.tokens.and_equal,C.tokens.or_equal,C.tokens.xor_equal,C.tokens.shift_right_equal,C.tokens.shift_left_equal];S.increment_operators=[C.tokens.plus_plus,C.tokens.minus_minus];class C_{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class bP{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new C_(S.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=S.simpleTokens[e];if(n)return this._addToken(n),!0;let r=S.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=S.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(S.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(S.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(S.tokens.minus_minus),!0;const l=this._tokens.length-1;if((S.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==S.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&S.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===S.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===S.none){let l=e,c=0;const u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),o=this._findType(l),o!==S.none){c=f;break}if(o===S.none)return r===S.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===S.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in S.regexTokens){const i=S.regexTokens[r];if(this._match(e,i.rule))return i}const n=S.literalTokens[e];return n||S.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new C_(e,n,this._line))}}class PP{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Jb,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof ph){const a=s.name,l=this._context.constants.get(a);if(l)try{const c=l.evaluate(this._context);i.count=c}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new bP(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof P)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const n=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.diagnostic)){const n=this._diagnostic();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.requires)){const n=this._requires_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.enable)){const n=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(S.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(S.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._currentLine,n=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const a=this._attribute(),l=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(new SP(l,u,a)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(S.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new hh(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.tokens.attr)&&this._attribute(),this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;return this._check(S.keywords.return)?e=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?e=this._variable_statement():this._match(S.keywords.discard)?e=new hP:this._match(S.keywords.break)?e=new dP:this._match(S.keywords.continue)?e=new pP:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;const e=this._optional_paren_expression();return new Gb(e)}_while_statement(){if(!this._match(S.keywords.while))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();const n=this._compound_statement();return new eP(e,n)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;const e=this._compound_statement();return new tP(e)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");const n=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");const r=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'."),this._check(S.tokens.attr)&&this._attribute();const i=this._compound_statement();return new nP(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(S.tokens.equal)&&(n=this._short_circuit_or_expression()),new lr(e.name,e.type,e.storage,e.access,n)}if(this._match(S.keywords.let)){const e=this._consume(S.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(S.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new dh(e,n,null,null,r)}if(this._match(S.keywords.const)){const e=this._consume(S.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(S.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new R_(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const r=this._consume(S.increment_operators,"Expected increment operator");return new rP(r.type===S.tokens.plus_plus?Ni.increment:Ni.decrement,n)}_assignment_statement(){let e=null;if(this._check(S.tokens.brace_right))return null;let n=this._match(S.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(S.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new iP(ao.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._current,n=this._consume(S.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new hT(n.lexeme,r)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(S.keywords.continuing)&&(r=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new sP(e,r)}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new oP(e,n)}_switch_body(){const e=[];if(this._match(S.keywords.case)){const n=this._case_selectors();this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(new TP(n,r))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(new wP(n))}if(this._check([S.keywords.default,S.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(S.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(S.keywords.else)&&(this._check(S.tokens.attr)&&this._attribute(),i=this._compound_statement()),new aP(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new EP(n,r)),this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return new lP(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=new zt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=new zt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=new zt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=new zt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=new zt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new zt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=new zt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=new zt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=new zt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=new zt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new vP(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const n=new yP(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new _P(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(S.tokens.ident)){const r=this._previous().toString();if(this._check(S.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new si(s,i):new _T(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new b_(r,i.value)}return new ph(r)}if(this._match(S.const_literal))return new P_(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new mP(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new si(e,n)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new x_([e])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new x_([e])}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._currentLine,n=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(S.tokens.brace_right);){const o=this._attribute(),a=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),r.push(new AP(a,c,o))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new ar(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(S.keywords.const))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(S.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof si)r=s;else if(s instanceof b_&&s.initializer instanceof si)r=s.initializer;else try{const o=s.evaluate(this._context);r=new P_(o)}catch{r=s}}const i=new R_(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(S.tokens.equal)&&(r=this._const_expression()),new dh(e.toString(),n,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(S.keywords.var))return null;let e="",n="";this._match(S.tokens.less_than)&&(e=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(n=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const r=this._consume(S.tokens.ident,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new lr(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new fT(e.toString(),n,null)}_diagnostic(){this._consume(S.tokens.paren_left,"Expected '('");const e=this._consume(S.tokens.ident,"Expected severity control name.");this._consume(S.tokens.comma,"Expected ','");const n=this._consume(S.tokens.ident,"Expected diagnostic rule name.");return this._consume(S.tokens.paren_right,"Expected ')'"),new fP(e.toString(),n.toString())}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return new cP(e.toString())}_requires_directive(){const e=[this._consume(S.tokens.ident,"identity expected.").toString()];for(;this._match(S.tokens.comma);){const n=this._consume(S.tokens.ident,"identity expected.");e.push(n.toString())}return new uP(e)}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new dT(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Fr(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(S.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(S.tokens.comma)&&(s=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new pT(r,i,s)}if(this._match(S.keywords.ptr)){let r=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new gP(r,i.toString(),s,o)}const n=this._attribute();if(this._match(S.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(S.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(S.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(S.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new gT(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new ws(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new ws(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new ws(e.toString(),n,null)}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const r=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new ws(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const n=this._consume(S.attribute_name,"Expected attribute name"),r=new RP(n.toString(),null);if(this._match(S.tokens.paren_left)){if(r.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const i=this._consume(S.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Ti{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class I_{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class aa extends Ti{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ru extends Ti{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class M_ extends Ti{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var Pn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Pn||(Pn={}));class la{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class xP{constructor(e,n){this.name=e,this.type=n}}class ca{constructor(e,n){this.align=e,this.size=n}}class CP{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class O_{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class IP{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class MP{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class OP{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class NP{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class un{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new OP,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new PP().parse(e);for(const i of r)i instanceof hh&&this._functions.set(i.name,new NP(i));for(const i of r)if(i instanceof ar){const s=this._getTypeInfo(i,null);s instanceof aa&&this.structs.push(s)}for(const i of r){if(i instanceof dT){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof fT){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new IP(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new la(s.name,l,o,a,s.attributes,Pn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new la(s.name,l,o,a,s.attributes,c?Pn.StorageTexture:Pn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new la(s.name,l,o,a,s.attributes,c?Pn.StorageTexture:Pn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new la(s.name,l,o,a,s.attributes,Pn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof hh){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,c=new MP(i.name,l==null?void 0:l.name);c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,l&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!l),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(s=>{var o;if(s.astNodeType==="varExpr"){const a=s;for(const l of this.overrides)a.name==l.name&&((o=i.info)===null||o===void 0||o.overrides.push(l))}});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Ol)s.push({});else if(o instanceof Nl)s.pop();else if(o instanceof lr){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof si){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof dh){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof ph){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof _T){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof hT){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof ar)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof ar)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new O_(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new O_("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof ar)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof ar)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new CP(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new xP(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof gT){const i=e,s=i.format?this._getTypeInfo(i.format,i.attributes):null,o=new Ru(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ar){const i=e,s=new aa(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new I_(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ws){const i=e,s=i.format instanceof Fr,o=i.format?s?this._getTypeInfo(i.format,null):new Ti(i.format,null):null,a=new M_(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof pT){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new M_(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Ti(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof Ru&&e.format){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof aa&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const f=u.align,h=u.size;r=this._roundUp(f,r+i),i=h,s=r,o=Math.max(o,f),c.offset=r,c.size=h,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof I_&&(e=e.type),e instanceof Ti){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=un._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new ca(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=un._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new ca(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof Ru){let o=e,a=8,l=8;const c=this._getTypeSize(o.format);c!==null&&(l=c.size,a=c.align);const u=o.count,f=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,l));return l=u*f,i&&(l=i),new ca(Math.max(s,a),Math.max(i,l))}if(e instanceof aa){let o=0,a=0,l=0,c=0,u=0;for(const f of e.members){const h=this._getTypeSize(f.type);h!==null&&(o=Math.max(h.align,o),l=this._roundUp(h.align,l+c),c=h.size,u=l)}return a=this._roundUp(o,u+c),new ca(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof lr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof lr&&e.storage=="storage"}_isTextureVar(e){return e instanceof lr&&e.type!==null&&un._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof lr&&e.type!==null&&un._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}un._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};un._textureTypes=S.any_texture_type.map(t=>t.name);un._samplerTypes=S.sampler_type.map(t=>t.name);function kP(t){var s;const e={attributes:[],bindings:[]};let n;try{n=FP(t)}catch(o){return B.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:N_(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=N_(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function N_(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function FP(t){try{return new un(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const DP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,BP={name:"fp32",vs:DP},UP=[0,1,1,1],LP=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,zP=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,k_={name:"picking",vs:LP,fs:zP,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:UP},getUniforms:VP};function VP(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function vT(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function jP(t){return t-Math.fround(t)}function WP(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;vT(t[r*4+n],e,i*2)}return e}const HP=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,$P={ONE:1};function XP(){return $P}const YP={name:"fp64-arithmetic",vs:HP,getUniforms:XP,fp64ify:vT,fp64LowPart:jP,fp64ifyMatrix4:WP},KP={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...KP}};const st=globalThis.mathgl.config;function ZP(t,{precision:e=st.precision}={}){return t=qP(t),`${parseFloat(t.toPrecision(e))}`}function ki(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function rt(t,e,n){return JP(t,r=>Math.max(e,Math.min(n,r)))}function kl(t,e,n){return ki(t)?t.map((r,i)=>kl(r,e[i],n)):n*e+(1-n)*t}function lo(t,e,n){const r=st.EPSILON;n&&(st.EPSILON=n);try{if(t===e)return!0;if(ki(t)&&ki(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!lo(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=st.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{st.EPSILON=r}}function qP(t){return Math.round(t/st.EPSILON)*st.EPSILON}function QP(t){return t.clone?t.clone():new Array(t.length)}function JP(t,e,n){if(ki(t)){const r=t;n=n||QP(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class TT extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ki(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(st)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+ZP(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!lo(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(st.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function GP(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function nt(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function bu(t,e,n=""){if(st.debug&&!GP(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function F_(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class ex extends TT{get x(){return this[0]}set x(e){this[0]=nt(e)}get y(){return this[1]}set y(e){this[1]=nt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return nt(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return nt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return F_(e>=0&&e<this.ELEMENTS,"index is out of range"),nt(this[e])}setComponent(e,n){return F_(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const $a=1e-6;let Fi=typeof Float32Array<"u"?Float32Array:Array;function tx(){const t=new Fi(2);return Fi!=Float32Array&&(t[0]=0,t[1]=0),t}function D_(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function nx(t,e){return t[0]=-e[0],t[1]=-e[1],t}function wT(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function rx(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=tx();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function ix(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function ST(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function sx(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function ox(){const t=new Fi(3);return Fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ax(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function lx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function cx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ux(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function ET(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function fx(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function hx(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,f=s*a-r*c,h=r*l-i*a,_=i*h-s*f,d=s*u-r*h,m=r*f-i*u;const E=o*2;return u*=E,f*=E,h*=E,_*=2,d*=2,m*=2,t[0]=a+u+_,t[1]=l+f+d,t[2]=c+h+m,t}function dx(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function px(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function gx(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function _x(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&cx(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const mx=ax;(function(){const t=ox();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Pu=[0,0,0];let ua;class Jt extends ex{static get ZERO(){return ua||(ua=new Jt(0,0,0),Object.freeze(ua)),ua}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&ki(e)?this.copy(e):(st.debug&&(nt(e),nt(n),nt(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return st.debug&&(nt(e.x),nt(e.y),nt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=nt(e)}angle(e){return _x(this,e)}cross(e){return ux(this,this,e),this.check()}rotateX({radians:e,origin:n=Pu}){return dx(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Pu}){return px(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Pu}){return gx(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ET(this,this,e),this.check()}transformAsVector(e){return ST(this,this,e),this.check()}transformByMatrix3(e){return fx(this,this,e),this.check()}transformByMatrix2(e){return sx(this,this,e),this.check()}transformByQuaternion(e){return hx(this,this,e),this.check()}}class yx extends TT{toString(){let e="[";if(st.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=nt(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function vx(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tx(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function gh(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],_=e[11],d=e[12],m=e[13],E=e[14],p=e[15],g=n*a-r*o,y=n*l-i*o,A=n*c-s*o,x=r*l-i*a,I=r*c-s*a,O=i*c-s*l,N=u*m-f*d,k=u*E-h*d,U=u*p-_*d,j=f*E-h*m,H=f*p-_*m,W=h*p-_*E;let X=g*W-y*H+A*j+x*U-I*k+O*N;return X?(X=1/X,t[0]=(a*W-l*H+c*j)*X,t[1]=(i*H-r*W-s*j)*X,t[2]=(m*O-E*I+p*x)*X,t[3]=(h*I-f*O-_*x)*X,t[4]=(l*U-o*W-c*k)*X,t[5]=(n*W-i*U+s*k)*X,t[6]=(E*A-d*O-p*y)*X,t[7]=(u*O-h*A+_*y)*X,t[8]=(o*H-a*U+c*N)*X,t[9]=(r*U-n*H-s*N)*X,t[10]=(d*I-m*A+p*g)*X,t[11]=(f*A-u*I-_*g)*X,t[12]=(a*k-o*j-l*N)*X,t[13]=(n*j-r*k+i*N)*X,t[14]=(m*y-d*x-E*g)*X,t[15]=(u*x-f*y+h*g)*X,t):null}function wx(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],_=t[12],d=t[13],m=t[14],E=t[15],p=e*o-n*s,g=e*a-r*s,y=n*a-r*o,A=c*d-u*_,x=c*m-f*_,I=u*m-f*d,O=e*I-n*x+r*A,N=s*I-o*x+a*A,k=c*y-u*g+f*p,U=_*y-d*g+m*p;return l*O-i*N+E*k-h*U}function Tr(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],_=e[10],d=e[11],m=e[12],E=e[13],p=e[14],g=e[15];let y=n[0],A=n[1],x=n[2],I=n[3];return t[0]=y*r+A*a+x*f+I*m,t[1]=y*i+A*l+x*h+I*E,t[2]=y*s+A*c+x*_+I*p,t[3]=y*o+A*u+x*d+I*g,y=n[4],A=n[5],x=n[6],I=n[7],t[4]=y*r+A*a+x*f+I*m,t[5]=y*i+A*l+x*h+I*E,t[6]=y*s+A*c+x*_+I*p,t[7]=y*o+A*u+x*d+I*g,y=n[8],A=n[9],x=n[10],I=n[11],t[8]=y*r+A*a+x*f+I*m,t[9]=y*i+A*l+x*h+I*E,t[10]=y*s+A*c+x*_+I*p,t[11]=y*o+A*u+x*d+I*g,y=n[12],A=n[13],x=n[14],I=n[15],t[12]=y*r+A*a+x*f+I*m,t[13]=y*i+A*l+x*h+I*E,t[14]=y*s+A*c+x*_+I*p,t[15]=y*o+A*u+x*d+I*g,t}function Fl(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,f,h,_,d,m,E,p;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],_=e[7],d=e[8],m=e[9],E=e[10],p=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=_,t[8]=d,t[9]=m,t[10]=E,t[11]=p,t[12]=o*r+u*i+d*s+e[12],t[13]=a*r+f*i+m*s+e[13],t[14]=l*r+h*i+E*s+e[14],t[15]=c*r+_*i+p*s+e[15]),t}function $d(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sx(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,f,h,_,d,m,E,p,g,y,A,x,I,O,N,k,U,j,H,W,X,Ae;return a<$a?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],h=e[1],_=e[2],d=e[3],m=e[4],E=e[5],p=e[6],g=e[7],y=e[8],A=e[9],x=e[10],I=e[11],O=i*i*u+l,N=s*i*u+o*c,k=o*i*u-s*c,U=i*s*u-o*c,j=s*s*u+l,H=o*s*u+i*c,W=i*o*u+s*c,X=s*o*u-i*c,Ae=o*o*u+l,t[0]=f*O+m*N+y*k,t[1]=h*O+E*N+A*k,t[2]=_*O+p*N+x*k,t[3]=d*O+g*N+I*k,t[4]=f*U+m*j+y*H,t[5]=h*U+E*j+A*H,t[6]=_*U+p*j+x*H,t[7]=d*U+g*j+I*H,t[8]=f*W+m*X+y*Ae,t[9]=h*W+E*X+A*Ae,t[10]=_*W+p*X+x*Ae,t[11]=d*W+g*X+I*Ae,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function AT(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function Ex(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function RT(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function Ax(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,f=r*a,h=i*o,_=i*a,d=i*l,m=s*o,E=s*a,p=s*l;return t[0]=1-f-d,t[1]=u+p,t[2]=h-E,t[3]=0,t[4]=u-p,t[5]=1-c-d,t[6]=_+m,t[7]=0,t[8]=h+E,t[9]=_-m,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rx(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function bx(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const Px=bx;function xx(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const Cx=xx;function Ix(t,e,n,r){let i,s,o,a,l,c,u,f,h,_;const d=e[0],m=e[1],E=e[2],p=r[0],g=r[1],y=r[2],A=n[0],x=n[1],I=n[2];return Math.abs(d-A)<$a&&Math.abs(m-x)<$a&&Math.abs(E-I)<$a?vx(t):(f=d-A,h=m-x,_=E-I,i=1/Math.sqrt(f*f+h*h+_*_),f*=i,h*=i,_*=i,s=g*_-y*h,o=y*f-p*_,a=p*h-g*f,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=h*a-_*o,c=_*s-f*a,u=f*o-h*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=_,t[11]=0,t[12]=-(s*d+o*m+a*E),t[13]=-(l*d+c*m+u*E),t[14]=-(f*d+h*m+_*E),t[15]=1,t)}function Mx(){const t=new Fi(4);return Fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ox(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function bo(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=Mx();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var _h;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(_h||(_h={}));const Nx=45*Math.PI/180,kx=1,xu=.1,Cu=500,Fx=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Nt extends yx{static get IDENTITY(){return Bx()}static get ZERO(){return Dx()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return _h}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,f,h,_,d,m,E){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=_,this[13]=d,this[14]=m,this[15]=E,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,f,h,_,d,m,E){return this[0]=e,this[1]=s,this[2]=c,this[3]=_,this[4]=n,this[5]=o,this[6]=u,this[7]=d,this[8]=r,this[9]=a,this[10]=f,this[11]=m,this[12]=i,this[13]=l,this[14]=h,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Fx)}fromObject(e){return this.check()}fromQuaternion(e){return Ax(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=xu,far:a=Cu}=e;return a===1/0?Ux(this,n,r,i,s,o):Rx(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return Ix(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=xu,far:a=Cu}=e;return Cx(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=Nx,aspect:r=kx,focalDistance:i=1,near:s=xu,far:o=Cu}=e;B_(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return B_(n),Px(this,n,r,i,s),this.check()}determinant(){return wx(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return Tx(this,this),this.check()}invert(){return gh(this,this),this.check()}multiplyLeft(e){return Tr(this,e,this),this.check()}multiplyRight(e){return Tr(this,this,e),this.check()}rotateX(e){return AT(this,this,e),this.check()}rotateY(e){return Ex(this,this,e),this.check()}rotateZ(e){return RT(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Sx(this,this,e,n),this.check()}scale(e){return $d(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Fl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=bo(n||[-0,-0,-0,-0],e,this),bu(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=rx(n||[-0,-0],e,this);break;case 3:i=ET(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return bu(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=ix(n||[-0,-0],e,this);break;case 3:r=ST(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return bu(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let fa,ha;function Dx(){return fa||(fa=new Nt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fa)),fa}function Bx(){return ha||(ha=new Nt,Object.freeze(ha)),ha}function B_(t){if(t>Math.PI*2)throw Error("expected radians")}function Ux(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const U_=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,Lx={lightSources:{}};function Iu(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/255)}function zx({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=Iu(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,s)=>{r[`lighting_uPointLight[${s}].color`]=Iu(i),r[`lighting_uPointLight[${s}].position`]=i.position,r[`lighting_uPointLight[${s}].attenuation`]=i.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,n.forEach((i,s)=>{r[`lighting_uDirectionalLight[${s}].color`]=Iu(i),r[`lighting_uDirectionalLight[${s}].direction`]=i.direction}),r.lighting_uDirectionalLightCount=n.length,r}function bT(t=Lx){var e,n;if("lightSources"in t){const{ambientLight:r,pointLights:i,directionalLights:s}=t.lightSources||{};return r||i&&i.length>0||s&&s.length>0?Object.assign({},zx({ambientLight:r,pointLights:i,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const i of t.lights||[])switch(i.type){case"ambient":r.ambientLight=i;break;case"directional":(e=r.directionalLights)==null||e.push(i);break;case"point":(n=r.pointLights)==null||n.push(i);break}return bT({lightSources:r})}return{}}const Vx={name:"lights",vs:U_,fs:U_,getUniforms:bT,defines:{MAX_LIGHTS:3}},jx=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,Wx={};function Hx(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function $x(t=Wx){if(!("material"in t))return{};const{material:e}=t;return e?Hx(e):{lighting_uEnabled:!1}}const Xx={name:"gouraud-lighting",dependencies:[Vx],vs:jx,defines:{LIGHTING_VERTEX:1},getUniforms:$x},PT="#define SMOOTH_EDGE_RADIUS 0.5",Yx=`
${PT}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Kx=`
${PT}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Zx={name:"geometry",vs:Yx,fs:Kx},q={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(q,"IDENTITY",{get:()=>(J.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Kt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Di={common:0,meters:1,pixels:2},mh={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},qx=Object.keys(q).map(t=>`const int COORDINATE_SYSTEM_${t} = ${q[t]};`).join(""),Qx=Object.keys(Kt).map(t=>`const int PROJECTION_MODE_${t} = ${Kt[t]};`).join(""),Jx=Object.keys(Di).map(t=>`const int UNIT_${t.toUpperCase()} = ${Di[t]};`).join(""),Gx=`${qx}
${Qx}
${Jx}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function eC(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Po(t){let e={},n;return r=>{for(const i in r)if(!eC(r[i],e[i])){n=t(r),e=r;break}return n}}const L_=[0,0,0,0],tC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nC=[0,0,0],CT=[0,0,0],rC=Po(oC);function IT(t,e,n=CT){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===q.LNGLAT_OFFSETS||e===q.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Kt.WEB_MERCATOR:(e===q.LNGLAT||e===q.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Kt.WEB_MERCATOR_AUTO_OFFSET:e===q.LNGLAT?r=i:e===q.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Kt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Kt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function iC(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=L_,l=L_,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=IT(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=bo([],l,o),s=r||s,o=Tr([],i,s),o=Tr([],o,tC)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function sC({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=q.DEFAULT,coordinateOrigin:i=CT,autoWrapLongitude:s=!1}){r===q.DEFAULT&&(r=t.isGeospatial?q.LNGLAT:q.CARTESIAN);const o=rC({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||xT,o}function oC({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=iC(t,n,r),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=bo([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,_={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:nC,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:xT,project_uCameraPosition:a};if(c){const d=t.getDistanceScales(c);switch(n){case q.METER_OFFSETS:_.project_uCommonUnitsPerWorldUnit=d.unitsPerMeter,_.project_uCommonUnitsPerWorldUnit2=d.unitsPerMeter2;break;case q.LNGLAT:case q.LNGLAT_OFFSETS:t._pseudoMeters||(_.project_uCommonUnitsPerMeter=d.unitsPerMeter),_.project_uCommonUnitsPerWorldUnit=d.unitsPerDegree,_.project_uCommonUnitsPerWorldUnit2=d.unitsPerDegree2;break;case q.CARTESIAN:_.project_uCommonUnitsPerWorldUnit=[1,1,d.unitsPerMeter[2]],_.project_uCommonUnitsPerWorldUnit2=[0,0,d.unitsPerMeter2[2]];break}}return _}const aC={};function lC(t=aC){return"viewport"in t?sC(t):{}}const Xd={name:"project",dependencies:[BP,Zx],vs:Gx,getUniforms:lC},cC=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,xo={name:"project32",dependencies:[Xd],vs:cC};function uC(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wi(t,e){const n=bo([],e,t);return Ox(n,n,1/n[3]),n}function z_(t,e){const n=t%e;return n<0?e+n:n}function yh(t,e,n){return t<e?e:t>n?n:t}function fC(t){return Math.log(t)*Math.LOG2E}const Yd=Math.log2||fC;function _n(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const bt=Math.PI,MT=bt/4,mt=bt/180,vh=180/bt,Bi=512,Dl=4003e4,da=85.051129,hC=1.5;function dC(t){return Yd(t)}function Bl(t){const[e,n]=t;_n(Number.isFinite(e)),_n(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*mt,i=n*mt,s=Bi*(r+bt)/(2*bt),o=Bi*(bt+Math.log(Math.tan(MT+i*.5)))/(2*bt);return[s,o]}function Ui(t){const[e,n]=t,r=e/Bi*(2*bt)-bt,i=2*(Math.atan(Math.exp(n/Bi*(2*bt)-bt))-MT);return[r*vh,i*vh]}function pC(t){const{latitude:e}=t;_n(Number.isFinite(e));const n=Math.cos(e*mt);return dC(Dl*n)-9}function Mu(t){const e=Math.cos(t*mt);return Bi/Dl/e}function Th(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;_n(Number.isFinite(e)&&Number.isFinite(n));const i=Bi,s=Math.cos(e*mt),o=i/360,a=o/s,l=i/Dl/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=mt*Math.tan(e*mt)/s,f=o*u/2,h=i/Dl*u,_=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[_,0,_]}return c}function OT(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Th({longitude:n,latitude:r,highPrecision:!0}),u=Bl(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=Ui(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function gC(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=uC();Fl(a,a,[0,0,-i]),AT(a,a,-n*mt),RT(a,a,r*mt);const l=s/e;return $d(a,a,[l,l,l]),o&&Fl(a,a,lx([],o)),a}function _C(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ul(hC)}=t;r!==void 0&&(u=Ul(r));const f=u*mt,h=i*mt,_=Kd(u);let d=_;o&&(d+=o[2]*a/Math.cos(h)/n);const m=f*(.5+(s?s[1]:0)/n),E=Math.sin(m)*d/Math.sin(yh(Math.PI/2-h-m,.01,Math.PI-.01)),p=Math.sin(h)*E+d,g=d*10,y=Math.min(p*c,g);return{fov:f,aspect:e/n,focalDistance:_,near:l,far:y}}function Ul(t){return 2*Math.atan(.5/t)*vh}function Kd(t){return .5/Math.tan(.5*t*mt)}function NT(t,e){const[n,r,i=0]=t;return _n(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),wi(e,[n,r,i,1])}function bc(t,e,n=0){const[r,i,s]=t;if(_n(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return wi(e,[r,i,s,1]);const o=wi(e,[r,i,0,1]),a=wi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return wT([],o,a,u)}function mC(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,f=yC(t.padding),h=Bl([a,yh(u,-da,da)]),_=Bl([c,yh(l,-da,da)]),d=[Math.max(Math.abs(_[0]-h[0]),i),Math.max(Math.abs(_[1]-h[1]),i)],m=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];_n(m[0]>0&&m[1]>0);const E=m[0]/d[0],p=m[1]/d[1],g=(f.right-f.left)/2/E,y=(f.top-f.bottom)/2/p,A=[(_[0]+h[0])/2+g,(_[1]+h[1])/2+y],x=Ui(A),I=Math.min(s,Yd(Math.abs(Math.min(E,p))));return _n(Number.isFinite(I)),{longitude:x[0],latitude:x[1],zoom:I}}function yC(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(_n(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const V_=Math.PI/180;function vC(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*V_:Math.atan(.5/t.altitude),f=(90-t.pitch)*V_;return u>f-.01?(l=j_(t,0,e),c=j_(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function j_(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=wi(r,[e,0,1,1]),s=wi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=wT([],i,s,a),c=Ui(l);return c.push(n),c}const W_=512;function TC(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=z_(i+180,360)-180),(a<-180||a>180)&&(a=z_(a+180,360)-180);const l=Yd(n/W_);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Ui([0,c])[1];if(s<u)s=u;else{const f=Ui([0,W_-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const wC=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,SC=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,EC=Po(xC),AC=Po(CC),RC=[0,0,0,1],bC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function PC(t,e){const[n,r,i]=t,s=bc([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function xC({viewport:t,center:e}){return new Nt(t.viewProjectionMatrix).invert().transform(e)}function CC({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>PC(o,r));for(const o of e){const a=o.clone().translate(new Jt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Nt().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function IC(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||RC,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=EC({viewport:t.viewport,center:e.project_uCenter}),s=[],o=AC({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new Jt(t.viewport.center).negate());e.project_uCoordinateSystem===q.LNGLAT&&e.project_uProjectionMode===Kt.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(bC),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const H_={name:"shadow",dependencies:[Xd],vs:wC,fs:SC,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?IC(t,e):{}},Co={...k_,defaultUniforms:{...k_.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},MC=[Xd],OC=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function NC(){const t=Rl.getDefaultShaderAssembler();for(const e of MC)t.addDefaultModule(e);for(const e of OC)t.addShaderHook(e);return t}const kC=[255,255,255],FC=1;let DC=0;class BC{constructor(e={}){this.type="ambient";const{color:n=kC}=e,{intensity:r=FC}=e;this.id=e.id||`ambient-${DC++}`,this.color=n,this.intensity=r}}const UC=[255,255,255],LC=1,zC=[0,0,-1];let VC=0;class $_{constructor(e={}){this.type="directional";const{color:n=UC}=e,{intensity:r=LC}=e,{direction:i=zC}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${VC++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Jt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class jC{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Zd extends jC{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const f=o&&o[u.id];a==null||a(u);const h=this._getDrawLayerParams(u,n),_=u.subViewports||[u];for(const d of _){const m=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:d,view:f,pass:n.pass,layers:n.layers},h);c.push(m)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var d;const u=[],f=kT(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},_={};for(let m=0;m<n.length;m++){const E=n[m],p=this._shouldDrawLayer(E,h,s,_),g={shouldDrawLayer:p};p&&!c&&(g.layerRenderIndex=f(E,p),g.moduleParameters=this._getModuleParameters(E,a,r,l),g.layerParameters={...(d=E.context.deck)==null?void 0:d.props.parameters,...this.getLayerParameters(E,m,e)}),u[m]=g}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=WC(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:_,layerRenderIndex:d,moduleParameters:m,layerParameters:E}=l[f];if(_&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(_){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,d),m.viewport=o,h.context.renderPass=e;try{h._drawLayer({renderPass:e,moduleParameters:m,uniforms:{layerIndex:d},parameters:E})}catch(p){h.raiseError(p,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function kT(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||kT(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function WC(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class HC extends Zd{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const $C={color:[255,255,255],intensity:1},X_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],XC=[0,0,0,200/255];class FT{constructor(e={}){this.id="lighting-effect",this.shadowColor=XC,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(H_),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(H_))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Nt().lookAt({eye:new Jt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new HC(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new BC($C),this.directionalLights.push(new $_(X_[0]),new $_(X_[1])))}}class YC{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Li=new YC;function Ss(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function KC(t,e){const n=t%e;return n<0?e+n:n}function ZC(t){return[t[12],t[13],t[14]]}function qC(t){return{left:Wr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Wr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Wr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Wr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Wr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Wr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Y_=new Jt;function Wr(t,e,n,r){Y_.set(t,e,n);const i=Y_.len();return{distance:r/i,normal:new Jt(-t/i,-e/i,-n/i)}}function QC(t){return t-Math.fround(t)}let cs;function Ou(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;cs=Li.allocate(cs,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];cs[a+l]=c,cs[a+l+n]=QC(c)}a+=n*2}return cs.subarray(0,s*n*2)}function JC(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const GC=Math.PI/180,e2=Ss(),K_=[0,0,0],t2={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function n2({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new Nt().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new Nt().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:_=0}=s,d=rt((u+t-f)/2,0,t)-t/2,m=rt((h+e-_)/2,0,e)-e/2;c[8]-=d*2/t,c[9]+=m*2/e}return c}class Pc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||t2,this.focalDistance=e.focalDistance||1,this.position=e.position||K_,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Kt.WEB_MERCATOR:Kt.WEB_MERCATOR_AUTO_OFFSET:Kt.IDENTITY}equals(e){return e instanceof Pc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&lo(e.projectionMatrix,this.projectionMatrix)&&lo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=NT(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=bc([i,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(r)?[u,f,r]:[u,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Bl(e);return n[1]=rt(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Ui(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Th({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,qC(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=pC({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Th({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=K_;if(s&&(a=o?new Nt(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new Jt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=e2,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Nt().multiplyRight(n).translate(new Jt(this.center).negate()),this.projectionMatrix=r||n2({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*GC,focalDistance:u,padding:c,near:a,far:l});const f=Ss();Tr(f,f,this.projectionMatrix),Tr(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=gh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=ZC(this.viewMatrixInverse);const h=Ss(),_=Ss();$d(h,h,[this.width/2,-this.height/2,1]),Fl(h,h,[1,-1,0]),Tr(_,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=_,this.pixelUnprojectionMatrix=gh(Ss(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||J.warn("Pixel project matrix not invertible")()}}Pc.displayName="Viewport";const qd=Pc;class co extends qd{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:_=!1,worldOffset:d=0,position:m,padding:E,legacyMeterSizes:p=!1}=e;let{width:g,height:y,altitude:A=1.5}=e;const x=Math.pow(2,i);g=g||1,y=y||1;let I,O=null;if(h)A=h[5]/2,I=Ul(A);else{e.fovy?(I=e.fovy,A=Kd(I)):I=Ul(A);let k;if(E){const{top:U=0,bottom:j=0}=E;k=[0,rt((U+y-j)/2,0,y)-y/2]}O=_C({width:g,height:y,scale:x,center:m&&[0,0,m[2]*Mu(n)],offset:k,pitch:s,fovy:I,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(O.near=c),Number.isFinite(u)&&(O.far=u)}let N=gC({height:y,pitch:s,bearing:o,scale:x,altitude:A});d&&(N=new Nt().translate([512*d,0,0]).multiplyLeft(N)),super({...e,width:g,height:y,viewMatrix:N,longitude:r,latitude:n,zoom:i,...O,fovy:I,focalDistance:A}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=A,this.fovy=I,this.orthographic=f,this._subViewports=_?[]:null,this._pseudoMeters=p,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new co({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Mu(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Mu(r);return[n,r,i]}addMetersToLngLat(e,n){return OT(e,n)}panByPosition(e,n){const r=bc(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=D_([],i,nx([],r)),o=D_([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=vC(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=mC({width:r,height:i,bounds:e,...n});return new co({width:r,height:i,longitude:s,latitude:o,zoom:a})}}co.displayName="WebMercatorViewport";const DT=co,Z_=[0,0,0];function Nu(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof DT){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function r2(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===q.DEFAULT&&(i=e.isGeospatial?q.LNGLAT:q.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function BT(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=bo([],[o,a,l,1],n)),r){case q.LNGLAT:return Nu([o,a,l],e,s);case q.LNGLAT_OFFSETS:return Nu([o+i[0],a+i[1],l+(i[2]||0)],e,s);case q.METER_OFFSETS:return Nu(OT(i,[o,a,l]),e,s);case q.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function i2(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=r2(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Z_,shaderCoordinateOrigin:u=Z_,offsetMode:f=!1}=l?IT(n,r,i):{},h=BT(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const _=n.projectPosition(c||u);mx(h,h,_)}return h}let s2=1,o2=1;class UT{constructor(){T(this,"time",0);T(this,"channels",new Map);T(this,"animations",new Map);T(this,"playing",!1);T(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=s2++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=o2++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let a2=0;const l2={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:vi.stats.get(`animation-loop-${a2++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class c2{constructor(e){T(this,"device",null);T(this,"canvas",null);T(this,"props");T(this,"animationProps",null);T(this,"timeline",null);T(this,"stats");T(this,"cpuTime");T(this,"gpuTime");T(this,"frameRate");T(this,"display");T(this,"needsRedraw","initialized");T(this,"_initialized",!1);T(this,"_running",!1);T(this,"_animationFrameId",null);T(this,"_nextFramePromise",null);T(this,"_resolveNextFrame",null);T(this,"_cpuStartTime",0);if(this.props={...l2,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Sc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=qb(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Qb(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class q_{constructor(e){T(this,"id");T(this,"userData",{});T(this,"topology");T(this,"bufferLayout",[]);T(this,"vertexCount");T(this,"indices");T(this,"attributes");this.id=e.id||kr("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&ie(this.indices.usage===ce.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function u2(t,e){if(e instanceof q_)return e;const n=f2(t,e),{attributes:r,bufferLayout:i}=h2(t,e);return new q_({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function f2(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:ce.INDEX,data:n})}function h2(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:$b(l,c,u)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class d2{constructor(e){T(this,"modules");T(this,"moduleUniforms");T(this,"moduleBindings");T(this,"moduleUniformsChanged");const n=Ac(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;B.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){B.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:f}=Hd(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const rc=class rc{constructor(e){T(this,"device");T(this,"_hashCounter",0);T(this,"_hashes",{});T(this,"_renderPipelineCache",{});T(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new rc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Oi.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Ml.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Ml?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};T(rc,"defaultProps",{...Oi.defaultProps});let wh=rc;const ic=class ic{constructor(e){T(this,"device");T(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new ic(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};T(ic,"defaultProps",{...xl.defaultProps});let Sh=ic;function p2(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let xe=null,ku=null;function g2(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){xe||(xe=document.createElement("canvas"),xe.id=e,xe.title=e,xe.style.zIndex="100",xe.style.position="absolute",xe.style.top=i,xe.style.left=s,xe.style.border="blue 1px solid",xe.style.transform="scaleY(-1)",document.body.appendChild(xe),ku=xe.getContext("2d")),(xe.width!==t.width||xe.height!==t.height)&&(xe.width=t.width/2,xe.height=t.height/2,xe.style.width="400px",xe.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=ku.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=r?255:a[u+3]*o;ku.putImageData(l,0,0)}const Hr=2,_2=1e4,sc=class sc{constructor(e,n){T(this,"device");T(this,"id");T(this,"source");T(this,"vs");T(this,"fs");T(this,"pipelineFactory");T(this,"shaderFactory");T(this,"userData",{});T(this,"parameters");T(this,"topology");T(this,"bufferLayout");T(this,"isInstanced");T(this,"instanceCount",0);T(this,"vertexCount");T(this,"indexBuffer",null);T(this,"bufferAttributes",{});T(this,"constantAttributes",{});T(this,"bindings",{});T(this,"uniforms",{});T(this,"vertexArray");T(this,"transformFeedback",null);T(this,"pipeline");T(this,"shaderInputs");T(this,"_uniformStore");T(this,"_attributeInfos",{});T(this,"_gpuGeometry",null);T(this,"_getModuleUniforms");T(this,"props");T(this,"_pipelineNeedsUpdate","newly created");T(this,"_needsRedraw","initializing");T(this,"_destroyed",!1);T(this,"_lastDrawTimestamp",-1);T(this,"_lastLogTime",0);T(this,"_logOpen",!1);T(this,"_drawCount",0);var a,l,c,u;this.props={...sc.defaultProps,...n},n=this.props,this.id=n.id||kr("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(f=>[f.name,f]))||[]);this.setShaderInputs(n.shaderInputs||new d2(r));const i=m2(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=kP(this.props.source));const{source:f,getUniforms:h}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=f,this._getModuleUniforms=h}else{const{vs:f,fs:h,getUniforms:_}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=f,this.fs=h,this._getModuleUniforms=_}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||wh.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Sh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),bl(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&u2(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=Q_(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Q_(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){fh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Hb(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&B.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>J_(l).includes(r));if(!s){B.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=J_(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&B.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||B.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){bl(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=Hd(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Pl?e=Math.max(e,n.texture.updateTimestamp):n instanceof ce||n instanceof gt?e=Math.max(e,n.updateTimestamp):n instanceof Cl||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(B.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=oT(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=B.level>3?0:_2;B.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,B.group(Hr,`>>> DRAWING MODEL ${this.id}`,{collapsed:B.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=p2(this.pipeline.shaderLayout,this.id);B.table(Hr,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};B.table(Hr,n)();const r=this._getAttributeDebugTable();B.table(Hr,this._attributeInfos)(),B.table(Hr,r)(),B.groupEnd(Hr)(),this._logOpen=!1}}_logFramebuffer(e){const n=B.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&g2(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=cT(n);return(e instanceof ce?new r(e.debugData):e).toString()}};T(sc,"defaultProps",{...Oi.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Rl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Mt=sc;function Q_(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function m2(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function J_(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class uo{constructor(e,n=Mt.defaultProps){T(this,"device");T(this,"model");T(this,"transformFeedback");ie(uo.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Mt(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||X3(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof ce)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class zi{constructor(e){T(this,"id");T(this,"topology");T(this,"vertexCount");T(this,"indices");T(this,"attributes");T(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||kr("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;ie(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(ie(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return ie(Number.isFinite(r)),r}}const y2={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class LT extends Zd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:_="picking",pickZ:d,moduleParameters:m}){this.pickZ=d;const E=this._resetColorEncoder(d),p=[a,l,c,u],g=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(A=>A.useInPicking),pass:_,isPicking:!0,moduleParameters:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:p});return this._colorEncoderState=null,{decodePickingColor:E&&T2.bind(null,E),stats:g}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,y2),i.blend=!0,i.blendColor=v2(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function v2(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(J.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function T2(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Xr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ll=Symbol.for("component"),Hn=Symbol.for("propTypes"),Fu=Symbol.for("deprecatedProps"),Si=Symbol.for("asyncPropDefaults"),Pr=Symbol.for("asyncPropOriginal"),Nn=Symbol.for("asyncPropResolved");function Qd(t,e=()=>!0){return Array.isArray(t)?zT(t,e,[]):e(t)?[t]:[]}function zT(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?zT(i,e,n):e(i)&&n.push(i)}return n}function w2({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class S2{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=El(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class E2{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new S2(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const A2="layerManager.setLayers",R2="layerManager.activateViewport";class b2{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{ze(R2,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new E2({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:NC(),defaultShaderModules:[],renderPass:void 0,stats:i||new Sc({id:"deck.gl"}),viewport:s||new qd({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new UT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ze(A2,this,n,e),this._lastRenderedLayers=e;const r=Qd(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?J.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&J.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Xr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Xr.MATCHED,n!==e&&(e.lifecycle=Xr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Xr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Xr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Pt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Pt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Pt(t[s],e[s],n-1))return!1;return!0}return!1}class P2{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Qd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Pt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):J.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const x2=/([0-9]+\.?[0-9]*)(%|px)/;function wn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=x2.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Sn(t,e){return t.relative?Math.round(t.position*e):t.position}class VT{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=wn(r),this._y=wn(i),this._width=wn(s),this._height=wn(o),this._padding=a&&{left:wn(a.left||0),right:wn(a.right||0),top:wn(a.top||0),bottom:wn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Pt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Sn(this._x,e),y:Sn(this._y,n),width:Sn(this._width,e),height:Sn(this._height,n)};return this._padding&&(r.padding={left:Sn(this._padding.left,e),top:Sn(this._padding.top,n),right:Sn(this._padding.right,e),bottom:Sn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class xc{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const G_=()=>{},Eh={BREAK:1,SNAP_TO_END:2,IGNORE:3},C2=t=>t,I2=Eh.BREAK;class M2{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new xc(e.timeline),this.onViewStateChange=e.onViewStateChange||G_,this.onStateChange=e.onStateChange||G_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Eh.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Eh.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||C2,interpolator:s,interruption:n.transitionInterruption||I2,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function ke(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class O2{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!lo(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ke(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const N2=["longitude","latitude","zoom","bearing","pitch"],k2=["longitude","latitude","zoom"];class Jd extends O2{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:N2,required:k2},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=kl(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,kl(e.around,n.around,r)))}return i}}const En={transitionDuration:0},F2=300,pa=t=>1-(1-t)*(1-t),$r={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},rr={};class jT{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new M2({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?F2:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents($r.WHEEL,u&&r),this.toggleEvents($r.PAN,u),this.toggleEvents($r.PINCH,u&&(a||l)),this.toggleEvents($r.TRIPLE_PAN,u&&l),this.toggleEvents($r.DOUBLE_TAP,u&&o),this.toggleEvents($r.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,En,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,En,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:pa},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,En,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:pa},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,En,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,En,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:pa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return rr._startPinchRotation=e.rotation,rr._lastPinchEvent=e,this.updateViewport(r,En,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:rr._startPinchRotation-r})}return this.updateViewport(n,En,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),rr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=rr;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:pa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return rr._startPinchRotation=null,rr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?En:e?{...n,transitionInterpolator:new Jd({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class WT{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const em=5,D2=1.2;class B2 extends WT{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:_=60,minPitch:d=0,startPanLngLat:m,startZoomLngLat:E,startRotatePos:p,startBearing:g,startPitch:y,startZoom:A,normalize:x=!0}=e;ke(Number.isFinite(s)),ke(Number.isFinite(i)),ke(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:_,minPitch:d,normalize:x,position:u},{startPanLngLat:m,startZoomLngLat:E,startRotatePos:p,startBearing:g,startPitch:y,startZoom:A}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=rt(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=rt(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=rt(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,TC(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>em&&(h=o/(l-u)*D2):o<0&&l>em&&(h=1-a/l),h=rt(h,-1,1);const{minPitch:_,maxPitch:d}=this.getViewportProps(),m=i+180*f;let E=r;return h>0?E=r+h*(d-r):h<0&&(E=r-h*(_-r)),{pitch:E,bearing:m}}}class U2 extends jT{constructor(){super(...arguments),this.ControllerState=B2,this.transition={transitionDuration:300,transitionInterpolator:new Jd({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class HT extends VT{constructor(e={}){super(e)}get ViewportType(){return DT}get ControllerType(){return U2}}HT.displayName="MapView";const L2=HT,z2=new FT;function V2(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class j2{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>V2(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Pt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof FT)||this._resolvedEffects.push(z2),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class W2 extends Zd{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const H2="deckRenderer.renderLayers";class $2{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new W2(e),this.pickLayersPass=new LT(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,ze(H2,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const X2={pickedColor:null,pickedObjectIndex:-1};function Y2({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,f=-1,h=0;for(let _=0;_<c;_++){const d=_+a-r,m=d*d;if(m>u)h+=4*l;else for(let E=0;E<l;E++){if(t[h+3]-1>=0){const g=E+o-n,y=g*g+m;y<=u&&(u=y,f=h)}h+=4}}if(f>=0){const _=t.slice(f,f+4),d=e(_);if(d){const m=Math.floor(f/4/l),E=f/4-m*l;return{...d,pickedColor:_,pickedX:o+E,pickedY:a+m}}J.error("Picked non-existent layer. Is picking buffer corrupt?")()}return X2}function K2({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):J.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function $T({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=q2((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function Z2(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,_=o?o.props.id:null;if(_!==h||a!==f){if(_!==h){const d=i.find(m=>m.props.id===h);d&&l.unshift(d)}n.layerId=_,n.index=a,n.info=null}}const c=$T(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=XT({layer:f,info:h,mode:r});const _=h.layer;f===o&&r==="hover"&&(n.info=h),u.set(_.id,h),r==="hover"&&_.updateAutoHighlight(h)}),u}function XT({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function q2(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class Q2{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new LT(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),_=this._getPickable(e);if(!_||r.length===0)return{result:[],emptyInfo:$T({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const d=this.device.canvasContext.cssToDevicePixels([i,s],!0),m=[d.x+Math.floor(d.width/2),d.y+Math.floor(d.height/2)],E=Math.round(o*h),{width:p,height:g}=this.pickingFBO,y=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:E,deviceWidth:p,deviceHeight:g}),A={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let x;const I=[],O=new Set;for(let N=0;N<a;N++){let k;if(y){const j=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:u,deviceRect:y,cullRect:A,effects:f,pass:`picking:${l}`});k=Y2({...j,deviceX:m[0],deviceY:m[1],deviceRadius:E,deviceRect:y})}else k={pickedColor:null,pickedObjectIndex:-1};let U;if(k.pickedLayer&&c&&this.depthFBO){const{pickedColors:j}=this._drawAndSample({layers:[k.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:A,effects:f,pass:`picking:${l}:z`},!0);j[3]&&(U=j[0])}k.pickedLayer&&N+1<a&&(O.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),x=Z2({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:l,layers:_,viewports:r,x:i,y:s,z:U,pixelRatio:h});for(const j of x.values())j.layer&&I.push(j);if(!k.pickedColor)break}for(const N of O)N.restorePickingColors();return{result:I,emptyInfo:x.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const _=this.device.canvasContext.cssToDeviceRatio(),d=this.device.canvasContext.cssToDevicePixels([i,s],!0),m=d.x,E=d.y+d.height,p=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),g=p.x+p.width,y=p.y,A={x:m,y,width:g-m,height:E-y},x=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:A,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),I=K2(x),O=new Map,N=[],k=Number.isFinite(c);for(let U=0;U<I.length&&!(k&&N.length>=c);U++){const j=I[U];let H={color:j.pickedColor,layer:null,index:j.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:_};H=XT({layer:j.pickedLayer,info:H,mode:l});const W=H.layer.id;O.has(W)||O.set(W,new Set);const X=O.get(W),Ae=H.object??H.index;X.has(Ae)||(X.add(Ae),N.push(H))}return N}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const g of a)g.useInPicking&&(f.preRenderStats[g.id]=g.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:_,y:d,width:m,height:E}=s,p=new(c?Float32Array:Uint8Array)(m*E*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:_,sourceY:d,sourceWidth:m,sourceHeight:E,target:p}),{pickedColors:p,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const J2={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},G2="top-left",tm="__root";class eI{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Pt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=G2}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||tm;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,J2[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===tm||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=mh[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const tI={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class nI{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,tI),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var oi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(oi||(oi={}));const Gd={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Se=(t,e,n)=>e?t.enable(n):t.disable(n),nm=(t,e,n)=>t.hint(n,e),et=(t,e,n)=>t.pixelStorei(n,e),rm=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},us=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function Du(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const rI={3042:Se,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Se,2885:(t,e)=>t.cullFace(e),2929:Se,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Se,35723:nm,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:rm,36010:rm,34964:us,36662:us,36663:us,35053:us,35055:us,2886:(t,e)=>t.frontFace(e),33170:nm,2849:(t,e)=>t.lineWidth(e),32823:Se,32824:"polygonOffset",10752:"polygonOffset",35977:Se,32926:Se,32928:Se,32938:"sampleCoverage",32939:"sampleCoverage",3089:Se,3088:(t,e)=>t.scissor(...e),2960:Se,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Se,10754:Se,12288:Se,12289:Se,12290:Se,12291:Se,12292:Se,12293:Se,12294:Se,12295:Se,3333:et,3317:et,37440:et,37441:et,37443:et,3330:et,3332:et,3331:et,3314:et,32878:et,3316:et,3315:et,32877:et,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Du(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Du(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Du(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function me(t,e,n){return e[t]!==void 0?e[t]:n[t]}const iI={blendEquation:(t,e,n)=>t.blendEquationSeparate(me(32777,e,n),me(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(me(32969,e,n),me(32968,e,n),me(32971,e,n),me(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(me(32824,e,n),me(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(me(32938,e,n),me(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,me(2962,e,n),me(2967,e,n),me(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,me(34816,e,n),me(36003,e,n),me(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,me(2964,e,n),me(2965,e,n),me(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,me(34817,e,n),me(34818,e,n),me(34819,e,n))},im={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Vt=(t,e)=>t.isEnabled(e),sm={3042:Vt,2884:Vt,2929:Vt,3024:Vt,32823:Vt,32926:Vt,32928:Vt,3089:Vt,2960:Vt,35977:Vt},sI=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Hi(t,e){if(aI(e))return;const n={};for(const i in e){const s=Number(i),o=rI[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=iI[i];s(t,e,r)}}function YT(t,e=Gd){if(typeof e=="number"){const i=e,s=sm[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=sm[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function oI(t){Hi(t,Gd)}function aI(t){for(const e in t)return!1;return!0}function lI(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class cI{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){T(this,"gl");T(this,"program",null);T(this,"stateStack",[]);T(this,"enable",!0);T(this,"cache");T(this,"log");this.gl=e,this.cache=n?YT(e):Object.assign({},Gd),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){ie(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Hi(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){ie(s!==void 0);const o=e[s],a=this.cache[s];lI(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function xr(t){return t.state}function KT(t,e){const{enable:n=!0,copyState:r}=e;if(ie(r!==void 0),!t.state){t.state=new cI(t,{copyState:r}),fI(t);for(const s in im){const o=im[s];uI(t,s,o)}om(t,"getParameter"),om(t,"isEnabled")}const i=xr(t);return i.enable=n,t}function Cc(t){let e=xr(t);e||(KT(t,{copyState:!1}),e=xr(t)),e.push()}function fo(t){const e=xr(t);ie(e),e.pop()}function om(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||sI.has(i))return n(i);const s=xr(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function uI(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=xr(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function fI(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=xr(t);i.program!==r&&(e(r),i.program=r)}}const hI={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function dI(t,e){e={...hI,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function Zn(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function pI(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Zn(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=ZT(a,l),f=gI(a,l),h=_I(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ZT(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function gI(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function _I(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(ZT(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function qT(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Le="texture-compression-bc",ee="texture-compression-astc",jt="texture-compression-etc2",mI="texture-compression-etc1-webgl",ga="texture-compression-pvrtc-webgl",Bu="texture-compression-atc-webgl",fs="float32-renderable-webgl",Uu="float16-renderable-webgl",yI="rgb9e5ufloat_renderable-webgl",Lu="snorm8-renderable-webgl",hs="norm16-renderable-webgl",zu="snorm16-renderable-webgl",_a="float32-filterable",am="float16-filterable-webgl",Es="WEBGL_compressed_texture_s3tc",As="WEBGL_compressed_texture_s3tc_srgb",ai="EXT_texture_compression_rgtc",li="EXT_texture_compression_bptc",vI="WEBGL_compressed_texture_etc",TI="WEBGL_compressed_texture_astc",wI="WEBGL_compressed_texture_etc1",SI="WEBGL_compressed_texture_pvrtc",EI="WEBGL_compressed_texture_atc",lm="EXT_texture_norm16",cm="EXT_render_snorm",AI="EXT_color_buffer_float",ep={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[cm],"norm16-renderable-webgl":[lm],"snorm16-renderable-webgl":[lm,cm],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Es,As,ai,li],"texture-compression-bc5-webgl":[ai],"texture-compression-bc7-webgl":[li],"texture-compression-etc2":[vI],"texture-compression-astc":[TI],"texture-compression-etc1-webgl":[wI],"texture-compression-pvrtc-webgl":[SI],"texture-compression-atc-webgl":[EI]};function RI(t){return t in ep}function bI(t,e,n){return(ep[e]||[]).every(i=>Zn(t,i,n))}const Ic={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Lu},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Lu},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Uu,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:hs,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:zu},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Lu},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Uu,filter:am,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:hs},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:zu},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:fs,filter:_a},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:yI},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:fs,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:hs},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:hs},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:fs,filter:_a,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Uu,filter:am},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:hs,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:zu},"rgb32float-webgl":{gl:34837,render:fs,filter:_a,gl2ext:AI,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:fs,filter:_a,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Es,f:Le},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:As,f:Le},"bc1-rgba-unorm":{gl:33777,x:Es,f:Le},"bc1-rgba-unorm-srgb":{gl:35916,x:As,f:Le},"bc2-rgba-unorm":{gl:33778,x:Es,f:Le},"bc2-rgba-unorm-srgb":{gl:35918,x:As,f:Le},"bc3-rgba-unorm":{gl:33779,x:Es,f:Le},"bc3-rgba-unorm-srgb":{gl:35919,x:As,f:Le},"bc4-r-unorm":{gl:36283,x:ai,f:Le},"bc4-r-snorm":{gl:36284,x:ai,f:Le},"bc5-rg-unorm":{gl:36285,x:ai,f:Le},"bc5-rg-snorm":{gl:36286,x:ai,f:Le},"bc6h-rgb-ufloat":{gl:36495,x:li,f:Le},"bc6h-rgb-float":{gl:36494,x:li,f:Le},"bc7-rgba-unorm":{gl:36492,x:li,f:Le},"bc7-rgba-unorm-srgb":{gl:36493,x:li,f:Le},"etc2-rgb8unorm":{gl:37492,f:jt},"etc2-rgb8unorm-srgb":{gl:37494,f:jt},"etc2-rgb8a1unorm":{gl:37496,f:jt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:jt},"etc2-rgba8unorm":{gl:37493,f:jt},"etc2-rgba8unorm-srgb":{gl:37495,f:jt},"eac-r11unorm":{gl:37488,f:jt},"eac-r11snorm":{gl:37489,f:jt},"eac-rg11unorm":{gl:37490,f:jt},"eac-rg11snorm":{gl:37491,f:jt},"astc-4x4-unorm":{gl:37808,f:ee},"astc-4x4-unorm-srgb":{gl:37840,f:ee},"astc-5x4-unorm":{gl:37809,f:ee},"astc-5x4-unorm-srgb":{gl:37841,f:ee},"astc-5x5-unorm":{gl:37810,f:ee},"astc-5x5-unorm-srgb":{gl:37842,f:ee},"astc-6x5-unorm":{gl:37811,f:ee},"astc-6x5-unorm-srgb":{gl:37843,f:ee},"astc-6x6-unorm":{gl:37812,f:ee},"astc-6x6-unorm-srgb":{gl:37844,f:ee},"astc-8x5-unorm":{gl:37813,f:ee},"astc-8x5-unorm-srgb":{gl:37845,f:ee},"astc-8x6-unorm":{gl:37814,f:ee},"astc-8x6-unorm-srgb":{gl:37846,f:ee},"astc-8x8-unorm":{gl:37815,f:ee},"astc-8x8-unorm-srgb":{gl:37847,f:ee},"astc-10x5-unorm":{gl:37819,f:ee},"astc-10x5-unorm-srgb":{gl:37851,f:ee},"astc-10x6-unorm":{gl:37817,f:ee},"astc-10x6-unorm-srgb":{gl:37849,f:ee},"astc-10x8-unorm":{gl:37818,f:ee},"astc-10x8-unorm-srgb":{gl:37850,f:ee},"astc-10x10-unorm":{gl:37819,f:ee},"astc-10x10-unorm-srgb":{gl:37851,f:ee},"astc-12x10-unorm":{gl:37820,f:ee},"astc-12x10-unorm-srgb":{gl:37852,f:ee},"astc-12x12-unorm":{gl:37821,f:ee},"astc-12x12-unorm-srgb":{gl:37853,f:ee},"pvrtc-rgb4unorm-webgl":{gl:35840,f:ga},"pvrtc-rgba4unorm-webgl":{gl:35842,f:ga},"pvrtc-rbg2unorm-webgl":{gl:35841,f:ga},"pvrtc-rgba2unorm-webgl":{gl:35843,f:ga},"etc1-rbg-unorm-webgl":{gl:36196,f:mI},"atc-rgb-unorm-webgl":{gl:35986,f:Bu},"atc-rgba-unorm-webgl":{gl:35986,f:Bu},"atc-rgbai-unorm-webgl":{gl:34798,f:Bu}},PI={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},xI={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function tp(t,e,n){const r=Ic[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!Zn(t,i,n):!0}function QT(t){const e=Ic[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function CI(t,e,n){if(!tp(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(nT(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Zn(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Zn(t,"OES_texture_half_float_linear, extensions",n):!0}function II(t,e,n){return!(!tp(t,e,n)||typeof e=="number")}function zl(t){var i;const e=Ic[t],n=QT(t),r=nT(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||OI(r.format,r.integer,r.normalized,n),type:r.dataType?qT(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function MI(t){const e=Ic[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function um(t){const e=zl(t),n=PI[e.dataFormat]||4,r=xI[e.type]||1;return n*r}function OI(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const fm={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class NI extends lb{constructor(n,r,i){super([],i);T(this,"gl");T(this,"extensions");T(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Zn(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),RI(n)&&bI(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(fm),...Object.keys(ep)]}getWebGLFeature(n){const r=fm[n];return typeof r=="string"?!!Zn(this.gl,r,this.extensions):!!r}}class kI extends ab{constructor(n){super();T(this,"gl");T(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function kn(t,e,n){if(FI(e))return n(t);const{nocatch:r=!0}=e;Cc(t),Hi(t,e);let i;if(r)i=n(t),fo(t);else try{i=n(t)}finally{fo(t)}return i}function FI(t){for(const e in t)return!1;return!0}function DI(t,e,n,r){if(bl(e))return r(t);const i=t;Cc(i.gl);try{return BI(t,e),Hi(i.gl,n),r(t)}finally{fo(i.gl)}}function BI(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(wr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=wr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=wr("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(LI("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Ah("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&B.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Ah("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Vu("stencilPassOperation",e.stencilPassOperation),s=Vu("stencilFailOperation",e.stencilFailOperation),o=Vu("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=hm("blendColorOperation",e.blendColorOperation||"add"),s=hm("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=ma("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=ma("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=ma("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=ma("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Ah(t,e){return wr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Vu(t,e){return wr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function hm(t,e){return wr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ma(t,e){return wr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function UI(t,e){return`Illegal parameter ${e} for ${t}`}function wr(t,e,n){if(!(e in n))throw new Error(UI(t,e));return n[e]}function LI(t,e){return e}function JT(t){const e={};return t.addressModeU&&(e[10242]=ju(t.addressModeU)),t.addressModeV&&(e[10243]=ju(t.addressModeV)),t.addressModeW&&(e[32882]=ju(t.addressModeW)),t.magFilter&&(e[10240]=GT(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=zI(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Ah("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function ju(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function GT(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function zI(t,e){if(!e)return GT(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class $n extends ce{constructor(n,r={}){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"glTarget");T(this,"glUsage");T(this,"glIndexType",5123);T(this,"byteLength");T(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=VI(this.props.usage),this.glUsage=jI(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){ie(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function VI(t){return t&ce.INDEX?34963:t&ce.VERTEX?34962:t&ce.UNIFORM?35345:34962}function jI(t){return t&ce.INDEX||t&ce.VERTEX?35044:t&ce.UNIFORM?35048:35044}class Rh extends Cl{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"parameters");this.device=n,this.parameters=JT(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class ci extends Pl{constructor(n,r){super(n,{...gt.defaultProps,...r});T(this,"device");T(this,"gl");T(this,"handle");T(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const WI={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},js=class js extends gt{constructor(n,r){var i;super(n,{...WI,format:"rgba8unorm",...r});T(this,"MAX_ATTRIBUTES");T(this,"device");T(this,"gl");T(this,"handle");T(this,"sampler");T(this,"view");T(this,"glFormat");T(this,"type");T(this,"dataFormat");T(this,"mipmaps");T(this,"target");T(this,"textureUnit");T(this,"loaded",!1);T(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=HI(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:Zb(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new ci(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(p=>this.initialize(Object.assign({},n,{pixels:p,data:p}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;r||(r=o);let{width:u,height:f,dataFormat:h,type:_,compressed:d=!1}=n;const{depth:m=0}=n,E=QT(n.format);return{width:u,height:f,compressed:d,dataFormat:h,type:_}=this._deduceParameters({format:n.format,type:_,dataFormat:h,compressed:d,data:r,width:u,height:f}),this.width=u,this.height=f,this.glFormat=E,this.type=_,this.dataFormat=h,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:r,width:u,height:f,depth:m,format:n.format,type:_,dataFormat:h,parameters:a,compressed:d}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof Rh?(this.sampler=n,r=n.props):(this.sampler=new Rh(this.device,n),r=n);const i=JT(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),kn(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:_=this.dataFormat,compressed:d=!1}=n;c||(c=i),{type:u,dataFormat:_,compressed:d,width:f,height:h}=this._deduceParameters({format:this.props.format,type:u,dataFormat:_,compressed:d,data:c,width:f,height:h});const{gl:m}=this;m.bindTexture(this.target,this.handle);let E=null;if({data:c,dataType:E}=this._getDataType({data:c,compressed:d}),kn(this.gl,l,()=>{switch(E){case"null":m.texImage2D(r,s,o,f,h,0,_,u,c);break;case"typed-array":m.texImage2D(r,s,o,f,h,0,_,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(r,s,o,f,h,0,_,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":m.texImage2D(r,s,o,f,h,0,_,u,c);break;case"compressed":for(const[p,g]of c.entries())m.compressedTexImage2D(r,p,g.format,g.width,g.height,0,g.data);break;default:ie(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const p=um(this.props.format);this.trackAllocatedMemory(this.width*this.height*p,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:f=this.type,dataFormat:h=this.dataFormat,compressed:_=!1,offset:d=0,parameters:m={}}){if({type:f,dataFormat:h,compressed:_,width:a,height:l}=this._deduceParameters({format:this.props.format,type:f,dataFormat:h,compressed:_,data:i,width:a,height:l}),ie(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const E=i;i=E.data,a=E.shape[0],l=E.shape[1]}i instanceof $n&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),kn(this.gl,m,()=>{_?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i):i===null?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,i,d):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,d),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof $n?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=zl(r);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},ie(s,"Could not deduced texture size"),ie(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),ie(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,f=await Promise.all(js.FACES.map(h=>{const _=u[h];return Promise.all(Array.isArray(_)?_:[_])}));this.bind(),js.FACES.forEach((h,_)=>{f[_].length>1&&this.props.mipmaps!==!1&&B.warn(`${this.id} has mipmap and multiple LODs.`)(),f[_].forEach((d,m)=>{i&&s?r.texImage2D(h,m,l,i,s,0,l,c,d):r.texImage2D(h,m,l,l,c,d)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,f=o||a;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},n,{face:r,data:h,pixels:h}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,f):u.texImage2D(r,0,l,l,c,f),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:f,parameters:h={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const _=zl(s);if(kn(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,r,_.format,a,l,c,0,_.dataFormat,_.type,f),f instanceof $n&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,r,i,a,l,c,0,s,o,u))}),f&&f.byteLength)this.trackAllocatedMemory(f.byteLength,"Texture");else{const d=um(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*d,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!bl(n)){$I(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};T(js,"FACES",[34069,34070,34071,34072,34073,34074]);let Zt=js;function HI(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function $I(t){B.log(1,"texture sampler parameters",t)()}class Bs extends Il{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(MI(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${YI(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new Zt(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof Zt)return this._attachTexture(n,r,0,0),r;if(r instanceof ci){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=XI(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:ie(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function XI(t){return t<34069?t+34069:t}function YI(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class KI extends Wd{constructor(n,r){super(r);T(this,"device");T(this,"presentationSize");T(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Bs(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const ZI={spector:B.get("spector")||B.get("spectorjs")},qI="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",QI=1;let te=null,dm=!1;async function JI(t){if(!globalThis.SPECTOR)try{await uT(qI)}catch(e){B.warn(String(e))}}function GI(t){if(t={...ZI,...t},!(t!=null&&t.spector)||(!te&&globalThis.SPECTOR&&(B.probe(QI,"SPECTOR found and initialized")(),te=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=te)),!te))return null;if(dm||(dm=!0,te.spyCanvases(),te==null||te.onCaptureStarted.add(e=>B.info("Spector capture started:",e)()),te==null||te.onCapture.add(e=>{B.info("Spector capture complete:",e)(),te==null||te.getResultUI(),te==null||te.resultView.display(),te==null||te.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return te;te==null||te.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{B.info("Spector capture stopped after 2 seconds")(),te==null||te.stopCapture()})}return te}const eM="https://unpkg.com/webgl-debug@2.0.1/index.js";function ew(t){return t.luma=t.luma||{},t.luma}async function tM(){Gn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await uT(eM))}function nM(t,e={}){return t?e.debug?iM(t,e):rM(t):null}function rM(t){const e=ew(t);return e.realContext?e.realContext:t}function iM(t,e){if(!globalThis.WebGLDebugUtils)return B.warn("webgl-debug not loaded")(),t;const n=ew(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...oi,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,sM.bind(null,e),oM.bind(null,e));for(const o in oi)!(o in r)&&typeof oi[o]=="number"&&(r[o]=oi[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function Wu(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function sM(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;B.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function oM(t,e,n){let r="";if(B.level>=1&&(r=Wu(e,n),B.log(1,r)()),t.break&&t.break.length>0&&(r=r||Wu(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||Wu(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);B.error(`Undefined argument: ${r}`)();debugger}}function aM(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[f,h]=i;n.push({message:h.trim(),type:pm(f),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:pm(s),lineNum:c,linePos:u})}return n}function pm(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class lM extends xl{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return aM(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),B.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}B.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),B.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const cM=256,uM=1024,fM=16384,Hu=6144,hM=[1,2,4,8];class dM extends sh{constructor(n,r){super(n,r);T(this,"device");T(this,"glParameters");this.device=n,Cc(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){fo(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=hM.map(i=>!!(i&n.colorMask))),this.glParameters=r,Hi(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=fM,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=cM,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=uM,n.clearStencil=this.props.clearStencil),r!==0&&kn(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){kn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(Hu,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(Hu,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(Hu,n,r);break}})}}const pM="Failed to deduce GL constant from typed array";function gM(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(pM)}}function bh(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const _M={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},mM={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Us{constructor(...e){T(this,"offset");T(this,"stride");T(this,"type");T(this,"size");T(this,"divisor");T(this,"normalized");T(this,"integer");T(this,"buffer");T(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return bh(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ie(e.size),bh(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Us(_M,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Us.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Us.getBytesPerVertex(this)}_assign(e={}){return e=Yb("Accessor",e,mM),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function yM(t){return vM.includes(t)}const vM=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],tw={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function nw(t){const e=tw[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function TM(t){const e=tw[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function wM(t,e){const n={attributes:[],bindings:[]};n.attributes=SM(t,e);const r=RM(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=AM(t,e);let s=0;for(const a of i)if(yM(a.type)){const{viewDimension:l,sampleType:c}=PM(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=EM(t,e);return o!=null&&o.length&&(n.varyings=o),n}function SM(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=TM(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function EM(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=nw(a),f=new Us({type:c,size:l*u}),h={location:i,name:o,accessor:f};n.push(h)}return n.sort((i,s)=>i.location-s.location),n}function AM(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=xM(o);let f=t.getUniformLocation(e,c);const h={location:f,name:c,size:a,type:l,isArray:u};if(n.push(h),h.size>1)for(let _=0;_<h.size;_++){const d=`${c}[${_}]`;f=t.getUniformLocation(e,d);const m={...h,name:d,location:f};n.push(m)}}return n}function RM(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),f=t.getActiveUniforms(e,a,35388);for(let h=0;h<o.uniformCount;++h){const _=t.getActiveUniform(e,a[h]);if(!_)throw new Error("activeInfo");o.uniforms.push({name:_.name,format:nw(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const bM={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function PM(t){const e=bM[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function xM(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function CM(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function IM(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function MM(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const gm=4;class OM extends Oi{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"vs");T(this,"fs");T(this,"introspectedLayout");T(this,"uniforms",{});T(this,"bindings",{});T(this,"varyings",null);T(this,"_uniformCount",0);T(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),B.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=wM(this.device.gl,this.handle),B.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=kb(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":B.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||B.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||B.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof $n)&&!(s.buffer instanceof $n))throw new Error("buffer value");break;case"texture":if(!(s instanceof ci||s instanceof Zt||s instanceof Bs))throw new Error("texture value");break;case"sampler":B.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var E;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:f}=n,h=IM(s),_=!!o.indexBuffer,d=(E=o.indexBuffer)==null?void 0:E.glIndexType;if(this.linkStatus!=="success")return B.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const m=r;return DI(this.device,i,m.glParameters,()=>{_&&c?this.device.gl.drawElementsInstanced(h,a||0,d,u,l||0):_?this.device.gl.drawElements(h,a||0,d,u):c?this.device.gl.drawArraysInstanced(h,u,a||0,l||0):this.device.gl.drawArrays(h,u,a||0),f&&f.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=Hd(n);Object.keys(r).forEach(i=>{B.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),B.time(gm,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),B.timeEnd(gm,`linkProgram for ${this.id}`)(),B.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}B.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),B.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Zt&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof $n?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof ci||o instanceof Zt||o instanceof Bs))throw new Error("texture");let c;if(o instanceof ci)c=o.texture;else if(o instanceof Zt)c=o;else if(o instanceof Bs&&o.colorAttachments[0]instanceof ci)B.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.target,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&CM(this.device.gl,i,s,a)}}}class NM extends ah{constructor(n){super(n,{});T(this,"device");T(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":kM(this.device,r.options);break;case"copy-buffer-to-texture":FM(this.device,r.options);break;case"copy-texture-to-buffer":DM(this.device,r.options);break;case"copy-texture-to-texture":BM(this.device,r.options);break}}}function kM(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function FM(t,e){throw new Error("Not implemented")}function DM(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||f||h)throw new Error("not implemented");const{framebuffer:_,destroyFramebuffer:d}=rw(n);let m;try{const E=c,p=s||_.width,g=o||_.height,y=zl(_.texture.props.format),A=y.dataFormat,x=y.type;t.gl.bindBuffer(35051,E.handle),m=t.gl.bindFramebuffer(36160,_.handle),t.gl.readPixels(l[0],l[1],p,g,A,x,u)}finally{t.gl.bindBuffer(35051,null),m!==void 0&&t.gl.bindFramebuffer(36160,m),d&&_.destroy()}}function BM(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=rw(n),[f,h]=i,[_,d,m]=s,E=t.gl.bindFramebuffer(36160,c.handle);let p=null,g;if(o instanceof Zt)p=o,a=Number.isFinite(a)?a:p.width,l=Number.isFinite(l)?l:p.height,p.bind(0),g=p.target;else throw new Error("invalid destination");switch(g){case 3553:case 34067:t.gl.copyTexSubImage2D(g,r,_,d,f,h,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(g,r,_,d,m,f,h,a,l);break}p&&p.unbind(),t.gl.bindFramebuffer(36160,E),u&&c.destroy()}function rw(t){if(t instanceof gt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class UM extends oh{constructor(n,r){super(n,r);T(this,"device");T(this,"commandBuffer");this.device=n,this.commandBuffer=new NM(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class np extends lh{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"buffer",null);T(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return J1()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:f}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,f||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=qT(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=np.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=LM(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!zM(i,this.bufferValue),a){const l=Ub(r.constructor,o);Lb({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function LM(t){return Array.isArray(t)?new Float32Array(t):t}function zM(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class VM extends ch{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"layout");T(this,"buffers",{});T(this,"unusedBuffers",{});T(this,"bindOnUse",!0);T(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(MM(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,B.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(_m(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof $n)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(_m(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function _m(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class jM extends uh{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"target",null);T(this,"_queryPending",!1);T(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function iw(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ie(!1),0}}function WM(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return ie(!1),0}}function HM(t,e){var E,p;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=sw(t);ie(u);const{gl:h,handle:_}=u;a=a||u.width,l=l||u.height;const d=s-36064;c=c||((p=(E=u.colorAttachments[d])==null?void 0:E.texture)==null?void 0:p.type)||5121,o=YM(o,c,i,a,l),c=c||gM(o);const m=h.bindFramebuffer(36160,_);return h.readPixels(n,r,a,l,i,c,o),h.bindFramebuffer(36160,m||null),f&&u.destroy(),o}function $M(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=sw(t);ie(u),a=a||u.width,l=l||u.height;const h=u;c=c||5121;let _=n;if(!_){const m=iw(s),E=WM(c),p=o+a*l*m*E;_=h.device.createBuffer({byteLength:p})}const d=t.device.createCommandEncoder();return d.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:_,byteOffset:o}),d.destroy(),f&&u.destroy(),_}function sw(t){return t instanceof Il?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:XM(t),deleteFramebuffer:!0}}function XM(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function YM(t,e,n,r,i){if(t)return t;e=e||5121;const s=bh(e,{clamped:!1}),o=iw(n);return new s(r*i*o)}const KM=256,ZM=1024,qM=16384,QM="clear: bad arguments";function JM(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=qM,r!==!0&&(o.clearColor=r)),i&&(a|=KM,i!==!0&&(o.clearDepth=i)),s&&(a|=ZM,i!==!0&&(o.clearStencil=i)),ie(a!==0,QM);const l=t.gl;kn(l,o,()=>{l.clear(a)})}const ds=1,ur=class ur extends Mi{constructor(n){var l,c;super({...n,id:n.id||kr("webgl-device")});T(this,"type","webgl");T(this,"handle");T(this,"features");T(this,"limits");T(this,"info");T(this,"canvasContext");T(this,"lost");T(this,"_resolveContextLost");T(this,"renderPass",null);T(this,"gl");T(this,"debug",!1);T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});T(this,"_extensions",{});T(this,"_polyfilled",!1);T(this,"spectorJS");T(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new KI(this,{...n,canvas:i}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=dI(this.canvasContext.canvas,{...n,onContextLost:u=>{var f;return(f=this._resolveContextLost)==null?void 0:f.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=GI({...this.props,canvas:this.handle.canvas})),this.info=pI(this.gl,this._extensions),this.limits=new kI(this.gl),this.features=new NI(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;KT(this.gl,{enable:o,copyState:a,log:(...u)=>B.log(1,...u)()}),n.debug&&(this.gl=nM(this.gl,{...n,throwOnError:!0}),this.debug=!0,B.level=Math.max(B.level,1),B.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof ur)return n;if((n==null?void 0:n.device)instanceof Mi)return n.device;if(!GM(n))throw new Error("Invalid WebGL2RenderingContext");return new ur({gl:n})}static async create(n={}){var a;B.groupCollapsed(ds,"WebGLDevice created")();const r=[];n.debug&&r.push(tM()),n.spector&&r.push(JI()),typeof n.canvas=="string"&&r.push(Wd.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&B.error(`Failed to initialize debug libraries ${l.reason}`)();if(B.probe(ds+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return B.warn("reattaching existing device")(),ur.attach(n.gl);const s=new ur(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return B.probe(ds,o)(),B.table(ds,s.info)(),B.groupEnd(ds)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return tp(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return CI(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return II(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new $n(this,r)}_createTexture(n){return new Zt(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Rh(this,n)}createShader(n){return new lM(this,n)}createFramebuffer(n){return new Bs(this,n)}createVertexArray(n){return new np(this,n)}createTransformFeedback(n){return new VM(this,n)}createQuerySet(n){return new jM(this,n)}createRenderPipeline(n){return new OM(this,n)}beginRenderPass(n){return new dM(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new UM(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return HM(n,r)}readPixelsToBufferWebGL(n,r){return $M(n,r)}setParametersWebGL(n){Hi(this.gl,n)}getParametersWebGL(n){return YT(this.gl,n)}withParametersWebGL(n,r){return kn(this.gl,n,r)}clearWebGL(n){JM(this,n)}resetWebGL(){B.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),oI(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Cc(this.gl)}popState(){fo(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&rO(s,r)&&B.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:eO(this,n,r);break;case Int32Array:tO(this,n,r);break;case Uint32Array:nO(this,n,r);break;default:ie(!1)}}getExtension(n){return Zn(this.gl,n,this._extensions),this._extensions}};T(ur,"type","webgl");let Ls=ur;function GM(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function eO(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:ie(!1)}}function tO(t,e,n){t.gl.vertexAttribI4iv(e,n)}function nO(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function rO(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var ow={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(v,w,R){return setTimeout(y(v,R),w)}function h(v,w,R){return Array.isArray(v)?(_(v,R[w],R),!0):!1}function _(v,w,R){var M;if(v)if(v.forEach)v.forEach(w,R);else if(v.length!==i)for(M=0;M<v.length;)w.call(R,v[M],M,v),M++;else for(M in v)v.hasOwnProperty(M)&&w.call(R,v[M],M,v)}function d(v,w,R){var M="DEPRECATED METHOD: "+w+`
`+R+` AT 
`;return function(){var F=new Error("get-stack-trace"),z=F&&F.stack?F.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",K=e.console&&(e.console.warn||e.console.log);return K&&K.call(e.console,M,z),v.apply(this,arguments)}}var m;typeof Object.assign!="function"?m=function(w){if(w===i||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var R=Object(w),M=1;M<arguments.length;M++){var F=arguments[M];if(F!==i&&F!==null)for(var z in F)F.hasOwnProperty(z)&&(R[z]=F[z])}return R}:m=Object.assign;var E=d(function(w,R,M){for(var F=Object.keys(R),z=0;z<F.length;)(!M||M&&w[F[z]]===i)&&(w[F[z]]=R[F[z]]),z++;return w},"extend","Use `assign`."),p=d(function(w,R){return E(w,R,!0)},"merge","Use `assign`.");function g(v,w,R){var M=w.prototype,F;F=v.prototype=Object.create(M),F.constructor=v,F._super=M,R&&m(F,R)}function y(v,w){return function(){return v.apply(w,arguments)}}function A(v,w){return typeof v==a?v.apply(w&&w[0]||i,w):v}function x(v,w){return v===i?w:v}function I(v,w,R){_(U(w),function(M){v.addEventListener(M,R,!1)})}function O(v,w,R){_(U(w),function(M){v.removeEventListener(M,R,!1)})}function N(v,w){for(;v;){if(v==w)return!0;v=v.parentNode}return!1}function k(v,w){return v.indexOf(w)>-1}function U(v){return v.trim().split(/\s+/g)}function j(v,w,R){if(v.indexOf&&!R)return v.indexOf(w);for(var M=0;M<v.length;){if(R&&v[M][R]==w||!R&&v[M]===w)return M;M++}return-1}function H(v){return Array.prototype.slice.call(v,0)}function W(v,w,R){for(var M=[],F=[],z=0;z<v.length;){var K=w?v[z][w]:v[z];j(F,K)<0&&M.push(v[z]),F[z]=K,z++}return R&&(w?M=M.sort(function(Me,We){return Me[w]>We[w]}):M=M.sort()),M}function X(v,w){for(var R,M,F=w[0].toUpperCase()+w.slice(1),z=0;z<s.length;){if(R=s[z],M=R?R+F:w,M in v)return M;z++}return i}var Ae=1;function kt(){return Ae++}function Ft(v){var w=v.ownerDocument||v;return w.defaultView||w.parentWindow||e}var L=/mobile|tablet|ip(ad|hone|od)|android/i,$="ontouchstart"in e,Y=X(e,"PointerEvent")!==i,fe=$&&L.test(navigator.userAgent),ae="touch",Dr="pen",Tt="mouse",Xi="kinect",en=25,Te=1,er=2,we=4,Ke=8,Oo=1,Yi=2,Ki=4,Zi=8,qi=16,Dt=Yi|Ki,tr=Zi|qi,mp=Dt|tr,yp=["x","y"],No=["clientX","clientY"];function ut(v,w){var R=this;this.manager=v,this.callback=w,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(M){A(v.options.enable,[v])&&R.handler(M)},this.init()}ut.prototype={handler:function(){},init:function(){this.evEl&&I(this.element,this.evEl,this.domHandler),this.evTarget&&I(this.target,this.evTarget,this.domHandler),this.evWin&&I(Ft(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(Ft(this.element),this.evWin,this.domHandler)}};function Kw(v){var w,R=v.options.inputClass;return R?w=R:Y?w=Dc:fe?w=Do:$?w=Bc:w=Fo,new w(v,Zw)}function Zw(v,w,R){var M=R.pointers.length,F=R.changedPointers.length,z=w&Te&&M-F===0,K=w&(we|Ke)&&M-F===0;R.isFirst=!!z,R.isFinal=!!K,z&&(v.session={}),R.eventType=w,qw(v,R),v.emit("hammer.input",R),v.recognize(R),v.session.prevInput=R}function qw(v,w){var R=v.session,M=w.pointers,F=M.length;R.firstInput||(R.firstInput=vp(w)),F>1&&!R.firstMultiple?R.firstMultiple=vp(w):F===1&&(R.firstMultiple=!1);var z=R.firstInput,K=R.firstMultiple,Pe=K?K.center:z.center,Me=w.center=Tp(M);w.timeStamp=u(),w.deltaTime=w.timeStamp-z.timeStamp,w.angle=Fc(Pe,Me),w.distance=ko(Pe,Me),Qw(R,w),w.offsetDirection=Sp(w.deltaX,w.deltaY);var We=wp(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=We.x,w.overallVelocityY=We.y,w.overallVelocity=c(We.x)>c(We.y)?We.x:We.y,w.scale=K?eS(K.pointers,M):1,w.rotation=K?Gw(K.pointers,M):0,w.maxPointers=R.prevInput?w.pointers.length>R.prevInput.maxPointers?w.pointers.length:R.prevInput.maxPointers:w.pointers.length,Jw(R,w);var Ut=v.element;N(w.srcEvent.target,Ut)&&(Ut=w.srcEvent.target),w.target=Ut}function Qw(v,w){var R=w.center,M=v.offsetDelta||{},F=v.prevDelta||{},z=v.prevInput||{};(w.eventType===Te||z.eventType===we)&&(F=v.prevDelta={x:z.deltaX||0,y:z.deltaY||0},M=v.offsetDelta={x:R.x,y:R.y}),w.deltaX=F.x+(R.x-M.x),w.deltaY=F.y+(R.y-M.y)}function Jw(v,w){var R=v.lastInterval||w,M=w.timeStamp-R.timeStamp,F,z,K,Pe;if(w.eventType!=Ke&&(M>en||R.velocity===i)){var Me=w.deltaX-R.deltaX,We=w.deltaY-R.deltaY,Ut=wp(M,Me,We);z=Ut.x,K=Ut.y,F=c(Ut.x)>c(Ut.y)?Ut.x:Ut.y,Pe=Sp(Me,We),v.lastInterval=w}else F=R.velocity,z=R.velocityX,K=R.velocityY,Pe=R.direction;w.velocity=F,w.velocityX=z,w.velocityY=K,w.direction=Pe}function vp(v){for(var w=[],R=0;R<v.pointers.length;)w[R]={clientX:l(v.pointers[R].clientX),clientY:l(v.pointers[R].clientY)},R++;return{timeStamp:u(),pointers:w,center:Tp(w),deltaX:v.deltaX,deltaY:v.deltaY}}function Tp(v){var w=v.length;if(w===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var R=0,M=0,F=0;F<w;)R+=v[F].clientX,M+=v[F].clientY,F++;return{x:l(R/w),y:l(M/w)}}function wp(v,w,R){return{x:w/v||0,y:R/v||0}}function Sp(v,w){return v===w?Oo:c(v)>=c(w)?v<0?Yi:Ki:w<0?Zi:qi}function ko(v,w,R){R||(R=yp);var M=w[R[0]]-v[R[0]],F=w[R[1]]-v[R[1]];return Math.sqrt(M*M+F*F)}function Fc(v,w,R){R||(R=yp);var M=w[R[0]]-v[R[0]],F=w[R[1]]-v[R[1]];return Math.atan2(F,M)*180/Math.PI}function Gw(v,w){return Fc(w[1],w[0],No)+Fc(v[1],v[0],No)}function eS(v,w){return ko(w[0],w[1],No)/ko(v[0],v[1],No)}var tS={mousedown:Te,mousemove:er,mouseup:we},nS="mousedown",rS="mousemove mouseup";function Fo(){this.evEl=nS,this.evWin=rS,this.pressed=!1,ut.apply(this,arguments)}g(Fo,ut,{handler:function(w){var R=tS[w.type];R&Te&&w.button===0&&(this.pressed=!0),R&er&&w.which!==1&&(R=we),this.pressed&&(R&we&&(this.pressed=!1),this.callback(this.manager,R,{pointers:[w],changedPointers:[w],pointerType:Tt,srcEvent:w}))}});var iS={pointerdown:Te,pointermove:er,pointerup:we,pointercancel:Ke,pointerout:Ke},sS={2:ae,3:Dr,4:Tt,5:Xi},Ep="pointerdown",Ap="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ep="MSPointerDown",Ap="MSPointerMove MSPointerUp MSPointerCancel");function Dc(){this.evEl=Ep,this.evWin=Ap,ut.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}g(Dc,ut,{handler:function(w){var R=this.store,M=!1,F=w.type.toLowerCase().replace("ms",""),z=iS[F],K=sS[w.pointerType]||w.pointerType,Pe=K==ae,Me=j(R,w.pointerId,"pointerId");z&Te&&(w.button===0||Pe)?Me<0&&(R.push(w),Me=R.length-1):z&(we|Ke)&&(M=!0),!(Me<0)&&(R[Me]=w,this.callback(this.manager,z,{pointers:R,changedPointers:[w],pointerType:K,srcEvent:w}),M&&R.splice(Me,1))}});var oS={touchstart:Te,touchmove:er,touchend:we,touchcancel:Ke},aS="touchstart",lS="touchstart touchmove touchend touchcancel";function Rp(){this.evTarget=aS,this.evWin=lS,this.started=!1,ut.apply(this,arguments)}g(Rp,ut,{handler:function(w){var R=oS[w.type];if(R===Te&&(this.started=!0),!!this.started){var M=cS.call(this,w,R);R&(we|Ke)&&M[0].length-M[1].length===0&&(this.started=!1),this.callback(this.manager,R,{pointers:M[0],changedPointers:M[1],pointerType:ae,srcEvent:w})}}});function cS(v,w){var R=H(v.touches),M=H(v.changedTouches);return w&(we|Ke)&&(R=W(R.concat(M),"identifier",!0)),[R,M]}var uS={touchstart:Te,touchmove:er,touchend:we,touchcancel:Ke},fS="touchstart touchmove touchend touchcancel";function Do(){this.evTarget=fS,this.targetIds={},ut.apply(this,arguments)}g(Do,ut,{handler:function(w){var R=uS[w.type],M=hS.call(this,w,R);M&&this.callback(this.manager,R,{pointers:M[0],changedPointers:M[1],pointerType:ae,srcEvent:w})}});function hS(v,w){var R=H(v.touches),M=this.targetIds;if(w&(Te|er)&&R.length===1)return M[R[0].identifier]=!0,[R,R];var F,z,K=H(v.changedTouches),Pe=[],Me=this.target;if(z=R.filter(function(We){return N(We.target,Me)}),w===Te)for(F=0;F<z.length;)M[z[F].identifier]=!0,F++;for(F=0;F<K.length;)M[K[F].identifier]&&Pe.push(K[F]),w&(we|Ke)&&delete M[K[F].identifier],F++;if(Pe.length)return[W(z.concat(Pe),"identifier",!0),Pe]}var dS=2500,bp=25;function Bc(){ut.apply(this,arguments);var v=y(this.handler,this);this.touch=new Do(this.manager,v),this.mouse=new Fo(this.manager,v),this.primaryTouch=null,this.lastTouches=[]}g(Bc,ut,{handler:function(w,R,M){var F=M.pointerType==ae,z=M.pointerType==Tt;if(!(z&&M.sourceCapabilities&&M.sourceCapabilities.firesTouchEvents)){if(F)pS.call(this,R,M);else if(z&&gS.call(this,M))return;this.callback(w,R,M)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function pS(v,w){v&Te?(this.primaryTouch=w.changedPointers[0].identifier,Pp.call(this,w)):v&(we|Ke)&&Pp.call(this,w)}function Pp(v){var w=v.changedPointers[0];if(w.identifier===this.primaryTouch){var R={x:w.clientX,y:w.clientY};this.lastTouches.push(R);var M=this.lastTouches,F=function(){var z=M.indexOf(R);z>-1&&M.splice(z,1)};setTimeout(F,dS)}}function gS(v){for(var w=v.srcEvent.clientX,R=v.srcEvent.clientY,M=0;M<this.lastTouches.length;M++){var F=this.lastTouches[M],z=Math.abs(w-F.x),K=Math.abs(R-F.y);if(z<=bp&&K<=bp)return!0}return!1}var xp=X(o.style,"touchAction"),Cp=xp!==i,Ip="compute",Mp="auto",Uc="manipulation",nr="none",Qi="pan-x",Ji="pan-y",Bo=mS();function Lc(v,w){this.manager=v,this.set(w)}Lc.prototype={set:function(v){v==Ip&&(v=this.compute()),Cp&&this.manager.element.style&&Bo[v]&&(this.manager.element.style[xp]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return _(this.manager.recognizers,function(w){A(w.options.enable,[w])&&(v=v.concat(w.getTouchAction()))}),_S(v.join(" "))},preventDefaults:function(v){var w=v.srcEvent,R=v.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var M=this.actions,F=k(M,nr)&&!Bo[nr],z=k(M,Ji)&&!Bo[Ji],K=k(M,Qi)&&!Bo[Qi];if(F){var Pe=v.pointers.length===1,Me=v.distance<2,We=v.deltaTime<250;if(Pe&&Me&&We)return}if(!(K&&z)&&(F||z&&R&Dt||K&&R&tr))return this.preventSrc(w)},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function _S(v){if(k(v,nr))return nr;var w=k(v,Qi),R=k(v,Ji);return w&&R?nr:w||R?w?Qi:Ji:k(v,Uc)?Uc:Mp}function mS(){if(!Cp)return!1;var v={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(R){v[R]=w?e.CSS.supports("touch-action",R):!0}),v}var Uo=1,ft=2,Br=4,vn=8,tn=vn,Gi=16,Bt=32;function nn(v){this.options=m({},this.defaults,v||{}),this.id=kt(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Uo,this.simultaneous={},this.requireFail=[]}nn.prototype={defaults:{},set:function(v){return m(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(h(v,"recognizeWith",this))return this;var w=this.simultaneous;return v=Lo(v,this),w[v.id]||(w[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return h(v,"dropRecognizeWith",this)?this:(v=Lo(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(h(v,"requireFailure",this))return this;var w=this.requireFail;return v=Lo(v,this),j(w,v)===-1&&(w.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(h(v,"dropRequireFailure",this))return this;v=Lo(v,this);var w=j(this.requireFail,v);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var w=this,R=this.state;function M(F){w.manager.emit(F,v)}R<vn&&M(w.options.event+Op(R)),M(w.options.event),v.additionalEvent&&M(v.additionalEvent),R>=vn&&M(w.options.event+Op(R))},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=Bt},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(Bt|Uo)))return!1;v++}return!0},recognize:function(v){var w=m({},v);if(!A(this.options.enable,[this,w])){this.reset(),this.state=Bt;return}this.state&(tn|Gi|Bt)&&(this.state=Uo),this.state=this.process(w),this.state&(ft|Br|vn|Gi)&&this.tryEmit(w)},process:function(v){},getTouchAction:function(){},reset:function(){}};function Op(v){return v&Gi?"cancel":v&vn?"end":v&Br?"move":v&ft?"start":""}function Np(v){return v==qi?"down":v==Zi?"up":v==Yi?"left":v==Ki?"right":""}function Lo(v,w){var R=w.manager;return R?R.get(v):v}function wt(){nn.apply(this,arguments)}g(wt,nn,{defaults:{pointers:1},attrTest:function(v){var w=this.options.pointers;return w===0||v.pointers.length===w},process:function(v){var w=this.state,R=v.eventType,M=w&(ft|Br),F=this.attrTest(v);return M&&(R&Ke||!F)?w|Gi:M||F?R&we?w|vn:w&ft?w|Br:ft:Bt}});function zo(){wt.apply(this,arguments),this.pX=null,this.pY=null}g(zo,wt,{defaults:{event:"pan",threshold:10,pointers:1,direction:mp},getTouchAction:function(){var v=this.options.direction,w=[];return v&Dt&&w.push(Ji),v&tr&&w.push(Qi),w},directionTest:function(v){var w=this.options,R=!0,M=v.distance,F=v.direction,z=v.deltaX,K=v.deltaY;return F&w.direction||(w.direction&Dt?(F=z===0?Oo:z<0?Yi:Ki,R=z!=this.pX,M=Math.abs(v.deltaX)):(F=K===0?Oo:K<0?Zi:qi,R=K!=this.pY,M=Math.abs(v.deltaY))),v.direction=F,R&&M>w.threshold&&F&w.direction},attrTest:function(v){return wt.prototype.attrTest.call(this,v)&&(this.state&ft||!(this.state&ft)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var w=Np(v.direction);w&&(v.additionalEvent=this.options.event+w),this._super.emit.call(this,v)}});function zc(){wt.apply(this,arguments)}g(zc,wt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&ft)},emit:function(v){if(v.scale!==1){var w=v.scale<1?"in":"out";v.additionalEvent=this.options.event+w}this._super.emit.call(this,v)}});function Vc(){nn.apply(this,arguments),this._timer=null,this._input=null}g(Vc,nn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Mp]},process:function(v){var w=this.options,R=v.pointers.length===w.pointers,M=v.distance<w.threshold,F=v.deltaTime>w.time;if(this._input=v,!M||!R||v.eventType&(we|Ke)&&!F)this.reset();else if(v.eventType&Te)this.reset(),this._timer=f(function(){this.state=tn,this.tryEmit()},w.time,this);else if(v.eventType&we)return tn;return Bt},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===tn&&(v&&v.eventType&we?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function jc(){wt.apply(this,arguments)}g(jc,wt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&ft)}});function Wc(){wt.apply(this,arguments)}g(Wc,wt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Dt|tr,pointers:1},getTouchAction:function(){return zo.prototype.getTouchAction.call(this)},attrTest:function(v){var w=this.options.direction,R;return w&(Dt|tr)?R=v.overallVelocity:w&Dt?R=v.overallVelocityX:w&tr&&(R=v.overallVelocityY),this._super.attrTest.call(this,v)&&w&v.offsetDirection&&v.distance>this.options.threshold&&v.maxPointers==this.options.pointers&&c(R)>this.options.velocity&&v.eventType&we},emit:function(v){var w=Np(v.offsetDirection);w&&this.manager.emit(this.options.event+w,v),this.manager.emit(this.options.event,v)}});function Vo(){nn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}g(Vo,nn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Uc]},process:function(v){var w=this.options,R=v.pointers.length===w.pointers,M=v.distance<w.threshold,F=v.deltaTime<w.time;if(this.reset(),v.eventType&Te&&this.count===0)return this.failTimeout();if(M&&F&&R){if(v.eventType!=we)return this.failTimeout();var z=this.pTime?v.timeStamp-this.pTime<w.interval:!0,K=!this.pCenter||ko(this.pCenter,v.center)<w.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!K||!z?this.count=1:this.count+=1,this._input=v;var Pe=this.count%w.taps;if(Pe===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=tn,this.tryEmit()},w.interval,this),ft):tn}return Bt},failTimeout:function(){return this._timer=f(function(){this.state=Bt},this.options.interval,this),Bt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==tn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function rn(v,w){return w=w||{},w.recognizers=x(w.recognizers,rn.defaults.preset),new Hc(v,w)}rn.VERSION="2.0.7",rn.defaults={domEvents:!1,touchAction:Ip,enable:!0,inputTarget:null,inputClass:null,preset:[[jc,{enable:!1}],[zc,{enable:!1},["rotate"]],[Wc,{direction:Dt}],[zo,{direction:Dt},["swipe"]],[Vo],[Vo,{event:"doubletap",taps:2},["tap"]],[Vc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var yS=1,kp=2;function Hc(v,w){this.options=m({},rn.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=v,this.input=Kw(this),this.touchAction=new Lc(this,this.options.touchAction),Fp(this,!0),_(this.options.recognizers,function(R){var M=this.add(new R[0](R[1]));R[2]&&M.recognizeWith(R[2]),R[3]&&M.requireFailure(R[3])},this)}Hc.prototype={set:function(v){return m(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?kp:yS},recognize:function(v){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(v);var R,M=this.recognizers,F=w.curRecognizer;(!F||F&&F.state&tn)&&(F=w.curRecognizer=null);for(var z=0;z<M.length;)R=M[z],w.stopped!==kp&&(!F||R==F||R.canRecognizeWith(F))?R.recognize(v):R.reset(),!F&&R.state&(ft|Br|vn)&&(F=w.curRecognizer=R),z++}},get:function(v){if(v instanceof nn)return v;for(var w=this.recognizers,R=0;R<w.length;R++)if(w[R].options.event==v)return w[R];return null},add:function(v){if(h(v,"add",this))return this;var w=this.get(v.options.event);return w&&this.remove(w),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(h(v,"remove",this))return this;if(v=this.get(v),v){var w=this.recognizers,R=j(w,v);R!==-1&&(w.splice(R,1),this.touchAction.update())}return this},on:function(v,w){if(v!==i&&w!==i){var R=this.handlers;return _(U(v),function(M){R[M]=R[M]||[],R[M].push(w)}),this}},off:function(v,w){if(v!==i){var R=this.handlers;return _(U(v),function(M){w?R[M]&&R[M].splice(j(R[M],w),1):delete R[M]}),this}},emit:function(v,w){this.options.domEvents&&vS(v,w);var R=this.handlers[v]&&this.handlers[v].slice();if(!(!R||!R.length)){w.type=v,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var M=0;M<R.length;)R[M](w),M++}},destroy:function(){this.element&&Fp(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Fp(v,w){var R=v.element;if(R.style){var M;_(v.options.cssProps,function(F,z){M=X(R.style,z),w?(v.oldCssProps[M]=R.style[M],R.style[M]=F):R.style[M]=v.oldCssProps[M]||""}),w||(v.oldCssProps={})}}function vS(v,w){var R=n.createEvent("Event");R.initEvent(v,!0,!0),R.gesture=w,w.target.dispatchEvent(R)}m(rn,{INPUT_START:Te,INPUT_MOVE:er,INPUT_END:we,INPUT_CANCEL:Ke,STATE_POSSIBLE:Uo,STATE_BEGAN:ft,STATE_CHANGED:Br,STATE_ENDED:vn,STATE_RECOGNIZED:tn,STATE_CANCELLED:Gi,STATE_FAILED:Bt,DIRECTION_NONE:Oo,DIRECTION_LEFT:Yi,DIRECTION_RIGHT:Ki,DIRECTION_UP:Zi,DIRECTION_DOWN:qi,DIRECTION_HORIZONTAL:Dt,DIRECTION_VERTICAL:tr,DIRECTION_ALL:mp,Manager:Hc,Input:ut,TouchAction:Lc,TouchInput:Do,MouseInput:Fo,PointerEventInput:Dc,TouchMouseInput:Bc,SingleTouchInput:Rp,Recognizer:nn,AttrRecognizer:wt,Tap:Vo,Pan:zo,Swipe:Wc,Pinch:zc,Rotate:jc,Press:Vc,on:I,off:O,each:_,merge:p,extend:E,assign:m,inherit:g,bindFn:y,prefixed:X});var TS=typeof e<"u"?e:typeof self<"u"?self:{};TS.Hammer=rn,typeof i=="function"&&i.amd?i(function(){return rn}):t.exports?t.exports=rn:e[r]=rn})(window,document,"Hammer")})(ow);var Io=ow.exports;const iO=hy(Io),Wt=ES({__proto__:null,default:iO},[Io]),aw=1,lw=2,Ph=4,sO={mousedown:aw,mousemove:lw,mouseup:Ph};function oO(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function aO(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(oO(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function lO(t){t.prototype.handler=function(n){let r=sO[n.type];r&aw&&n.button>=0&&(this.pressed=!0),r&lw&&n.buttons===0&&(r=Ph),this.pressed&&(r&Ph&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}aO(Io.PointerEventInput);lO(Io.MouseInput);const cO=Io.Manager;class Mc{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const uO=Wt?[[Wt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Wt.Rotate,{enable:!1}],[Wt.Pinch,{enable:!1}],[Wt.Swipe,{enable:!1}],[Wt.Pan,{threshold:0,enable:!1}],[Wt.Press,{enable:!1}],[Wt.Tap,{event:"doubletap",taps:2,enable:!1}],[Wt.Tap,{event:"anytap",enable:!1}],[Wt.Tap,{enable:!1}]]:null,mm={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},fO={doubletap:["tap"]},hO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},rp={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},dO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ym={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},pO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ui=typeof window<"u"?window:global;let xh=!1;try{const t={get passive(){return xh=!0,!0}};ui.addEventListener("test",null,t),ui.removeEventListener("test",null)}catch{xh=!1}const gO=pO.indexOf("firefox")!==-1,{WHEEL_EVENTS:_O}=rp,vm="wheel",Tm=4.000244140625,mO=40,yO=.25;class vO extends Mc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;ui.WheelEvent&&(gO&&i.deltaMode===ui.WheelEvent.DOM_DELTA_PIXEL&&(s/=ui.devicePixelRatio),i.deltaMode===ui.WheelEvent.DOM_DELTA_LINE&&(s*=mO)),s!==0&&s%Tm===0&&(s=Math.floor(s/Tm)),i.shiftKey&&s&&(s=s*yO),this.callback({type:vm,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(_O),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,xh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===vm&&(this.options.enable=n)}}const{MOUSE_EVENTS:TO}=rp,wm="pointermove",Sm="pointerover",Em="pointerout",Am="pointerenter",Rm="pointerleave";class wO extends Mc{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(TO),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===wm&&(this.enableMoveEvent=n),e===Sm&&(this.enableOverEvent=n),e===Em&&(this.enableOutEvent=n),e===Am&&(this.enableEnterEvent=n),e===Rm&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Sm,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Em,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Am,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Rm,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(wm,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:SO}=rp,bm="keydown",Pm="keyup";class EO extends Mc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:bm,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:Pm,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(SO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===bm&&(this.enableDownEvent=n),e===Pm&&(this.enableUpEvent=n)}}const xm="contextmenu";class AO extends Mc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:xm,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===xm&&(this.options.enable=n)}}const Cm=1,Ch=2,Im=4,RO={pointerdown:Cm,pointermove:Ch,pointerup:Im,mousedown:Cm,mousemove:Ch,mouseup:Im},bO=0,PO=1,xO=2,CO=1,IO=2,MO=4;function OO(t){const e=RO[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===Ch?(i=!!(n&CO),s=!!(n&MO),o=!!(n&IO)):(i=r===bO,s=r===PO,o=r===xO),{leftButton:i,middleButton:s,rightButton:o}}function NO(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const $u={srcElement:"root",priority:0};class kO{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=$u;typeof r=="string"||r&&r.addEventListener?l={...$u,srcElement:r}:r&&(l={...$u,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:f}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...OO(e),...NO(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const FO={events:null,recognizers:null,recognizerOptions:{},Manager:cO,touchAction:"none",tabIndex:0};class DO{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=hO[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...FO,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||uO}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(mm).forEach(i=>{const s=this.manager.get(i);s&&mm[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new vO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new wO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new EO(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new AO(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=fO[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=ym[e]||e;let c=a.get(l);c||(c=new kO(this),a.set(l,c),c.recognizerName=dO[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=ym[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function An(){}const BO=({isDragging:t})=>t?"grabbing":"grab",cw={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:An,onWebGLInitialized:An,onResize:An,onViewStateChange:An,onInteractionStateChange:An,onBeforeRender:An,onAfterRender:An,onLoad:An,onError:t=>J.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:BO,getTooltip:null,debug:!1,drawPickingColors:!1};class ip{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Sc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=mh[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let f=!1;c&&(f=c.call(l,a,r)),f||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...cw,...e},e=this.props,e.viewState&&e.initialViewState&&J.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&J.error("WebGL1 context not supported.")(),this.device=Ls.attach(e.gl));let n=this.device;n||(vi.registerDevices([Ls]),n=vi.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Li.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&J.removed("onLayerHover","onHover")(),"onLayerClick"in e&&J.removed("onLayerClick","onClick")(),e.initialViewState&&!Pt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ke(this.viewManager),this.viewManager.views}getViewports(e){return ke(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){ke(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ke(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new c2({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new L2({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Ls&&this.props.onWebGLInitialized(this.device.gl);const n=new UT;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new DO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in mh)this.eventManager.on(o,this._onEvent);this.viewManager=new P2({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new b2(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new j2({deck:this,device:this.device}),this.deckRenderer=new $2(this.device),this.deckPicker=new Q2(this.device),this.widgetManager=new eI({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new nI),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),J.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=vi.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}ip.defaultProps=cw;ip.VERSION=T3;const UO=ip;function LO(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return cT(t)}}const zO=lT;function ya(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function _r(t){return t.stride||t.size*t.bytesPerElement}function VO(t,e){return t.type===e.type&&t.size===e.size&&_r(t)===_r(e)&&(t.offset||0)===(e.offset||0)}function Ih(t,e){e.offset&&J.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=_r(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function jO(t,e){const n=Ih(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class WO{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=LO(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*_r(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Li.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Ih(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:_r(r),attributes:i};if(this.doublePrecision){const o=jO(r,n||{});i.push(ya(e,{...r,...o.high}),ya(`${e}64Low`,{...r,...o.low}))}else if(n){const o=Ih(r,n);i.push(ya(e,{...r,...o}))}else i.push(ya(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ce?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=zO(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=_r(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=_r(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=Ou(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Ou(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Li.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?Ou(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&J.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?ce.INDEX:ce.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const Mm=[],Om=[];function Mo(t,e=0,n=1/0){let r=Mm;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(Om.length=t.length,r=Om):r=Mm,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function uw(t){return t&&t[Symbol.asyncIterator]}function fw(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:_})=>{if(!s){const p=h*l+c;for(let g=0;g<n;g++)_[g]=t[p+g];return _}const d=s[h],m=s[h+1]||u;let E;if(o){E=new Array(m-d);for(let p=d;p<m;p++){const g=p*l+c;_=new Array(n);for(let y=0;y<n;y++)_[y]=t[g+y];E[p-d]=_}}else if(l===n)E=t.subarray(d*n+c,m*n+c);else{E=new t.constructor((m-d)*n);let p=0;for(let g=d;g<m;g++){const y=g*l+c;for(let A=0;A<n;A++)E[p++]=t[y+A]}}return E}}const HO=[],Xa=[[0,1/0]];function $O(t,e){if(t===Xa||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const XO={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function hw(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...XO[n],...e,...t,type:n}}class dw extends WO{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Xa}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!VO(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return hw(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=$O(this.state.updateRanges,[r,i])}else this.state.updateRanges=Xa}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=HO}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Xa),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;ke(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=fw(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:_}=a,d=l.binaryAccessor||(typeof h=="function"?h:s[h]);ke(typeof d=="function",`accessor "${h}" is not a function`);let m=e.getVertexOffset(r);const{iterable:E,objectInfo:p}=Mo(n,r,i);for(const g of E){p.index++;let y=d(g,p);if(_&&(y=_.call(this,y)),f){const A=(p.index<f.length-1?f[p.index+1]:o)-f[p.index];if(y&&Array.isArray(y[0])){let x=m;for(const I of y)e._normalizeValue(I,c,x),x+=u}else y&&y.length>u?c.set(y,m):(e._normalizeValue(y,p.target,0),w2({target:c,source:p.target,start:m,count:A}));m+=A*u}else e._normalizeValue(y,c,m),m+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Xu(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<i;f++)n[r+c]=u[f]||0,c++}}function YO({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Xu({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,f)=>r(u+a,f)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const f=i[u]*n,h=s[u]*n;Xu({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&Xu({source:[],target:e,start:a,size:n,getData:l}),e}function KO(t){const{device:e,settings:n,value:r}=t,i=new dw(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function pw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function gw(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function _w(t){t.push(t.shift())}function ZO(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function mw({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function yw({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,f=n.startIndices,h=s&&f,_=n.isConstant;if(!h&&e&&r>=i)return e;const d=n.value instanceof Float64Array?Float32Array:n.value.constructor,m=_?n.value:new d(n.getBuffer().readSyncWebGL(c,i*d.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!_){const y=o;o=(A,x)=>n.normalizeConstant(y(A,x))}const E=_?(y,A)=>o(m,A):(y,A)=>o(m.subarray(y+c,y+c+l),A),p=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),g=new Float32Array(i);return YO({source:p,target:g,sourceStartIndices:s,targetStartIndices:f,size:l,getData:E}),(!e||e.byteLength<g.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:g.byteLength+u,usage:35050})),e.write(g,u),e}class vw{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new xc(r),this.attribute=n,this.attributeInTransition=KO(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=ZO(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class qO extends vw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=GO(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;_w(s),s[0]=yw({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=mw({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);Tw(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const QO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,JO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Tw(t){return t.doublePrecision&&t.value instanceof Float64Array}function GO(t,e){const n=e.size,r=pw(n),i=gw(n),s=e.getBufferLayout();return Tw(e)?new uo(t,{vs:JO,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[YP],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new uo(t,{vs:QO,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class eN extends vw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=iN(e),this.framebuffer=sN(e,this.texture),this.transform=rN(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=yw({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=mw({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),_w(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const tN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,nN=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function rN(t,e){const n=pw(e.size),r=gw(e.size);return new uo(t,{vs:tN,fs:nN,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function iN(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function sN(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const oN={interpolation:qO,spring:eN};class aN{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=oN[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(J.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const Nm="attributeManager.invalidate",lN="attributeManager.updateStart",cN="attributeManager.updateEnd",uN="attribute.updateStart",fN="attribute.allocate",hN="attribute.updateEnd";class dN{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Po(JC),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new aN(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);ze(Nm,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ze(Nm,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;ze(lN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&J.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&ze(cN,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new dw(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(ze(uN,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&ze(fN,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,ze(hN,n,r))}}class pN extends xc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=kl(n,r,o)}}const km=1e-5;function Fm(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function gN(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Fm(t[o],e[o],n[o],r,i);return s}return Fm(t,e,n,r,i)}function Dm(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class _N extends xc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=gN(s,o,n,r,i);const l=Dm(a,n),c=Dm(a,o);l<km&&c<km&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const mN={interpolation:pN,spring:_N};class yN{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=hw(i),!i)return;const o=mN[i.type];if(!o){J.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function vN(t){const e=t[Hn];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function TN(t,e){const n=ww({newProps:t,oldProps:e,propTypes:t[Hn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=SN(t,e);let i=!1;return r||(i=EN(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:AN(t,e),transitionsChanged:wN(t,e)}}function wN(t,e){if(!t.transitions)return!1;const n={},r=t[Hn];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Mh(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function ww({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Mh(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Mh(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Mh(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function SN(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function EN(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Bm(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&Bm(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function AN(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function Bm(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},ww({oldProps:i,newProps:r,triggerName:n})}const RN="count(): argument not an object",bN="count(): argument not a container";function PN(t){if(!CN(t))throw new Error(RN);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(xN(t))return Object.keys(t).length;throw new Error(bN)}function xN(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function CN(t){return t!==null&&typeof t=="object"}function Um(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const IN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Oh={};function MN(t,e,n,r){if(n instanceof gt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...IN,...i,...r}});return Oh[s.id]=t,s}function ON(t,e){!e||!(e instanceof gt)||Oh[e.id]===t&&(e.delete(),delete Oh[e.id])}const NN={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Nh(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Pt(t,e,1)}},accessor:{validate(t,e){const n=Vl(t);return n==="function"||n===Vl(e.value)},equal(t,e,n){return typeof e=="function"?!0:Pt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Nh(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Pt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Pt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:MN(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{ON(n.id,t)}}};function kN(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=FN(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function FN(t,e){switch(Vl(e)){case"object":return ps(t,e);case"array":return ps(t,{type:"array",value:e,compare:!1});case"boolean":return ps(t,{type:"boolean",value:e});case"number":return ps(t,{type:"number",value:e});case"function":return ps(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ps(t,e){return"type"in e?{name:t,...NN[e.type],...e}:"value"in e?{name:t,type:Vl(e.value),...e}:{name:t,type:"object",value:e}}function Nh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Vl(t){return Nh(t)?"array":t===null?"null":typeof t}function DN(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=kh(t.constructor,n),i=Object.create(r);i[Ll]=t,i[Pr]={},i[Nn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const BN="_mergedDefaultProps";function kh(t,e){let n=BN;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=Sw(t,n);return r||(t[n]=UN(t,e||[]))}function UN(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=kh(r),s=Sw(t,"defaultProps")||{},o=kN(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[Hn],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[Fu],o.deprecatedProps);for(const u of e){const f=kh(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[Hn]),Object.assign(c,f[Fu]))}return LN(a,t),VN(a,l),zN(a,c),a[Hn]=l,a[Fu]=c,e.length===0&&!sp(t,"_propTypes")&&(t._propTypes=l),a}function LN(t,e){const n=WN(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function zN(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])sp(this,s)||(this[s]=r);J.deprecated(i,e[n].join("/"))()}})}function VN(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=jN(o))}t[Si]=n,t[Pr]={},Object.defineProperties(t,r)}function jN(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||uw(e)?this[Pr][t]=e:this[Nn][t]=e},get(){if(this[Nn]){if(t in this[Nn])return this[Nn][t]||this[Si][t];if(t in this[Pr]){const e=this[Ll]&&this[Ll].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Si][t]}}return this[Si][t]}}}function sp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Sw(t,e){return sp(t,e)&&t[e]}function WN(t){const e=t.componentName;return e||J.warn(`${t.name}.componentName not specified`)(),e||t.name}let HN=0;class op{constructor(...e){this.props=DN(this,e),this.id=this.props.id,this.count=HN++}clone(e){const{props:n}=this,r={};for(const i in n[Si])i in n[Nn]?r[i]=n[Nn][i]:i in n[Pr]&&(r[i]=n[Pr][i]);return new this.constructor({...n,...r,...e})}}op.componentName="Component";op.defaultProps={};const $N=op,XN=Object.freeze({});class YN{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||XN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Ll]||this.component;const n=e[Nn]||{},r=e[Pr]||e,i=e[Si]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(uw(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Hn];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class KN extends YN{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const ZN="layer.changeFlag",qN="layer.initialize",QN="layer.update",JN="layer.finalize",GN="layer.matched",Lm=2**24-1,ek=Object.freeze([]),tk=Po(({oldViewport:t,viewport:e})=>t.equals(e));let Ht=new Uint8ClampedArray(0);const nk={data:{type:"data",value:ek,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:El(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):El(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:q.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ap extends $N{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Xr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ke(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=BT(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=NT(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return ke(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ke(this.internalState);const r=this.internalState.viewport||this.context.viewport;return i2(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===q.DEFAULT||e===q.LNGLAT||e===q.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ke(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:PN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Um(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=Um(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!tk({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Ht.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>Lm&&J.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ht=Li.allocate(Ht,n,{size:4,copy:!0,maxCount:Math.max(n,Lm)});const i=Math.floor(Ht.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Ht[o*4+0]=s[0],Ht[o*4+1]=s[1],Ht[o*4+2]=s[2]}e.value=Ht.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const f=c[u];f instanceof ce?n[l].settings.isIndexed?e.setIndexBuffer(f):s[u]=f:f&&(o[u]=f)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ht.buffer&&(r.value=Ht.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ke(!this.internalState),ke(Number.isFinite(this.props.coordinateSystem)),ze(qN,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new KN({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(J.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new yN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ze(GN,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ze(QN,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ze(JN,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:f}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:f}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const f of this.props.extensions)f.draw.call(this,u,f);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&ze(ZN,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=TN(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){vN(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new dN(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ap.defaultProps=nk;ap.layerName="Layer";const $i=ap,rk="compositeLayer.renderLayers";class Ew extends $i{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var O;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:_,modelMatrix:d,extensions:m,fetch:E,operation:p,_subLayerProps:g}=this.props,y={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:_,modelMatrix:d,extensions:m,fetch:E,operation:p},A=g&&e.id&&g[e.id],x=A&&A.updateTriggers,I=e.id||"sublayer";if(A){const N=this.props[Hn],k=e.type?e.type._propTypes:{};for(const U in A){const j=k[U]||N[U];j&&j.type==="accessor"&&(A[U]=this.getSubLayerAccessor(A[U]))}}Object.assign(y,e,A),y.id=`${this.props.id}-${I}`,y.updateTriggers={all:(O=this.props.updateTriggers)==null?void 0:O.all,...e.updateTriggers,...x};for(const N of m){const k=N.getSubLayerProps.call(this,N);k&&Object.assign(y,k,{updateTriggers:Object.assign(y.updateTriggers,k.updateTriggers)})}return y}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=Qd(s,Boolean),this.internalState.subLayers=r}ze(rk,this,i,r);for(const s of r)s.parent=this}}Ew.layerName="CompositeLayer";const Aw=Ew,Yu=Math.PI/180;function ik({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],a=n==="Z"?[0,-e,0]:[0,0,e],l=new Nt().lookAt({eye:a,up:o});l.rotateX(r*Yu),n==="Z"?l.rotateZ(i*Yu):l.rotateY(i*Yu);const c=Math.pow(2,s)/t;return l.scale(c),l}class sk extends qd{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:l=0,zoom:c=0}=e,u=r?r[5]/2:Kd(i);super({...e,longitude:void 0,viewMatrix:ik({height:n||1,focalDistance:u,orbitAxis:s,rotationX:a,rotationOrbit:l,zoom:c}),fovy:i,focalDistance:u,position:o,zoom:c}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[a,l,c]=bc([r,o,s],this.pixelUnprojectionMatrix);return[a,l,c]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class ok extends WT{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:u=-1/0,maxZoom:f=1/0,startPanPosition:h,startRotatePos:_,startRotationX:d,startRotationOrbit:m,startZoomPosition:E,startZoom:p}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:c,minZoom:u,maxZoom:f},{startPanPosition:h,startRotatePos:_,startRotationX:d,startRotationOrbit:m,startZoomPosition:E,startZoom:p}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let c;if(e){let u=(e[0]-i[0])/a;const f=(e[1]-i[1])/l;(s<-90||s>90)&&(u*=-1),c={rotationX:s+f*180,rotationOrbit:o+u*180}}else c={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return rt(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(i)?[rt(i[0],r,n),rt(i[1],r,n)]:rt(i,r,n),e.rotationX=rt(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=KC(a+180,360)-180),e}}class ak extends jT{constructor(){super(...arguments),this.ControllerState=ok,this.transition={transitionDuration:300,transitionInterpolator:new Jd({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class Rw extends VT{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return sk}get ControllerType(){return ak}}Rw.displayName="OrbitView";const lk=Rw;class bw{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=Li,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(ke(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?fw(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=Mo(i,n,r);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const _=f&&this.normalizeGeometry(f);c[h]=_,r[h+1]=r[h]+(_?this.getGeometrySize(_):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof ce){const f=this.positionSize*4;i=i||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;i=i||f.length/h}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const u={};this._forEachGeometry((f,h)=>{const _=c[h]||f;u.vertexStart=r[h],u.indexStart=n[h];const d=h<r.length-1?r[h+1]:i;u.geometrySize=d-r[h],u.geometryIndex=h,this.updateGeometryAttributes(_,u)},a,l),this.vertexCount=n[n.length-1]}}const ck=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec3 positions;
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = positions.x;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, positions.y);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (useShortestPath) {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,uk=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jl=[0,0,0,255],fk={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:jl},getTargetColor:{type:"accessor",value:jl},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class lp extends $i{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:ck,fs:uk,modules:[xo,Co]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:jl},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:jl},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var s;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;(i.extensionsChanged||n.numSegments!==r.numSegments)&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props,l=this.state.model;l.setUniforms(e),l.setUniforms({greatCircle:o,widthUnits:Di[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:a}),l.draw(this.context.renderPass)}_getModel(){const{numSegments:e}=this.props;let n=[];for(let i=0;i<e;i++)n=n.concat([i,1,0,i,-1,0]);const r=new Mt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0});return r.setUniforms({numSegments:e}),r}}lp.layerName="ArcLayer";lp.defaultProps=fk;const hk=lp,dk=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,pk=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gk=1024,_k=4,zm=()=>{},Vm={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mk={x:0,y:0,width:0,height:0};function yk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function vk(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function ho(t){return t&&(t.id||t.url)}function Tk(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r}),l=o.createCommandEncoder();return l.copyTextureToTexture({source:t,destination:a,width:i,height:s}),l.finish(),t.destroy(),a}function jm(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=ho(i);t[o]={...i,x:s,y:n}}}function wk({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=ho(c);if(!n[u]){const{height:f,width:h}=c;r+h+e>o&&(jm(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:c,xOffset:r}),r=r+h+e,s=Math.max(s,f)}}return a.length>0&&jm(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:yk(s+i+e)}}function Sk(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=Mo(t);for(const o of i){s.index++;const a=e(o,s),l=ho(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class Ek{constructor(e,{onUpdate:n=zm,onError:r=zm}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=_k,this._canvasWidth=gk,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?ho(e):e;return this._mapping[n]||mk}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(Sk(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=wk({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||Vm})),this._texture.height!==this._canvasHeight&&(this._texture=Tk(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Vm)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,El(r.url,this._loadOptions).then(i=>{const s=ho(r),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:f,width:h,height:_}=vk(n,i,c,u);this._texture.setSubImageData({data:f,x:a+(c-h)/2,y:l+(u-_)/2,width:h,height:_}),o.width=h,o.height=_,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const Pw=[0,0,0,255],Ak={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Pw},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class cp extends $i{getShaders(){return super.getShaders({vs:dk,fs:pk,modules:[xo,Co]})}initializeState(){this.state={iconManager:new Ek(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Pw},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var _;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state;if(typeof o=="string")return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&f.packIcons(l,c),i.extensionsChanged&&((_=this.state.model)==null||_.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const u=this.state.model;u.setBindings({iconsTexture:c}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[c.width,c.height],sizeUnits:Di[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Mt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):J.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}}cp.defaultProps=Ak;cp.layerName="IconLayer";const Rk=cp,xw={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Cw(t,e,n={}){return bk(t,n)!==e?(xk(t,n),!0):!1}function bk(t,e={}){return Math.sign(Pk(t,e))}const Wm={x:0,y:1,z:2};function Pk(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=Wm[i[0]],l=Wm[i[1]];for(let c=n,u=r-s;c<r;c+=s)o+=(t[c+a]-t[u+a])*(t[c+l]+t[u+l]),u=c;return o/2}function xk(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,c=n+(s-1-a)*i;for(let u=0;u<i;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function xt(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function Fh(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function po(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function Dh(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Ya(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Iw(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=po(t,0,n,o);let h,_;const d=Ow(f,i,s,[]),m=[];xt(c,f);for(let E=1;E<l;E++){for(h=po(t,E,n,o,h),_=Ya(h,d);_;){Dh(f,h,_,d,m);const p=Ya(m,d);p&&(Dh(f,m,p,d,m),_=p),xt(c,m),Fh(f,m),Ik(d,i,_),r&&c.length>n&&(c=[],u.push(c),xt(c,f)),_=Ya(h,d)}xt(c,h),Fh(f,h)}return r?u:u[0]}const Hm=0,Ck=1;function Mw(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/r).fill(Ck):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:_}=l.shift();Mk(f,r,_[0]||f.length,c),u=Ow(c[0],i,s,u);const d=Ya(c[1],u);if(d){let m=$m(f,h,r,0,_[0]||f.length,u,d);const E={pos:m[0].pos,types:m[0].types,holes:[]},p={pos:m[1].pos,types:m[1].types,holes:[]};l.push(E,p);for(let g=0;g<_.length;g++)m=$m(f,h,r,_[g],_[g+1]||f.length,u,d),m[0]&&(E.holes.push(E.pos.length),E.pos=va(E.pos,m[0].pos),o&&(E.types=va(E.types,m[0].types))),m[1]&&(p.holes.push(p.pos.length),p.pos=va(p.pos,m[1].pos),o&&(p.types=va(p.types,m[1].types)))}else{const m={positions:f};o&&(m.edgeTypes=h),_.length&&(m.holeIndices=_),a.push(m)}}return a}function $m(t,e,n,r,i,s,o){const a=(i-r)/n,l=[],c=[],u=[],f=[],h=[];let _,d,m;const E=po(t,a-1,n,r);let p=Math.sign(o&8?E[1]-s[3]:E[0]-s[2]),g=e&&e[a-1],y=0,A=0;for(let x=0;x<a;x++)_=po(t,x,n,r,_),d=Math.sign(o&8?_[1]-s[3]:_[0]-s[2]),m=e&&e[r/n+x],d&&p&&p!==d&&(Dh(E,_,o,s,h),xt(l,h)&&u.push(g),xt(c,h)&&f.push(g)),d<=0?(xt(l,_)&&u.push(m),y-=d):u.length&&(u[u.length-1]=Hm),d>=0?(xt(c,_)&&f.push(m),A+=d):f.length&&(f[f.length-1]=Hm),Fh(E,_),p=d,g=m;return[y?{pos:l,types:e&&u}:null,A?{pos:c,types:e&&f}:null]}function Ow(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function Ik(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function Mk(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];i=c<i?c:i,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function va(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const Ok=85.051129;function Nk(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);Nw(o,n,0,i-r);const a=Iw(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)kw(l,n);return a}function kk(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,_=c,d=Fk(t,r,l,h);for(let m=d;m<h;m++)o[c++]=t[m];for(let m=l;m<d;m++)o[c++]=t[m];Nw(o,r,_,c),Dk(o,r,_,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=Mw(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const f of u)kw(f.positions,r);return u}function Fk(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function Dk(t,e,n,r,i=Ok){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=po(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,xt(t,a),a[1]=Math.sign(a[1])*i,xt(t,a),a[0]=s,xt(t,a)}}function Nw(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function kw(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function Bk(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?Iw(i,{size:e,gridResolution:n}):r?Nk(i,{size:e}):i}const Uk=1,Lk=2,Ku=4;class zk extends bw{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Bk(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Xm(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Xm(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=Ku,r[s+o-2]=Ku):(r[s]+=Uk,r[s+o-2]+=Lk),r[s+o-1]=Ku}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function Xm(t){return Array.isArray(t[0])}const Vk=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,jk=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fw=[0,0,0,255],Wk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:Fw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Zu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class up extends $i{getShaders(){return super.getShaders({vs:Vk,fs:jk,modules:[xo,Co]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Zu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Zu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Zu,defaultValue:Fw},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new zk({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Di[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Mt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zi({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}up.defaultProps=Wk;up.layerName="PathLayer";const Dw=up;var fp={exports:{}};fp.exports=Oc;fp.exports.default=Oc;function Oc(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=Bw(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,_;if(r&&(s=Kk(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var d=n;d<i;d+=n)f=t[d],h=t[d+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);_=Math.max(c-a,u-l),_=_!==0?32767/_:0}return go(s,o,n,a,l,_,0),o}function Bw(t,e,n,r,i){var s,o;if(i===Lh(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Ym(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Ym(s,t[s],t[s+1],o);return o&&Nc(o,o.next)&&(mo(o),o=o.next),o}function Cr(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Nc(n,n.next)||de(n.prev,n,n.next)===0)){if(mo(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function go(t,e,n,r,i,s,o){if(t){!o&&s&&Gk(t,r,i,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?$k(t,r,i,s):Hk(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),mo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=Xk(Cr(t),e,n),go(t,e,n,r,i,s,2)):o===2&&Yk(t,e,n,r,i,s):go(Cr(t),e,n,r,i,s,1);break}}}}function Hk(t){var e=t.prev,n=t,r=t.next;if(de(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=i>s?i>o?i:o:s>o?s:o,_=a>l?a>c?a:c:l>c?l:c,d=r.next;d!==e;){if(d.x>=u&&d.x<=h&&d.y>=f&&d.y<=_&&fi(i,a,s,l,o,c,d.x,d.y)&&de(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function $k(t,e,n,r){var i=t.prev,s=t,o=t.next;if(de(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,u=i.y,f=s.y,h=o.y,_=a<l?a<c?a:c:l<c?l:c,d=u<f?u<h?u:h:f<h?f:h,m=a>l?a>c?a:c:l>c?l:c,E=u>f?u>h?u:h:f>h?f:h,p=Bh(_,d,e,n,r),g=Bh(m,E,e,n,r),y=t.prevZ,A=t.nextZ;y&&y.z>=p&&A&&A.z<=g;){if(y.x>=_&&y.x<=m&&y.y>=d&&y.y<=E&&y!==i&&y!==o&&fi(a,u,l,f,c,h,y.x,y.y)&&de(y.prev,y,y.next)>=0||(y=y.prevZ,A.x>=_&&A.x<=m&&A.y>=d&&A.y<=E&&A!==i&&A!==o&&fi(a,u,l,f,c,h,A.x,A.y)&&de(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;y&&y.z>=p;){if(y.x>=_&&y.x<=m&&y.y>=d&&y.y<=E&&y!==i&&y!==o&&fi(a,u,l,f,c,h,y.x,y.y)&&de(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;A&&A.z<=g;){if(A.x>=_&&A.x<=m&&A.y>=d&&A.y<=E&&A!==i&&A!==o&&fi(a,u,l,f,c,h,A.x,A.y)&&de(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Xk(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Nc(i,s)&&Uw(i,r,r.next,s)&&_o(i,s)&&_o(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),mo(r),mo(r.next),r=t=s),r=r.next}while(r!==t);return Cr(r)}function Yk(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&nF(o,a)){var l=Lw(o,a);o=Cr(o,o.next),l=Cr(l,l.next),go(o,e,n,r,i,s,0),go(l,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function Kk(t,e,n,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=Bw(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(tF(c));for(i.sort(Zk),s=0;s<i.length;s++)n=qk(i[s],n);return n}function Zk(t,e){return t.x-e.x}function qk(t,e){var n=Qk(t,e);if(!n)return e;var r=Lw(n,t);return Cr(r,r.next),Cr(n,n.next)}function Qk(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do r>=n.x&&n.x>=c&&r!==n.x&&fi(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(r-n.x),_o(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&Jk(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function Jk(t,e){return de(t.prev,t,e.prev)<0&&de(e.next,t,t.next)<0}function Gk(t,e,n,r){var i=t;do i.z===0&&(i.z=Bh(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,eF(i)}function eF(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1);return t}function Bh(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function tF(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function fi(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function nF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!rF(t,e)&&(_o(t,e)&&_o(e,t)&&iF(t,e)&&(de(t.prev,t,e.prev)||de(t,e.prev,e))||Nc(t,e)&&de(t.prev,t,t.next)>0&&de(e.prev,e,e.next)>0)}function de(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Nc(t,e){return t.x===e.x&&t.y===e.y}function Uw(t,e,n,r){var i=wa(de(t,e,n)),s=wa(de(t,e,r)),o=wa(de(n,r,t)),a=wa(de(n,r,e));return!!(i!==s&&o!==a||i===0&&Ta(t,n,e)||s===0&&Ta(t,r,e)||o===0&&Ta(n,t,r)||a===0&&Ta(n,e,r))}function Ta(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function wa(t){return t>0?1:t<0?-1:0}function rF(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Uw(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function _o(t,e){return de(t.prev,t,t.next)<0?de(t,e,t.next)>=0&&de(t,t.prev,e)>=0:de(t,e,t.prev)<0||de(t,t.next,e)<0}function iF(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function Lw(t,e){var n=new Uh(t.i,t.x,t.y),r=new Uh(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Ym(t,e,n,r){var i=new Uh(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function mo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Uh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Oc.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(Lh(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Lh(t,c,u,n))}var f=0;for(a=0;a<r.length;a+=3){var h=r[a]*n,_=r[a+1]*n,d=r[a+2]*n;f+=Math.abs((t[h]-t[d])*(t[_+1]-t[h+1])-(t[h]-t[_])*(t[d+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Lh(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}Oc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var sF=fp.exports;const oF=hy(sF),Sa=xw.CLOCKWISE,Km=xw.COUNTER_CLOCKWISE,Fn={isClosed:!0};function aF(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Rs(t){return"positions"in t?t.positions:t}function Ka(t){return"holeIndices"in t?t.holeIndices:null}function lF(t){return Array.isArray(t[0])}function cF(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function uF(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function fF(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function Zm(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<r;l++)t[s++]=n[a][l]||0;if(!uF(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Fn.start=e,Fn.end=s,Fn.size=r,Cw(t,i,Fn),s}function qm(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[i+c];if(!fF(n,r,i,s))for(let c=0;c<r;c++)t[l++]=n[i+c];return Fn.start=e,Fn.end=l,Fn.size=r,Cw(t,o,Fn),l}function zw(t,e){aF(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=qm(n,o,i,e,s[a-1],s[a],a===0?Sa:Km),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!lF(t))return qm(n,0,t,e,0,n.length,Sa),n;if(!cF(t)){let i=0;for(const[s,o]of t.entries())i=Zm(n,i,o,e,s===0?Sa:Km),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return Zm(n,0,t,e,Sa),n}function qu(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function Qm(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+r]=c}}function hF(t,e,n,r){let i=Ka(t);i&&(i=i.map(a=>a/e));let s=Rs(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=qu(s,0,1),l=qu(s,0,2),c=qu(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),Qm(s,0,2,1)):(n||(s=s.slice()),Qm(s,2,0,1)))}return oF(s,i,e)}class dF extends bw{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=zw(e,this.positionSize);return this.opts.resolution?Mw(Rs(n),Ka(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?kk(Rs(n),Ka(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Jm(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Rs(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Jm(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const r=e;this._updateIndices(r,n),this._updatePositions(r,n),this._updateVertexValid(r,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=i;const u=hF(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+r;o[n+1]=i+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=Rs(e);for(let a=n,l=0;l<r;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;i[a*3]=c,i[a*3+1]=u,i[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&Ka(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function Jm(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Vw=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Vw}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,gF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Vw}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,_F=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Wl=[0,0,0,255],mF={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Wl},getLineColor:{type:"accessor",value:Wl},material:!0},Ea={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class hp extends $i{getShaders(e){return super.getShaders({vs:e==="top"?pF:gF,fs:_F,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[xo,Xx,Co]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&n===q.DEFAULT&&(n=q.LNGLAT);let i;n===q.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new dF({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Ea,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:Ea,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Ea,accessor:"getFillColor",defaultValue:Wl},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Ea,accessor:"getLineColor",defaultValue:Wl},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:l,target:c})=>this.encodePickingColor(a&&a.__source?a.__source.index:l,c)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,u={...e,extruded:!!n,elevationScale:s};l&&i&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(u),l.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(c.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(c.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:r}=this.props;let i,s,o;if(n){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const l=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Mt(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:l,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Mt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new zi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Mt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new zi({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}hp.defaultProps=mF;hp.layerName="SolidPolygonLayer";const yF=hp;function vF({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const _=e(t[h]);if(a>h&&_>=i&&(a=h),_>=s){l=h;break}}let c=a;const f=l-a!==r.length?t.slice(l):void 0;for(let h=0;h<r.length;h++)t[c++]=r[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+r.length}}const jw=[0,0,0,255],TF=[0,0,0,255],wF={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:TF},getLineColor:{type:"accessor",value:jw},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class dp extends Aw{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&J.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(s=>vF({data:r,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:s}=this.props,o=[],a=i==="XY"?2:3,{startRow:l,endRow:c}=e,{iterable:u,objectInfo:f}=Mo(n,l,c);for(const h of u){f.index++;let _=r(h,f);s&&(_=zw(_,a));const{holeIndices:d}=_,m=_.positions||_;if(d)for(let E=0;E<=d.length;E++){const p=m.slice(d[E-1]||0,d[E]||m.length);o.push(this.getSubLayerRow({path:p},h,f.index))}else o.push(this.getSubLayerRow({path:m},h,f.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:c,transitions:u,positionFormat:f}=this.props,{lineWidthUnits:h,lineWidthScale:_,lineWidthMinPixels:d,lineWidthMaxPixels:m,lineJointRounded:E,lineMiterLimit:p,lineDashJustified:g}=this.props,{getFillColor:y,getLineColor:A,getLineWidth:x,getLineDashArray:I,getElevation:O,getPolygon:N,updateTriggers:k,material:U}=this.props,{paths:j,pathsDiff:H}=this.state,W=this.getSubLayerClass("fill",yF),X=this.getSubLayerClass("stroke",Dw),Ae=this.shouldRenderSubLayer("fill",j)&&new W({_dataDiff:n,extruded:s,elevationScale:c,filled:i,wireframe:o,_normalize:a,_windingOrder:l,getElevation:O,getFillColor:y,getLineColor:s&&o?A:jw,material:U,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:k&&{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:s&&o,getLineColor:k.getLineColor}}),{data:e,positionFormat:f,getPolygon:N}),kt=!s&&r&&this.shouldRenderSubLayer("stroke",j)&&new X({_dataDiff:H&&(()=>H),widthUnits:h,widthScale:_,widthMinPixels:d,widthMaxPixels:m,jointRounded:E,miterLimit:p,dashJustified:g,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(A),getWidth:this.getSubLayerAccessor(x),getDashArray:this.getSubLayerAccessor(I)},this.getSubLayerProps({id:"stroke",updateTriggers:k&&{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:j,positionFormat:f,getPath:Ft=>Ft.path});return[!s&&Ae,kt,s&&Ae]}}dp.layerName="PolygonLayer";dp.defaultProps=wF;const Gm=dp,SF=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Qu=192/256,ey=[],EF={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class pp extends Rk{getShaders(){return{...super.getShaders(),fs:SF}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&J.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,Qu*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Qu,outlineBuffer:o,gamma:r,sdf:!!n,outlineColor:s},super.draw(e),n&&i){const{iconManager:a}=this.state,l=a.getTexture(),c=this.state.model;l&&(c.setUniforms({outlineBuffer:Qu}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):ey}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):ey}}pp.defaultProps=EF;pp.layerName="MultiIconLayer";const AF=pp,zs=1e20;class RF{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(i)),f=c+2*this.buffer,h=u+2*this.buffer,_=Math.max(f*h,0),d=new Uint8ClampedArray(_),m={data:d,width:f,height:h,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return m;const{ctx:E,buffer:p,gridInner:g,gridOuter:y}=this;E.clearRect(p,p,c,u),E.fillText(e,p,p+a);const A=E.getImageData(p,p,c,u);y.fill(zs,0,_),g.fill(0,0,_);for(let x=0;x<u;x++)for(let I=0;I<c;I++){const O=A.data[4*(x*c+I)+3]/255;if(O===0)continue;const N=(x+p)*f+I+p;if(O===1)y[N]=0,g[N]=zs;else{const k=.5-O;y[N]=k>0?k*k:0,g[N]=k<0?k*k:0}}ty(y,0,0,f,h,f,this.f,this.v,this.z),ty(g,p,p,c,u,f,this.f,this.v,this.z);for(let x=0;x<_;x++){const I=Math.sqrt(y[x])-Math.sqrt(g[x]);d[x]=Math.round(255-255*(I/this.radius+this.cutoff))}return m}}function ty(t,e,n,r,i,s,o,a,l){for(let c=e;c<e+r;c++)ny(t,n*s+c,s,i,o,a,l);for(let c=n;c<n+i;c++)ny(t,c*s+e,1,r,o,a,l)}function ny(t,e,n,r,i,s,o){s[0]=0,o[0]=-zs,o[1]=zs,i[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){i[a]=t[e+a*n];const u=a*a;do{const f=s[l];c=(i[a]-i[f]+u-f*f)/(a-f)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=zs}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=i[c]+u*u}}const bF=32,PF=[];function xF(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function CF({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+r*2;for(const f of t)if(!s[f]){const h=e(f);c+h+r*2>i&&(c=0,l++),s[f]={x:c+r,y:a+l*u+r,width:h,height:u,layoutWidth:h,layoutHeight:n},c+=h+r*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:xF(a+(l+1)*u)}}function Ww(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function Hw(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const c=Ww(t,l,l+1,i);a+c>r&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function IF(t,e,n,r,i,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=Ww(t,a,l,i);c+f>r&&(o<a&&(s.push(a),o=a,c=0),f>r&&(f=Hw(t,a,l,r,i,s),o=s[s.length-1])),a=l,c+=f}return c}function MF(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?Hw(t,i,s,n,r,o):IF(t,i,s,n,r,o),o}function OF(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=r[c];u?(a||(a=u.layoutHeight),i[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(J.warn(`Missing character: ${c} (${c.codePointAt(0)})`)(),i[l]=o,o+=bF)}s[0]=o,s[1]=a}function NF(t,e,n,r,i){var E;const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,f=[0,0],h=[0,0];let _=0,d=0,m=0;for(let p=0;p<=o;p++){const g=s[p];if((g===`
`||p===o)&&(m=p),m>d){const y=u?MF(s,n,r,i,d,m):PF;for(let A=0;A<=y.length;A++){const x=A===0?d:y[A-1],I=A<y.length?y[A]:m;OF(s,x,I,i,a,h);for(let O=x;O<I;O++){const N=s[O],k=((E=i[N])==null?void 0:E.layoutOffsetY)||0;l[O]=_+h[1]/2+k,c[O]=h[0]}_=_+h[1]*e,f[0]=Math.max(f[0],h[0])}d=m}g===`
`&&(a[d]=0,l[d]=0,c[d]=0,d++)}return f[1]=_,{x:a,y:l,rowWidth:c,size:f}}function kF({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,c=i[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const _=t.constructor;h=new _(c);for(let d=0;d<c;d++)h[d]=t[d*a+l]}for(let _=0;_<e;_++){const d=i[_],m=i[_+1]||c,E=h.subarray(d,m);f[_]=String.fromCodePoint.apply(null,E),u&&E.forEach(u.add,u)}if(u)for(const _ of u)s.add(String.fromCodePoint(_));return{texts:f,characterCount:c}}class $w{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function FF(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ei={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:FF(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},ry=1024,iy=.9,sy=1.2,Xw=3;let Hl=new $w(Xw);function DF(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=Hl.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function BF(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function oy(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function UF(t){J.assert(Number.isFinite(t)&&t>=Xw,"Invalid cache limit"),Hl=new $w(t)}class LF{constructor(){this.props={...Ei}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*sy+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=DF(this._key,this.props.characterSet),r=Hl.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,Hl.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=ry);const f=u.getContext("2d",{willReadFrequently:!0});oy(f,r,s,i);const{mapping:h,canvasHeight:_,xOffset:d,yOffset:m}=CF({getFontWidth:E=>f.measureText(E).width,fontHeight:s*sy,buffer:o,characterSet:e,maxCanvasWidth:ry,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==_){const E=f.getImageData(0,0,u.width,u.height);u.height=_,f.putImageData(E,0,0)}if(oy(f,r,s,i),a){const E=new RF({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:r,fontWeight:`${i}`});for(const p of e){const{data:g,width:y,height:A,glyphTop:x}=E.draw(p);h[p].width=y,h[p].layoutOffsetY=s*iy-x;const I=f.createImageData(y,A);BF(g,I),f.putImageData(I,h[p].x,h[p].y)}}else for(const E of e)f.fillText(E,h[E].x,h[E].y+o+s*iy);return{xOffset:d,yOffset:m,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const zF=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,VF=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class gp extends $i{getShaders(){return super.getShaders({vs:zF,fs:VF,modules:[xo,Co]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const c=this.state.model;c.setUniforms(e),c.setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:Di[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}),c.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Mt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zi({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}gp.defaultProps=jF;gp.layerName="TextBackgroundLayer";const WF=gp,ay={start:1,middle:0,end:-1},ly={top:1,center:0,bottom:-1},Ju=[0,0,0,255],HF=1,$F={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ju},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ei.characterSet},fontFamily:Ei.fontFamily,fontWeight:Ei.fontWeight,lineHeight:HF,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ju},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ju},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class _p extends Aw{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=ay[typeof o=="function"?o(e,n):o],c=ly[typeof a=="function"?a(e,n):a];return[(l-1)*r/2,(c-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[l,c]}=this.transformParagraph(e,n),u=ay[typeof r=="function"?r(e,n):r],f=ly[typeof i=="function"?i(e,n):i],h=s.length,_=new Array(h*2);let d=0;for(let m=0;m<h;m++){const E=(1-u)*(l-a[m])/2;_[d++]=(u-1)*l/2+E+s[m],_[d++]=(f-1)*c/2+o[m]}return _}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new LF},this.props.maxWidth>0&&J.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:n}=this.props,r=(l=e.attributes)==null?void 0:l.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:c,characterCount:u}=kF({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=u,i=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=Mo(e);s=[0],o=0;for(const f of c){u.index++;const h=Array.from(i(f,u)||"");a&&h.forEach(a.add,a),o+=h.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return NF(c,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:_,getPixelOffset:d,getBackgroundColor:m,getBorderColor:E,getBorderWidth:p,backgroundPadding:g,background:y,billboard:A,fontSettings:x,outlineWidth:I,outlineColor:O,sizeScale:N,sizeUnits:k,sizeMinPixels:U,sizeMaxPixels:j,transitions:H,updateTriggers:W}=this.props,X=this.getSubLayerClass("characters",AF),Ae=this.getSubLayerClass("background",WF);return[y&&new Ae({getFillColor:m,getLineColor:E,getLineWidth:p,padding:g,getPosition:u,getSize:h,getAngle:_,getPixelOffset:d,billboard:A,sizeScale:N,sizeUnits:k,sizeMinPixels:U,sizeMaxPixels:j,transitions:H&&{getPosition:H.getPosition,getAngle:H.getAngle,getSize:H.getSize,getFillColor:H.getBackgroundColor,getLineColor:H.getBorderColor,getLineWidth:H.getBorderWidth,getPixelOffset:H.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:W.getPosition,getAngle:W.getAngle,getSize:W.getSize,getFillColor:W.getBackgroundColor,getLineColor:W.getBorderColor,getLineWidth:W.getBorderWidth,getPixelOffset:W.getPixelOffset,getBoundingRect:{getText:W.getText,getTextAnchor:W.getTextAnchor,getAlignmentBaseline:W.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new X({sdf:x.sdf,smoothing:Number.isFinite(x.smoothing)?x.smoothing:Ei.smoothing,outlineWidth:I/(x.radius||Ei.radius),outlineColor:O,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:_,getPixelOffset:d,billboard:A,sizeScale:N*i,sizeUnits:k,sizeMinPixels:U*i,sizeMaxPixels:j*i,transitions:H&&{getPosition:H.getPosition,getAngle:H.getAngle,getColor:H.getColor,getSize:H.getSize,getPixelOffset:H.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:W.getText,getPosition:W.getPosition,getAngle:W.getAngle,getColor:W.getColor,getSize:W.getSize,getPixelOffset:W.getPixelOffset,getIconOffsets:{getTextAnchor:W.getTextAnchor,getAlignmentBaseline:W.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){UF(e)}}_p.defaultProps=$F;_p.layerName="TextLayer";const XF=_p;var gs,_s,Aa=!1;const Ra=[[1,152,189],[73,227,206],[115,254,86],[250,225,119],[254,173,84],[209,55,78]];var cy,Gu,ba,ef,ir,tf,nf,Pa,xa,Ca,Ia,uy,Ma=[];const ge=document.createElement("div");ge.id="infoWindow";ge.style.position="fixed";ge.style.top="20px";ge.style.right="20px";ge.style.padding="15px";ge.style.backgroundColor="white";ge.style.border="1px solid black";ge.style.display="none";ge.style.zIndex="1000";document.body.appendChild(ge);const kc=document.createElement("button");kc.innerText="Close";kc.onclick=()=>{ge.style.display="none"};ge.appendChild(kc);function YF(t){ge.style.display="block",ge.innerHTML=`<strong>${t.name}</strong><br>${t.value}`,ge.appendChild(kc)}const Yw=document.createElement("div");ge.id="fpsPanel";ge.style.position="fixed";ge.style.top="20px";ge.style.right="20px";ge.style.padding="15px";ge.style.backgroundColor="white";ge.style.border="1px solid black";ge.style.zIndex="1000";document.body.appendChild(Yw);function KF({object:t}){if(!t)return null;if(t.name){const e=t.name,n=t.value;return`      Cell: ${e}
      ${n}`}else if(t.to)return`      Arc from ${t.from.name} to ${t.to.name}`}function ZF(){var t=[""],e="";console.log("./ic.json"),fetch("/citysheet/ic.json").then(d=>d.json()).then(d=>{if(gs=0,_s=0,ba=ba=d.flatMap(m=>Object.values(m)[0].rows||[]),ef=d.flatMap(m=>Object.values(m)[0].cols||[]),ir=d.flatMap(m=>Object.values(m)[0].cells||[]),cy=Math.max(...ir.map(m=>m.rank)),Array.isArray(ba)&&Array.isArray(ef)){let m=function(){let p=Math.round(Gu.metrics.fps);Yw.textContent=`FPS: ${p}`,requestAnimationFrame(m)},E=function(){setInterval(()=>{},1e3)};tf=r(ba,"RowPaths"),nf=r(ef,"ColPaths"),i(),s(),o(),a(),l(),Gu=new UO({initialViewState:{target:[0,0,0],zoom:-.5,rotationX:45,rotationOrbit:-45},controller:{dragMode:"pan"},views:new lk({far:1e5,near:.1,orthographic:!1}),layers:[tf,nf,Pa,xa,Ca,Ia,uy],getTooltip:KF}),setTimeout(()=>{Aa=!0,c()},1),setTimeout(()=>{E()},1700),setInterval(m,10)}}).catch(d=>console.error("Error fetching JSON:",d));function r(d,m){return new Dw({id:m,data:d,getPath:p=>p.path,getWidth:1,pickable:!0,coordinateSystem:q.CARTESIAN})}function i(){return Pa=new XF({id:"CellLayer",data:ir,billboard:!1,getPosition:d=>[d.coord[0]+2,d.coord[1]-2,d.rank*20+2],getText:d=>d.value,sizeScale:.25,sizeUnits:"common",getAlignmentBaseline:"top",getTextAnchor:"start"}),Pa}function s(){return xa=new Gm({id:"CellBackground",data:ir,transitions:{getPolygon:1e3},stroked:!1,extruded:!0,getElevation:.5,material:!1,filled:!0,getPolygon:d=>{var m,E,p,g;const y=d.rank*20,A=.5;return m=[d.coord[0]+A,d.coord[1]-A,y],E=[d.coord[0]+d.width-A,d.coord[1]-A,y],p=[d.coord[0]+A,d.coord[1]-d.height+A,y],g=[d.coord[0]+d.width-A,d.coord[1]-d.height+A,y],[m,E,g,p]},getFillColor:d=>d.bg_color}),xa}function o(){const d=ir.filter(m=>m.rank!=0);return Ca=new Gm({id:"TowerLayer",data:d,getElevation:m=>Aa?m.rank*20-1:0,transitions:{getElevation:1e3},opacity:.2,getPolygon:m=>{var E,p,g,y;return E=[m.coord[0],m.coord[1]],p=[m.coord[0]+m.width,m.coord[1]],g=[m.coord[0],m.coord[1]-m.height],y=[m.coord[0]+m.width,m.coord[1]-m.height],[E,p,y,g]},onClick:({object:m})=>{m&&YF(m)},getFillColor:m=>{let E=Math.floor((Ra.length-1)*m.rank/cy),p=Ra[E];return m.rank===0,p},extruded:!0,pickable:!0,onHover:m=>{const E=t;t=m.object?[m.object.name]:[null],e="tower",t!=E&&c()},updateTriggers:{getFillColor:[t]}}),Ca}function a(){Ma=u();var d;return e=="tower"&&(d=m(t[0])),Ia=new hk({id:"ArcLayer",data:Ma,getSourcePosition:E=>[E.from.coords[0],E.from.coords[1],Aa?E.from.rank*20:0],getTargetPosition:E=>[E.to.coords[0],E.to.coords[1],Aa?E.to.rank*20:0],transitions:{getSourcePosition:1e3,getTargetPosition:1e3},getSourceColor:E=>{var p=50;e=="arc"?E.from.name===t[0]&&E.to.name===t[1]&&(p=255):e=="tower"&&d.some(y=>y[0]===E.from.name&&y[1]===E.to.name)&&(p=255);let g=E.color;return[g[0],g[1],g[2],p]},getTargetColor:E=>{var p=50;e=="arc"?E.from.name===t[0]&&E.to.name===t[1]&&(p=255):e=="tower"&&d.some(y=>y[0]===E.from.name&&y[1]===E.to.name)&&(p=255);let g=E.color;return[g[0],g[1],g[2],p]},getWidth:5,widthUnits:"common",pickable:!0,getHeight:E=>f(E),onHover:E=>{const p=t;t=E.object?[E.object.from.name,E.object.to.name]:[null],e="arc",t!=p&&c()},updateTriggers:{getSourceColor:[t],getTargetColor:[t]}}),Ia;function m(E){function p(g){const y=Ma.filter(x=>x.to.name===g),A=[];for(const x of y){const I=x.from.name,O=x.to.name;A.push([I,O]);const N=p(I);for(const k of N)A.push(k)}return A}return p(E)}}function l(){Ma.forEach(d=>{const m=[d.from.coords[0],d.from.coords[1],d.from.rank],E=[d.to.coords[0],d.to.coords[1],d.to.rank],p=h(m,E,200,f(d));for(let g=0;g<=p.length;g+=p.length/5)d.color,Array.from({length:p.length},(y,A)=>g+A*.5)})}function c(){s(),o(),a(),l();const d=[tf,nf,Pa,xa,Ia,Ca,uy];Gu.setProps({layers:d})}function u(){const d={};ir.forEach(E=>{d[E.name]=E});const m=[];return ir.forEach(E=>{const p=E;p.used_by.forEach(g=>{const y=d[g];if(y){const A=Math.abs(p.coord[0]-y.coord[0]),x=Math.abs(p.coord[1]-y.coord[1]);gs=A>gs?A:gs,_s=x>_s?x:_s;const I={color:Ra[y.formula_type%Ra.length],from:{name:p.name,rank:p.rank,coords:[p.coord[0]+p.width/2,p.coord[1]-p.height/2]},to:{name:g,rank:y.rank,coords:[y.coord[0]+y.width/2,y.coord[1]-y.height/2]}};m.push(I)}})}),m}function f(d){const m=Math.sqrt(Math.pow(d.from.coords[0]-d.to.coords[0],2)+(d.from.coords[1]-d.to.coords[1],2)),E=Math.sqrt(Math.pow(gs,2)+Math.pow(_s,2)),p=1-m/E,g=.4;var A=g+p*(3-g);return A}function h(d,m,E=200,p){const g=[];for(let y=0;y<=E;y++){const A=y/E,x=_(d,m,A,p);g.push(x)}return g}function _(d,m,E,p){const g=d[0]*(1-E)+m[0]*E,y=d[1]*(1-E)+m[1]*E,A=Math.sqrt(Math.pow(m[0]-d[0],2)+Math.pow(m[1]-d[1],2)),x=I(A,d[2],m[2],E,p)+1;return[g,y,x];function I(O,N,k,U,j){const H=k-N,W=O*j;if(W===0)return N+H*U;const X=H/W,Ae=X*X+1,kt=H>=0?1:-1,Ft=kt===1?N:k,L=kt===1?U:1-U;return Math.sqrt(L*(Ae-L))*W+Ft}}}function qF(t){bv(t).render($S.jsx(ZF,{}))}qF(document.getElementById("app"));
